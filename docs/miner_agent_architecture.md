# ğŸ—ï¸ Miner Agent æ¶æ„è®¾è®¡æ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

- **ç‰ˆæœ¬**: 1.0.0
- **æ—¥æœŸ**: 2025-10-13
- **çŠ¶æ€**: è®¾è®¡é˜¶æ®µ
- **ä½œè€…**: HashInsight Enterprise Team

---

## ğŸ¯ ç³»ç»Ÿç›®æ ‡

### æ ¸å¿ƒç›®æ ‡
1. **çªç ´ç½‘ç»œéš”ç¦»** - è§£å†³äº‘ç«¯æœåŠ¡å™¨æ— æ³•ç›´è¿çŸ¿åœºå†…ç½‘çŸ¿æœºçš„é—®é¢˜
2. **åŒå‘é€šä¿¡** - å®ç°æ•°æ®ä¸ŠæŠ¥å’Œè¿œç¨‹æ§åˆ¶çš„å®Œæ•´é—­ç¯
3. **é«˜å¯é æ€§** - æ”¯æŒæ–­çº¿é‡è¿ã€æ•°æ®ç¼“å†²ã€æ•…éšœæ¢å¤
4. **è½»é‡éƒ¨ç½²** - æœ€å°åŒ–çŸ¿åœºä¾§éƒ¨ç½²å¤æ‚åº¦ï¼Œå•æ–‡ä»¶å³å¯è¿è¡Œ
5. **ç”Ÿäº§çº§å®‰å…¨** - åŒå‘è®¤è¯ã€æ“ä½œå®¡è®¡ã€æƒé™æ§åˆ¶

### ä¸šåŠ¡ä»·å€¼
- âœ… å®æ—¶ç›‘æ§çŸ¿æœºè¿è¡ŒçŠ¶æ€ï¼ˆç®—åŠ›ã€æ¸©åº¦ã€åŠŸè€—ï¼‰
- âœ… è¿œç¨‹æ§åˆ¶çŸ¿æœºæ“ä½œï¼ˆé‡å¯ã€åˆ‡æ± ã€è°ƒé¢‘ï¼‰
- âœ… è‡ªåŠ¨åŒ–å‰Šå³°é™ç”µç­–ç•¥
- âœ… æ•…éšœé¢„è­¦å’Œæ™ºèƒ½è¯Šæ–­
- âœ… ç»Ÿä¸€å¤šçŸ¿åœºç®¡ç†

---

## ğŸ›ï¸ ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        äº‘ç«¯å¹³å° (Replit)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  Flask API   â”‚  â”‚  PostgreSQL  â”‚  â”‚    Redis     â”‚          â”‚
â”‚  â”‚  /agent/api  â”‚  â”‚  æ•°æ®æŒä¹…åŒ–   â”‚  â”‚  ä»»åŠ¡é˜Ÿåˆ—     â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚         â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚         Agent ç®¡ç†æœåŠ¡ (modules/agent)             â”‚           â”‚
â”‚  â”‚  - æ³¨å†Œè®¤è¯  - é…ç½®ç®¡ç†  - æŒ‡ä»¤ä¸‹å‘  - æ•°æ®æ¥æ”¶    â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ HTTPS + JWT Token
                              â”‚ (ä¸»åŠ¨æ¨é€æ¨¡å¼)
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    çŸ¿åœºæœ¬åœ°ç½‘ç»œ (192.168.x.x)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚          Miner Agent (Python æœåŠ¡)                 â”‚           â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚           â”‚
â”‚  â”‚  â”‚ CGMiner    â”‚  â”‚  æ•°æ®é‡‡é›†   â”‚  â”‚  äº‘ç«¯é€šä¿¡   â”‚ â”‚           â”‚
â”‚  â”‚  â”‚ API å®¢æˆ·ç«¯ â”‚  â”‚  å¼•æ“       â”‚  â”‚  æ¨¡å—       â”‚ â”‚           â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â”‚           â”‚
â”‚  â”‚        â”‚               â”‚               â”‚         â”‚           â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”‚           â”‚
â”‚  â”‚  â”‚         æ ¸å¿ƒè°ƒåº¦å™¨ (Main Loop)              â”‚ â”‚           â”‚
â”‚  â”‚  â”‚  - å¿ƒè·³  - é‡‡é›†  - ä¸ŠæŠ¥  - æŒ‡ä»¤æ‰§è¡Œ        â”‚ â”‚           â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                         â”‚                                        â”‚
â”‚                         â”‚ JSON-RPC over TCP (ç«¯å£ 4028)          â”‚
â”‚                         â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Antminer â”‚  â”‚ Antminer â”‚  â”‚ WhatsMinerâ”‚  â”‚  Avalon  â”‚       â”‚
â”‚  â”‚  S19     â”‚  â”‚  S21     â”‚  â”‚   M50    â”‚  â”‚  A1366   â”‚  ...  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¶æ„ç‰¹ç‚¹

#### 1. ä¸»åŠ¨æ¨é€æ¶æ„ (Push Model)
- **Agent â†’ äº‘ç«¯**: Agent ä¸»åŠ¨å»ºç«‹ HTTPS è¿æ¥æ¨é€æ•°æ®
- **ä¼˜åŠ¿**: çªç ´é˜²ç«å¢™é™åˆ¶ï¼Œæ— éœ€å…¬ç½‘IPæˆ–ç«¯å£æ˜ å°„
- **å¿ƒè·³æœºåˆ¶**: æ¯30ç§’å‘é€ä¸€æ¬¡å¿ƒè·³ï¼Œä¿æŒè¿æ¥æ´»æ€§

#### 2. åŒå‘é€šä¿¡æœºåˆ¶
```
æ•°æ®ä¸ŠæŠ¥ (Agent â†’ Cloud):
  - å¿ƒè·³åŒ… (30ç§’/æ¬¡)
  - é¥æµ‹æ•°æ® (60ç§’/æ¬¡æˆ–æŒ‰éœ€)
  - äº‹ä»¶å‘Šè­¦ (å®æ—¶)
  - æ—¥å¿—ä¸ŠæŠ¥ (å®šæœŸ/å‡ºé”™æ—¶)

æŒ‡ä»¤ä¸‹å‘ (Cloud â†’ Agent):
  - å¿ƒè·³å“åº”ä¸­æºå¸¦å¾…æ‰§è¡ŒæŒ‡ä»¤
  - Agent è½®è¯¢ /agent/api/commands æ¥å£
  - æŒ‡ä»¤æ‰§è¡Œåä¸ŠæŠ¥ç»“æœ
```

#### 3. åˆ†å±‚è®¾è®¡

| å±‚æ¬¡ | èŒè´£ | æŠ€æœ¯æ ˆ |
|------|------|--------|
| **å±•ç¤ºå±‚** | Agent ç®¡ç†ç•Œé¢ã€ç›‘æ§ä»ªè¡¨ç›˜ | Jinja2 + Bootstrap |
| **APIå±‚** | RESTful APIã€è®¤è¯æˆæƒ | Flask Blueprint |
| **ä¸šåŠ¡å±‚** | Agent ç®¡ç†ã€æŒ‡ä»¤è°ƒåº¦ã€æ•°æ®å¤„ç† | Python Service |
| **æ•°æ®å±‚** | æ•°æ®æŒä¹…åŒ–ã€ç¼“å­˜ | PostgreSQL + Redis |
| **Agentå±‚** | æ•°æ®é‡‡é›†ã€æŒ‡ä»¤æ‰§è¡Œ | Python Script |
| **è®¾å¤‡å±‚** | çŸ¿æœºç¡¬ä»¶ | CGMiner API |

---

## ğŸ” å®‰å…¨æœºåˆ¶

### 1. åŒå‘è®¤è¯

#### Agent æ³¨å†Œæµç¨‹
```
1. ç®¡ç†å‘˜åœ¨äº‘ç«¯åˆ›å»º Agent è®°å½•
   â”œâ”€ ç”Ÿæˆå”¯ä¸€ agent_id (UUID)
   â”œâ”€ ç”Ÿæˆåˆå§‹ access_token (JWT)
   â””â”€ è®¾ç½®æ‰€å±çŸ¿åœºã€æƒé™ç­‰çº§

2. Agent é¦–æ¬¡å¯åŠ¨
   â”œâ”€ è¯»å–é…ç½®æ–‡ä»¶ (agent_id + access_token)
   â”œâ”€ å‘äº‘ç«¯å‘èµ·æ³¨å†ŒéªŒè¯
   â””â”€ äº‘ç«¯éªŒè¯æˆåŠŸåæ¿€æ´» Agent

3. Token åˆ·æ–°æœºåˆ¶
   â”œâ”€ Token æœ‰æ•ˆæœŸ: 7å¤©
   â”œâ”€ Agent æ¯æ¬¡å¿ƒè·³æ£€æŸ¥ Token æ˜¯å¦å³å°†è¿‡æœŸ
   â””â”€ è‡ªåŠ¨è¯·æ±‚æ–° Token
```

#### JWT Token è®¾è®¡
```python
{
  "agent_id": "uuid-string",
  "site_id": 123,              # æ‰€å±çŸ¿åœº
  "permissions": ["read", "control"],  # æƒé™åˆ—è¡¨
  "exp": 1729958400,           # è¿‡æœŸæ—¶é—´
  "iat": 1729872000            # ç­¾å‘æ—¶é—´
}
```

### 2. API è®¤è¯

æ‰€æœ‰ API è¯·æ±‚å¿…é¡»æºå¸¦ Bearer Token:
```http
POST /agent/api/telemetry HTTP/1.1
Host: hashinsight.replit.app
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
Content-Type: application/json
```

### 3. æ“ä½œå®¡è®¡

æ‰€æœ‰æ•æ„Ÿæ“ä½œè®°å½•åˆ°å®¡è®¡æ—¥å¿—:
- Agent æ³¨å†Œ/æ³¨é”€
- æ§åˆ¶æŒ‡ä»¤ä¸‹å‘/æ‰§è¡Œ
- é…ç½®å˜æ›´
- æƒé™ä¿®æ”¹

### 4. æ•°æ®åŠ å¯†

- **ä¼ è¾“åŠ å¯†**: HTTPS (TLS 1.2+)
- **æ•æ„Ÿå­—æ®µ**: å¯†é’¥ã€Token ç­‰ä½¿ç”¨ AES-256 åŠ å¯†å­˜å‚¨
- **æ—¥å¿—è„±æ•**: IPã€åºåˆ—å·ç­‰ä¿¡æ¯éƒ¨åˆ†éšè—

---

## ğŸ“¡ é€šä¿¡åè®®

### 1. å¿ƒè·³åè®®

#### è¯·æ±‚ (Agent â†’ Cloud)
```json
POST /agent/api/heartbeat
{
  "agent_id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
  "timestamp": 1729872000,
  "version": "1.0.0",
  "status": "online",
  "stats": {
    "cpu_usage": 15.2,
    "memory_usage": 42.8,
    "disk_usage": 68.5,
    "uptime": 86400
  }
}
```

#### å“åº” (Cloud â†’ Agent)
```json
{
  "status": "ok",
  "timestamp": 1729872001,
  "commands": [
    {
      "command_id": "cmd-12345",
      "type": "reboot_miner",
      "target": "192.168.1.100",
      "params": {}
    }
  ],
  "config_version": "v2.1.0",
  "new_token": null  # ä»…åœ¨ Token å³å°†è¿‡æœŸæ—¶è¿”å›
}
```

### 2. é¥æµ‹æ•°æ®åè®®

#### è¯·æ±‚ (Agent â†’ Cloud)
```json
POST /agent/api/telemetry
{
  "agent_id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
  "timestamp": 1729872000,
  "miners": [
    {
      "ip_address": "192.168.1.100",
      "mac_address": "00:1A:2B:3C:4D:5E",
      "serial_number": "S19-12345",
      "miner_type": "Antminer S19 Pro",
      "status": "running",
      "hashrate_th": 110.5,
      "temperature_avg": 68.3,
      "temperature_max": 72.1,
      "fan_speed_avg": 4500,
      "power_consumption_w": 3250,
      "pool_url": "stratum+tcp://pool.example.com:3333",
      "pool_worker": "worker001",
      "accepted_shares": 12543,
      "rejected_shares": 23,
      "hardware_errors": 0,
      "uptime_seconds": 86400
    }
  ]
}
```

#### å“åº” (Cloud â†’ Agent)
```json
{
  "status": "ok",
  "received_count": 1,
  "timestamp": 1729872001
}
```

### 3. æ§åˆ¶æŒ‡ä»¤åè®®

#### äº‘ç«¯åˆ›å»ºæŒ‡ä»¤
```json
POST /agent/api/commands/create
{
  "agent_id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
  "command_type": "reboot_miner",
  "target_ip": "192.168.1.100",
  "params": {
    "delay_seconds": 30,
    "reason": "scheduled_maintenance"
  }
}
```

#### Agent æ‰§è¡Œåä¸ŠæŠ¥ç»“æœ
```json
POST /agent/api/commands/{command_id}/result
{
  "agent_id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
  "command_id": "cmd-12345",
  "status": "success",
  "executed_at": 1729872030,
  "result": {
    "message": "Miner rebooted successfully",
    "reboot_time": 45
  },
  "error": null
}
```

### 4. æ”¯æŒçš„æ§åˆ¶æŒ‡ä»¤ç±»å‹

| æŒ‡ä»¤ç±»å‹ | å‚æ•° | æè¿° |
|---------|------|------|
| `reboot_miner` | `target_ip`, `delay_seconds` | é‡å¯çŸ¿æœº |
| `switch_pool` | `target_ip`, `pool_url`, `worker` | åˆ‡æ¢çŸ¿æ±  |
| `adjust_frequency` | `target_ip`, `frequency_mhz` | è°ƒæ•´ç®—åŠ›é¢‘ç‡ |
| `enable_low_power` | `target_ip` | å¯ç”¨ä½åŠŸè€—æ¨¡å¼ |
| `disable_low_power` | `target_ip` | ç¦ç”¨ä½åŠŸè€—æ¨¡å¼ |
| `update_config` | `target_ip`, `config_json` | æ›´æ–°çŸ¿æœºé…ç½® |
| `restart_agent` | - | é‡å¯ Agent æœåŠ¡ |
| `update_agent` | `version` | æ›´æ–° Agent ç‰ˆæœ¬ |

---

## ğŸ”„ æ•°æ®æµè®¾è®¡

### 1. æ­£å¸¸è¿è¡Œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Agent å¯åŠ¨  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¯»å–é…ç½®æ–‡ä»¶     â”‚
â”‚ - agent_id      â”‚
â”‚ - access_token  â”‚
â”‚ - äº‘ç«¯ API URL  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‘äº‘ç«¯æ³¨å†ŒéªŒè¯   â”‚ â”€â”€â”€â”€â”€â–º éªŒè¯å¤±è´¥ â†’ è®°å½•æ—¥å¿— â†’ é€€å‡º
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ éªŒè¯æˆåŠŸ
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¯åŠ¨ä¸»å¾ªç¯       â”‚
â”‚ - å¿ƒè·³çº¿ç¨‹       â”‚
â”‚ - é‡‡é›†çº¿ç¨‹       â”‚
â”‚ - æŒ‡ä»¤çº¿ç¨‹       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ä¸»å¾ªç¯ (æ¯åˆ†é’Ÿä¸€æ¬¡)            â”‚
â”‚                                      â”‚
â”‚  1. æ‰«ææœ¬åœ°çŸ¿æœº (ç«¯å£ 4028)         â”‚
â”‚  2. é‡‡é›†é¥æµ‹æ•°æ® (CGMiner API)       â”‚
â”‚  3. ä¸ŠæŠ¥åˆ°äº‘ç«¯                       â”‚
â”‚  4. æ£€æŸ¥å¾…æ‰§è¡ŒæŒ‡ä»¤                   â”‚
â”‚  5. æ‰§è¡ŒæŒ‡ä»¤å¹¶ä¸ŠæŠ¥ç»“æœ               â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
     å¾ªç¯
```

### 2. æ•…éšœæ¢å¤æµç¨‹

```
Agent è¿è¡Œä¸­
    â”‚
    â–¼
ç½‘ç»œæ–­å¼€ / API å¼‚å¸¸
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¿›å…¥ç¦»çº¿æ¨¡å¼     â”‚
â”‚ - åœæ­¢ä¸ŠæŠ¥       â”‚
â”‚ - æœ¬åœ°ç¼“å­˜æ•°æ®   â”‚
â”‚ - ç»§ç»­é‡‡é›†       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
æ¯30ç§’å°è¯•é‡è¿
    â”‚
    â”œâ”€â–º é‡è¿å¤±è´¥ â†’ ç»§ç»­ç¼“å­˜ â†’ æ£€æŸ¥ç¼“å­˜å¤§å° â†’ è¶…é™åˆ™ä¸¢å¼ƒæ—§æ•°æ®
    â”‚
    â–¼
é‡è¿æˆåŠŸ
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ‰¹é‡ä¸ŠæŠ¥ç¼“å­˜æ•°æ® â”‚
â”‚ - æœ€å¤š1000æ¡/æ‰¹  â”‚
â”‚ - ä¸ŠæŠ¥æˆåŠŸåæ¸…ç† â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
æ¢å¤æ­£å¸¸è¿è¡Œ
```

### 3. æ•°æ®ç¼“å†²ç­–ç•¥

```python
# Agent æœ¬åœ°ç¼“å†²
ç¼“å†²å¤§å°: æœ€å¤š 10,000 æ¡è®°å½•
ç¼“å†²æ—¶é•¿: æœ€å¤š 24 å°æ—¶
ä¸¢å¼ƒç­–ç•¥: FIFO (å…ˆè¿›å…ˆå‡º)

# äº‘ç«¯æ•°æ®ä¿ç•™
å®æ—¶æ•°æ®: Redis ç¼“å­˜ 1 å°æ—¶
å†å²æ•°æ®: PostgreSQL ä¿ç•™ 90 å¤©
èšåˆæ•°æ®: æ°¸ä¹…ä¿ç•™ (æ¯å°æ—¶/æ¯å¤©ç»Ÿè®¡)
```

---

## ğŸš€ éƒ¨ç½²æ¶æ„

### Agent éƒ¨ç½²ä½ç½®

#### æ–¹æ¡ˆ A: çŸ¿åœºè·¯ç”±å™¨/æœåŠ¡å™¨ (æ¨è)
```
ä¼˜åŠ¿:
âœ… ä¸€ä¸ª Agent ç®¡ç†æ•´ä¸ªçŸ¿åœº
âœ… èµ„æºæ¶ˆè€—ä½ (Python è„šæœ¬ < 50MB å†…å­˜)
âœ… ç»Ÿä¸€é…ç½®ç®¡ç†

è¦æ±‚:
- Linux ç³»ç»Ÿ (Ubuntu 20.04+)
- Python 3.8+
- å¯è®¿é—®å…¬ç½‘ (HTTPS å‡ºç«™)
```

#### æ–¹æ¡ˆ B: ç‹¬ç«‹å·¥æ§æœº
```
ä¼˜åŠ¿:
âœ… éš”ç¦»è¿è¡Œï¼Œä¸å½±å“çŸ¿æœºç½‘ç»œ
âœ… å¯æ‰©å±•æ€§å¼º

è¦æ±‚:
- ä¸“ç”¨ç¡¬ä»¶ (æ ‘è“æ´¾4B å³å¯)
- ç¨³å®šä¾›ç”µ
```

#### æ–¹æ¡ˆ C: æ¯ä¸ªæœºæ¶éƒ¨ç½²
```
ä¼˜åŠ¿:
âœ… åˆ†å¸ƒå¼å®¹é”™
âœ… å‡å°‘å•ç‚¹æ•…éšœ

åŠ£åŠ¿:
âŒ éƒ¨ç½²å¤æ‚åº¦é«˜
âŒ ç®¡ç†æˆæœ¬é«˜
```

### ç½‘ç»œè¦æ±‚

```
å‡ºç«™è¿æ¥:
- HTTPS (443) â†’ hashinsight.replit.app
- å¸¦å®½: æœ€ä½ 1 Mbps (å»ºè®® 10 Mbps)

å†…ç½‘è®¿é—®:
- TCP 4028 â†’ æ‰€æœ‰çŸ¿æœº (CGMiner API)
- æ— éœ€å…¬ç½‘ IP
- æ— éœ€ç«¯å£æ˜ å°„
```

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### Agent æ€§èƒ½

| æŒ‡æ ‡ | æ•°å€¼ | è¯´æ˜ |
|------|------|------|
| æ”¯æŒçŸ¿æœºæ•°é‡ | 500 å° | å• Agent æ¨èæœ€å¤§å€¼ |
| é‡‡é›†å‘¨æœŸ | 60 ç§’ | å¯é…ç½® (30-300ç§’) |
| å¿ƒè·³å‘¨æœŸ | 30 ç§’ | å›ºå®š |
| å†…å­˜å ç”¨ | < 100 MB | ç¨³å®šè¿è¡Œ |
| CPU å ç”¨ | < 5% | é‡‡é›†æœŸé—´ |
| ç½‘ç»œæµé‡ | ~1 KB/çŸ¿æœº/åˆ†é’Ÿ | ä¸Šè¡Œå¸¦å®½ |

### äº‘ç«¯æ€§èƒ½

| æŒ‡æ ‡ | æ•°å€¼ | è¯´æ˜ |
|------|------|------|
| API å“åº”æ—¶é—´ | < 200ms | P95 |
| å¹¶å‘ Agent æ•° | 100+ | å•å®ä¾‹ |
| é¥æµ‹æ•°æ®åå | 10,000 æ¡/åˆ†é’Ÿ | å³°å€¼ |
| æ•°æ®åº“å†™å…¥ | æ‰¹é‡æ’å…¥ | ä¼˜åŒ–æ€§èƒ½ |

---

## ğŸ›¡ï¸ å®¹é”™è®¾è®¡

### 1. Agent å®¹é”™

```python
# ç½‘ç»œå¼‚å¸¸
- è‡ªåŠ¨é‡è¿ (æŒ‡æ•°é€€é¿)
- æœ¬åœ°æ•°æ®ç¼“å†²
- ç¦»çº¿æ¨¡å¼è¿è¡Œ

# çŸ¿æœºå¼‚å¸¸
- å•å°çŸ¿æœºæ•…éšœä¸å½±å“æ•´ä½“é‡‡é›†
- è¶…æ—¶ä¿æŠ¤ (5ç§’)
- é”™è¯¯è®¡æ•°å’Œå‘Šè­¦

# Agent å´©æºƒ
- systemd è‡ªåŠ¨é‡å¯
- ä¿å­˜è¿è¡ŒçŠ¶æ€
- å´©æºƒæ—¥å¿—ä¸ŠæŠ¥
```

### 2. äº‘ç«¯å®¹é”™

```python
# API é™æµ
- å• Agent: 100 è¯·æ±‚/åˆ†é’Ÿ
- å…¨å±€: 10,000 è¯·æ±‚/åˆ†é’Ÿ

# æ•°æ®éªŒè¯
- JSON Schema éªŒè¯
- æ•°æ®èŒƒå›´æ£€æŸ¥
- é‡å¤æ•°æ®è¿‡æ»¤

# é™çº§ç­–ç•¥
- Redis ä¸å¯ç”¨ â†’ ç›´æ¥å†™æ•°æ®åº“
- æ•°æ®åº“ä¸å¯ç”¨ â†’ è¿”å›é”™è¯¯ï¼ŒAgent ç¼“å†²
```

---

## ğŸ”§ æ‰©å±•æ€§è®¾è®¡

### æ°´å¹³æ‰©å±•

```
å¤šçŸ¿åœºéƒ¨ç½²:
  çŸ¿åœº A â†’ Agent A â”
  çŸ¿åœº B â†’ Agent B â”œâ”€â–º äº‘ç«¯ç»Ÿä¸€ç®¡ç†
  çŸ¿åœº C â†’ Agent C â”˜

å•çŸ¿åœºå¤š Agent:
  æœºæ¶ 1 â†’ Agent 1 â”
  æœºæ¶ 2 â†’ Agent 2 â”œâ”€â–º åŒä¸€çŸ¿åœº
  æœºæ¶ 3 â†’ Agent 3 â”˜
```

### åŠŸèƒ½æ‰©å±•

```python
æœªæ¥å¯æ·»åŠ :
- IP Reporter è‡ªåŠ¨å‘ç°
- å›ºä»¶æ‰¹é‡å‡çº§
- æ€§èƒ½åŸºå‡†æµ‹è¯•
- AI æ•…éšœé¢„æµ‹
- èƒ½æºä¼˜åŒ–ç®—æ³•
```

---

## ğŸ“ å®æ–½è·¯çº¿å›¾

### Phase 1: MVP (1å‘¨)
- âœ… Agent æ³¨å†Œå’Œè®¤è¯
- âœ… å¿ƒè·³æœºåˆ¶
- âœ… åŸºç¡€é¥æµ‹æ•°æ®é‡‡é›†
- âœ… äº‘ç«¯ API å’Œæ•°æ®åº“
- âœ… ç®€å•ç®¡ç†ç•Œé¢

### Phase 2: å¢å¼º (1å‘¨)
- âœ… æ§åˆ¶æŒ‡ä»¤ä¸‹å‘
- âœ… ç¦»çº¿ç¼“å†²å’Œæ¢å¤
- âœ… å®Œæ•´çš„ç›‘æ§ä»ªè¡¨ç›˜
- âœ… æ—¥å¿—å’Œå®¡è®¡

### Phase 3: è‡ªåŠ¨åŒ– (1-2å‘¨)
- âœ… IP Reporter é›†æˆ
- âœ… å‰Šå³°é™ç”µè”åŠ¨
- âœ… æ™ºèƒ½å‘Šè­¦
- âœ… æ€§èƒ½ä¼˜åŒ–

### Phase 4: ä¼ä¸šçº§ (2-3å‘¨)
- âœ… é«˜å¯ç”¨éƒ¨ç½²
- âœ… å¤šç§Ÿæˆ·éš”ç¦»
- âœ… å®Œæ•´çš„ RBAC
- âœ… æ•°æ®åˆ†æå’ŒæŠ¥è¡¨

---

## ğŸ“ æŠ€æœ¯é€‰å‹è¯´æ˜

### Agent ç«¯

| ç»„ä»¶ | æŠ€æœ¯é€‰å‹ | ç†ç”± |
|------|----------|------|
| ç¼–ç¨‹è¯­è¨€ | Python 3.8+ | è·¨å¹³å°ã€ç”Ÿæ€ä¸°å¯Œã€æ˜“éƒ¨ç½² |
| HTTP å®¢æˆ·ç«¯ | requests | ç¨³å®šå¯é ã€ç®€å•æ˜“ç”¨ |
| JSON å¤„ç† | æ ‡å‡†åº“ json | æ— é¢å¤–ä¾èµ– |
| é…ç½®ç®¡ç† | configparser / YAML | äººç±»å¯è¯»ã€æ˜“ç¼–è¾‘ |
| æ—¥å¿— | logging | æ ‡å‡†åº“ã€åŠŸèƒ½å®Œå–„ |
| è¿›ç¨‹ç®¡ç† | systemd | Linux æ ‡å‡†ã€å¼€æœºè‡ªå¯ |

### äº‘ç«¯

| ç»„ä»¶ | æŠ€æœ¯é€‰å‹ | ç†ç”± |
|------|----------|------|
| Web æ¡†æ¶ | Flask | å·²æœ‰æŠ€æœ¯æ ˆã€è½»é‡çµæ´» |
| æ•°æ®åº“ | PostgreSQL | å…³ç³»å‹ã€ACID ä¿è¯ |
| ç¼“å­˜ | Redis | é«˜æ€§èƒ½ã€æ”¯æŒå¤šç§æ•°æ®ç»“æ„ |
| è®¤è¯ | JWT | æ— çŠ¶æ€ã€æ˜“æ‰©å±• |
| API è®¾è®¡ | RESTful | æ ‡å‡†åŒ–ã€æ˜“ç†è§£ |

---

## âœ… è®¾è®¡åŸåˆ™æ€»ç»“

1. **ç®€å•ä¼˜å…ˆ** - æœ€å°åŒ–éƒ¨ç½²å¤æ‚åº¦ï¼Œå•æ–‡ä»¶å³å¯è¿è¡Œ
2. **å®‰å…¨ç¬¬ä¸€** - åŒå‘è®¤è¯ã€æ“ä½œå®¡è®¡ã€æ•°æ®åŠ å¯†
3. **å®¹é”™å¥å£®** - æ–­çº¿é‡è¿ã€æ•°æ®ç¼“å†²ã€æ•…éšœæ¢å¤
4. **æ€§èƒ½ä¼˜åŒ–** - æ‰¹é‡å¤„ç†ã€ç¼“å­˜ç­–ç•¥ã€å¼‚æ­¥é€šä¿¡
5. **æ˜“äºæ‰©å±•** - æ¨¡å—åŒ–è®¾è®¡ã€æ’ä»¶æœºåˆ¶ã€é…ç½®é©±åŠ¨
6. **ç”Ÿäº§å°±ç»ª** - å®Œæ•´æ—¥å¿—ã€ç›‘æ§å‘Šè­¦ã€è¿ç»´å·¥å…·

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ•°æ®åº“è®¾è®¡](./miner_agent_database.md)
- [API æ¥å£è§„èŒƒ](./miner_agent_api.md)
- [Agent ä»£ç å®ç°](../agent/miner_agent.py)
- [éƒ¨ç½²è¿ç»´æŒ‡å—](./miner_agent_deployment.md)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0  
**æœ€åæ›´æ–°**: 2025-10-13
