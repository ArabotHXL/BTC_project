你现在扮演：资深 CRM/SaaS 架构师 + 产品经理 + 全栈工程师（Node/TypeScript + Postgres + React）。
目标：对现有的“矿场客户 CRM（HashInsight）”进行一次性完整重设计与可用实现（MVP 可立即运行，结构可扩展）。

【业务上下文｜Business Context】
- 行业：虚拟货币矿场与咨询（托管/自挖/代购/选址与PPA谈判/运维与计费/续约扩容）。
- 站点：calc.hashinsight.net（网页询盘/ROI 计算入口，需通过 Webhook 写入 CRM 线索）。
- 典型链路：线索→商机→合同&订金→上电与试运行→运营与告警→计费与分润→续约/扩容。
- 语言：**中英双语输出**（界面与文档均提供中文+English）。

【一次性交付的成品目录与输出顺序（必须全部给出）】
1) 《系统蓝图（中文+English）》
   - 1.1 架构总览图（Mermaid flowchart）：前端、API 层、数据库、集成（邮件/日历、电子签、会计、矿池/监控）。
   - 1.2 领域模型图（Mermaid ERD）：以下核心对象及关系（字段含类型与校验）：
     Account, Contact, Lead, Deal, Site, PowerContract(PPA), Container/Rack, MinerAsset,
     Batch/Shipment, Onboarding, OpsTicket, CurtailmentEvent, EnergyRateSnapshot,
     RevenueShare/Invoice, Contract, Attachment/Evidence。
   - 1.3 阶段与流程泳道图（Mermaid sequence）：Lead→Deal 7阶段（需求确认/技术评估/经济测算/方案定稿/合同订金/交付中/转运营），
       Onboarding（站点验收→机位→配电→网络→监控→72h试运行），运维（告警→工单→SLA→关闭），计费（产出+电费+服务费→发票→回款），
       续约（60/30/7 天剧本）。

2) 《数据模型与数据库实现》
   - 2.1 Postgres DDL（CREATE TABLE…）：所有对象表、主外键、唯一约束、索引建议（含常用查询的复合索引），审计表（audit_log），
       多语言字段策略（如 name/name_en）、软删除与行级安全预留（RLS 注释）。
   - 2.2 Prisma schema（可选）或等价 ORM 定义。
   - 2.3 种子数据（seed.sql）：每个对象 5–10 条贴近真实的示例数据（不含任何 PII）。

3) 《API 规范（OpenAPI 3.0）》
   - 3.1 /leads, /deals, /sites, /contracts, /miner-assets, /ops-tickets, /curtailments, /invoices 等 REST 端点（CRUD + 批量导入导出）。
   - 3.2 认证与权限：JWT + RBAC（角色：Sales/Ops/Finance/Admin，字段级权限示例）。
   - 3.3 Webhook 接口：/webhooks/intake（对接 calc.hashinsight.net 表单），签名校验与重放防护。
   - 3.4 集成端点占位：/integrations/docusign, /quickbooks, /pools/{provider}, /monitoring/{source}。

4) 《自动化规则（YAML）》——**至少 20 条**可执行逻辑，格式：
   - trigger（事件/条件）/ filters / actions（创建任务、分配、更新字段、发送邮件、生成PDF、推进阶段）
   - 必含：线索24h未联系提醒、评分分配；进入“经济性测算”自动生成报价PDF；合同签署→创建Onboarding包；
     订金7天未到→释放机位；到货→批量导入SN→生成MinerAsset；试运行通过→转“运营中”；矿池/监控告警→开OpsTicket；
     限电事件→影响计算→记入当期发票；月初冻结 EnergyRateSnapshot；发票逾期7/14/30天催收；合同时效60/30/7天续约剧本。

5) 《计费与分润逻辑说明 + SQL 实现》
   - 5.1 公式：当期产出（矿池/链上数据）- 电费（PPA 快照 + 需量/基本费）- 服务费 = 净收益；分成/托管两种模式。
   - 5.2 汇总SQL与视图（views）：月度发票、应收账龄、单MW毛利/净利。
   - 5.3 数据一致性：账期冻结、回滚策略、重算标志位。

6) 《看板与指标（BI 直连 SQL）》
   - 漏斗与赢单周期、订金转化、上电甘特、质检不合格率、在线率、MTTA/MTTR、限电影响小时、回款率、应收账龄、续约/扩容率。
   - 每项给出视图/物化视图与示例查询。

7) 《前端管理台（示例级别）》
   - 7.1 技术栈：React + Tailwind（或 shadcn/ui），登录/导航/对象列表+详情（Lead/Deal/MinerAsset/Invoice）。
   - 7.2 表单校验（Zod/Yup），中英双语文案；Pipeline 看板（拖拽阶段）。
   - 7.3 附件上传与证据留存（展示哈希锚定位），导入CSV（批量SN）。
   - 7.4 只需提供关键页面的组件代码示例与路由结构，不要求完整像素级实现。

8) 《部署与环境》
   - 8.1 docker-compose.yml（api + db + adminer/pgadmin），.env.sample（数据库、JWT、第三方密钥占位）。
   - 8.2 启动脚本与健康检查；备份/还原脚本（pg_dump/pg_restore）。
   - 8.3 生产化建议：日志（JSON）、指标（Prometheus 占位）、灰度与迁移（migrate up/down）。

9) 《迁移方案》
   - 9.1 字段映射模板（CSV）：旧CRM字段→新模型字段（含类型转换、清洗规则）。
   - 9.2 批量导入端点与示例 cURL/Postman 集合（JSON）。
   - 9.3 幂等导入脚本（Node/TS）：去重策略（email+phone/company 或 SN 批次唯一）。

10) 《安全与合规》
   - 10.1 RBAC 列表（动作级与字段级示例）；审计日志（谁在何时对何对象做了何变更）。
   - 10.2 KMS/加密字段清单（KYC、合同、价格）；数据保留与删除流程。
   - 10.3 隐私与合规（GDPR/SOC 2 对应控制点映射表—简版）。

11) 《验收与试运行清单》
   - 11.1 30 条端到端用例（从网站留资到发票回款），逐条打钩。
   - 11.2 SLO：API P95<300ms、数据丢失RPO≤24h、恢复RTO≤4h。
   - 11.3 回滚与应急预案。

【实现细节要求】
- 不要提问，缺省信息请**合理假设并明确写出**假设。
- 字段需给出：name、类型、是否必填、校验、示例、权限可见性（谁可读/写）。
- 自动化与计费规则需可直接落库或运行（给出可执行伪代码/SQL/CRON 示例）。
- OpenAPI 要可直接导入 Swagger；所有端点给出示例请求/响应。
- 文案与界面：**中文+English**并列。
- 代码与配置均以**一个回复内**按章节输出（可分多段代码块），确保可复制运行。
- 输出最后给出“启动步骤（3条以内）”与“下一步扩展建议（≤5条）”。

【额外集成占位（为后续扩展）】
- 电子签：DocuSign/PandaDoc 占位；
- 会计：QuickBooks/Xero 占位；
- 矿池/监控：Pool API（如 ViaBTC/BTC.com 占位）与矿机管理平台（温度/拒率）；
- ROI 数据：BTC价格/难度/区块奖励/网络算力 API 占位；
- 上链锚定（可选）：对关键合同/证据生成哈希并记录到 L2（仅给接口与示例，不强制实现）。

请严格按上述目录顺序，逐项完整输出所有内容。
