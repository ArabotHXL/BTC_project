目标（不开币、不收款、只做“可信证明”）

可验证运营证据：算力/功耗/温度/停机与限电事件的“时间戳+哈希”上链；原始数据离链保存（IPFS/对象存储/你现有数据湖）。

SLA 合规凭证：每月为客户生成不可转让的证明凭证（SBT/NFT 或 Attestation），元数据指向审计包（加密 CID）。

审计可复核：客户或第三方可独立下载审计包、复算哈希、对照链上记录，一键验真。

隐私可控：链上只存摘要（哈希/指标聚合）、不存明文；必要时对审计包做加密+密钥分享。

总体架构（最小可行版本 MVP）

边缘/网关代理（Agent）：聚合矿机数据→按 1~5 分钟分片→生成规范 JSON→计算 sha256 → 上传 IPFS（或你自家的 S3/MinIO，同时把 CID pin 到 IPFS）→调用合约写入 cid+hash+摘要。

合约层（L2 优先）：LogRegistry 负责事件/日志索引；SLAReceipt（或 EAS Attestation）负责每月证明；DeviceRegistry 记录设备/场站身份与权限。

存储：IPFS/Arweave 只放审计包/日志分片；链上保存 CID/Hash/时间戳/站点/设备/摘要指标。

索引与查询：The Graph 子图（或自建 indexer）供前端/BI 查询。

前端：你的现有仪表盘中加“可验证✅”标签页：展示链上记录、下载器、验真按钮、SLA 凭证查看。

密钥与身份：运营方/客户用机构钱包（推荐 Safe 多签）；设备侧用设备密钥或由网关代签（设备白名单）。

主链建议：以太坊 L2（Arbitrum/Optimism/Base 皆可），Gas 低、工具链成熟；先单链，减少跨链复杂度。

数据模型与“审计包”

LogRecord（离链）（做规范化，保证可重现哈希）：

{
  "version": "1.0",
  "site_id": "PA-IRONCLAD-01",
  "device_id": "S21-ABC123",
  "ts_utc": "2025-09-21T13:45:00Z",
  "metrics": {
    "hashrate_th": 188.2,
    "power_w": 3520,
    "temp_c": 72.4
  },
  "event": {
    "type": "CURTAILMENT_START",  // 正常/离线/故障/限电开始/结束...
    "reason": "grid_request",
    "expected_minutes": 45
  }
}


哈希计算：对字段排序后的 Canonical JSON做 sha256（保持可重复）。

审计包（Audit Pack）：按时间/设备打包 .tar.gz，含全部 LogRecord 与 manifest.json（列出每个分片的哈希）。打包结果再算总哈希，得到 CID。

链上保存（不含明文）：{cid, root_hash, site_id, device_id, ts, kpis}
kpis 可放聚合值：如 5min 平均算力、功率、在线标志、是否发生限电等布尔/枚举。

合约设计（精简可升级）
1) LogRegistry（日志/证据索引）

用途：写入一条“这段数据的存在证明”，并可基于 site_id/device_id/时间 查询。

// SPDX-License-Identifier: MIT
pragma solidity ^0.8.24;

import "@openzeppelin/contracts/access/AccessControl.sol";

contract LogRegistry is AccessControl {
    bytes32 public constant WRITER_ROLE = keccak256("WRITER_ROLE"); // 网关/后端
    struct LogRef {
        bytes32 rootHash;     // 审计包或分片哈希
        string  cid;          // IPFS CID
        bytes32 siteId;       // 统一编码（bytes32 存储省 Gas）
        bytes32 deviceId;
        uint64  ts;           // unix seconds
        uint32  avgHashrate;  // 例如 *10 保留1位小数
        uint32  avgPower;     // 单位W
        uint8   flags;        // bitset: online/curtailment/fault
    }
    event LogRecorded(bytes32 indexed siteId, bytes32 indexed deviceId, uint64 ts, bytes32 rootHash, string cid, uint32 avgHashrate, uint32 avgPower, uint8 flags);

    mapping(bytes32 => LogRef) public logs; // key = keccak(siteId, deviceId, ts)

    constructor(address admin) {
        _grantRole(DEFAULT_ADMIN_ROLE, admin);
    }

    function recordLog(LogRef calldata r) external onlyRole(WRITER_ROLE) {
        bytes32 key = keccak256(abi.encodePacked(r.siteId, r.deviceId, r.ts));
        require(logs[key].ts == 0, "exists");
        logs[key] = r;
        emit LogRecorded(r.siteId, r.deviceId, r.ts, r.rootHash, r.cid, r.avgHashrate, r.avgPower, r.flags);
    }
}


生产版：可加 Pausable、UUPSUpgradeable、速率限制、批量写入等。

2) SLAReceipt（按月证明，可用 SBT 或 EAS Attestation）

方案A：SBT（不可转让 ERC-721），每月 1 枚给客户地址，tokenURI 指向加密报告 CID。

方案B：**EAS（Attestation）**更轻量：定义 Schema（site_id, month, uptime, avg_hashrate, curtailment_minutes, cid, root_hash），向客户地址做一次链上背书。

初期建议 EAS：无需管理 NFT 状态、查询简单、生态成熟。

前端与验证流程（嵌进你现有平台）

写入：运营后台（或边缘网关）完成 IPFS 上传→调用 recordLog()。

展示：仪表盘“可验证”页拉取 The Graph 子图：

时间轴：显示链上事件点；

指标卡片：在线率、平均算力、限电时长（来自聚合或 EAS）。

验真：

用户点击“下载审计包”→前端重新计算哈希→对照链上 rootHash；

通过则显示绿色勾 ✅，并提供“导出审计报告 PDF”。

权限：用机构钱包登录（SIWE）；审计包加密存储（见下文“隐私”）。

隐私与加密（不泄露原始运营数据）

审计包用对称密钥加密（AES-GCM）；再用客户公钥做密钥包裹（ECIES / libsodium）。

链上只放 CID+Hash；没有密钥看不到明文。

客户在前端用钱包/公钥解包，或你给它配对的 PGP/企业证书都可。

关键安全与运维

多签：合约 DEFAULT_ADMIN_ROLE 放到 Safe（前 Gnosis Safe），至少 2/3。

写入白名单：只有你的后端/网关地址有 WRITER_ROLE。

密钥隔离：设备密钥或网关密钥放 HSM/TPM/或云 KMS；签名最小权限。

应急：Pausable + 回滚策略（仅停止写入，不会删历史）。

测试：单测（Foundry/Hardhat）、Slither 静态分析、测试网演练。

与你现有功能的“挂钩”

Curtailment 事件：发生/结束时各写一次 recordLog(flags)；SLA 月汇总里统计限电总分钟。

ROI/热力图：每次导出的报表快照打包上链（例如“9 月客户盈亏点曲线”），形成**“报告锚点”**。

客户对账：展示链上锚点 + 本地曲线，一键校验“数据未被事后改动”。

设备护照：可选做 DeviceRegistry（SBT）记录出厂/固件/维修凭证；二手验真有用，但可放二期。

里程碑（30/60/90 天落地表）

D+30（MVP 骨架）

L2 测试网部署 LogRegistry（OpenZeppelin + UUPS）。

边缘/后端：完成 Canonical JSON、哈希、IPFS 上传、合约写入。

前端：可视化时间轴 + 验真按钮（本地复算哈希）。

选定密钥管理与多签流程。

D+60（SLA 与隐私）

EAS Schema 上线，产出月度SLA 背书；

审计包加密与密钥分享；

The Graph 子图 + 指标卡片/筛选；

首家测试客户联调。

D+90（生产就绪）

主网/目标 L2 部署；

监控告警、速率限制、重试与队列；

审计 PDF 自动生成、导出；

安全复盘与小范围公示（白皮书/官网页）。

你现在可以直接做的 3 件事

确定链与工具：选定 L2（如 Base），仓库初始化（Hardhat/Foundry + OpenZeppelin）。

实现 recordLog() 链路：从你现有数据流中取 5 分钟指标 → 生成审计包 → 上链。

在仪表盘加“可验证”页：拉取链上事件 + 一键验真，给现有客户一个“眼见为实”的入口。