<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HashInsight Operations Manual</title>
    <style>
        @media print { @page { size: A4; margin: 2cm; } body { font-size: 10pt; } h1 { page-break-before: always; } h1:first-of-type { page-break-before: auto; } table { page-break-inside: avoid; } .print-button { display: none; } }
        body { font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Arial, sans-serif; line-height: 1.8; color: #333; max-width: 1000px; margin: 0 auto; padding: 40px 20px; background-color: #f9f9f9; }
        h1 { color: #2c3e50; border-bottom: 4px solid #f39c12; padding-bottom: 12px; margin-top: 40px; margin-bottom: 25px; font-size: 2.5em; }
        h1:first-of-type { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px; margin: -40px -20px 30px -20px; border-bottom: none; text-align: center; }
        h2 { color: #34495e; border-bottom: 3px solid #3498db; padding-bottom: 10px; margin-top: 35px; margin-bottom: 20px; font-size: 2em; }
        h3 { color: #555; margin-top: 28px; margin-bottom: 15px; font-size: 1.5em; border-left: 5px solid #f39c12; padding-left: 15px; }
        h4 { color: #666; margin-top: 22px; margin-bottom: 12px; font-size: 1.25em; }
        p { margin: 12px 0; text-align: justify; }
        code { background-color: #f5f5f5; padding: 3px 8px; border-radius: 4px; font-family: Consolas, Monaco, monospace; font-size: 0.9em; color: #e74c3c; border: 1px solid #e0e0e0; }
        pre { background-color: #f8f8f8; border: 1px solid #ddd; border-left: 4px solid #f39c12; padding: 20px; margin: 20px 0; overflow-x: auto; border-radius: 5px; }
        pre code { background-color: transparent; padding: 0; border: none; color: #333; }
        table { border-collapse: collapse; width: 100%; margin: 25px 0; background: white; box-shadow: 0 4px 12px rgba(0,0,0,0.1); border-radius: 8px; overflow: hidden; }
        table th { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px 12px; text-align: left; font-weight: bold; }
        table td { border: 1px solid #e0e0e0; padding: 12px; vertical-align: top; }
        table tr:nth-child(even) { background-color: #f9f9f9; }
        table tr:hover { background-color: #f0f0f0; }
        blockquote { border-left: 5px solid #3498db; padding: 15px 20px; margin: 20px 0; color: #555; background-color: #ecf0f1; border-radius: 5px; }
        ul, ol { margin: 15px 0; padding-left: 35px; }
        li { margin: 8px 0; line-height: 1.7; }
        a { color: #3498db; text-decoration: none; }
        a:hover { color: #2980b9; text-decoration: underline; }
        strong { color: #2c3e50; font-weight: 700; }
        hr { border: none; border-top: 2px solid #ecf0f1; margin: 40px 0; }
        .print-button { position: fixed; top: 20px; right: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px 24px; border: none; border-radius: 25px; cursor: pointer; font-size: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); z-index: 1000; }
        .print-button:hover { transform: scale(1.05); }
    </style>
</head>
<body>
    <button class="print-button" onclick="window.print()">ğŸ–¨ï¸ Print/Export PDF</button>
    <h1 id="hashinsight-platform-operations-manual">HashInsight Platform Operations Manual</h1>
<p><strong>Document Version:</strong> v2.0<br />
<strong>Last Updated:</strong> October 3, 2025<br />
<strong>Maintained By:</strong> HashInsight Platform Operations Team<br />
<strong>Classification:</strong> INTERNAL - CONFIDENTIAL</p>
<hr />
<h2 id="table-of-contents">ğŸ“‹ Table of Contents</h2>
<ol>
<li><a href="#chapter-1-system-architecture-overview">System Architecture Overview</a></li>
<li><a href="#chapter-2-environment-configuration">Environment Configuration</a></li>
<li><a href="#chapter-3-deployment-operations-guide">Deployment Operations Guide</a></li>
<li><a href="#chapter-4-monitoring--alerting">Monitoring &amp; Alerting</a></li>
<li><a href="#chapter-5-backup--recovery">Backup &amp; Recovery</a></li>
<li><a href="#chapter-6-security-operations">Security Operations</a></li>
<li><a href="#chapter-7-troubleshooting-guide">Troubleshooting Guide</a></li>
<li><a href="#chapter-8-daily-operations">Daily Operations</a></li>
<li><a href="#chapter-9-performance-tuning-guide">Performance Tuning Guide</a></li>
<li><a href="#chapter-10-emergency-response">Emergency Response</a></li>
<li><a href="#appendices">Appendices</a></li>
</ol>
<hr />
<h2 id="chapter-1-system-architecture-overview">Chapter 1: System Architecture Overview</h2>
<h3 id="11-technology-stack">1.1 Technology Stack</h3>
<p>HashInsight is an enterprise-grade Bitcoin mining management platform built with modern technology:</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Technology</th>
<th>Version</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Web Framework</strong></td>
<td>Flask</td>
<td>3.0+</td>
<td>Python web application framework</td>
</tr>
<tr>
<td><strong>WSGI Server</strong></td>
<td>Gunicorn</td>
<td>21.0+</td>
<td>Production-grade HTTP server</td>
</tr>
<tr>
<td><strong>Database</strong></td>
<td>PostgreSQL</td>
<td>15+</td>
<td>Primary data storage (Neon hosted)</td>
</tr>
<tr>
<td><strong>Cache</strong></td>
<td>Redis / Memory Cache</td>
<td>7.0+</td>
<td>Performance optimization layer</td>
</tr>
<tr>
<td><strong>Blockchain</strong></td>
<td>Web3.py + Base L2</td>
<td>-</td>
<td>Blockchain integration</td>
</tr>
<tr>
<td><strong>Encryption</strong></td>
<td>Cryptography</td>
<td>41.0+</td>
<td>Enterprise-grade encryption</td>
</tr>
</tbody>
</table>
<h3 id="12-module-architecture">1.2 Module Architecture</h3>
<p>The system uses a <strong>fully page-isolated architecture</strong> with independently deployed modules:</p>
<div class="codehilite"><pre><span></span><code>HashInsight Platform
â”œâ”€â”€ Core Application (main.py + app.py)
â”‚   â”œâ”€â”€ Authentication &amp; Authorization
â”‚   â”œâ”€â”€ Session Management
â”‚   â””â”€â”€ Security Middleware
â”‚
â”œâ”€â”€ Mining Management Module
â”‚   â”œâ”€â”€ Miner Dashboard
â”‚   â”œâ”€â”€ Batch Calculator
â”‚   â””â”€â”€ Analytics Engine
â”‚
â”œâ”€â”€ CRM &amp; Client Module
â”‚   â”œâ”€â”€ Customer Management
â”‚   â”œâ”€â”€ Billing System
â”‚   â””â”€â”€ Subscription Management
â”‚
â”œâ”€â”€ Blockchain Integration Module
â”‚   â”œâ”€â”€ SLA NFT Management
â”‚   â”œâ”€â”€ Verifiable Computing
â”‚   â””â”€â”€ Trust Reconciliation
â”‚
â””â”€â”€ Admin &amp; Analytics Module
    â”œâ”€â”€ Market Data Analysis
    â”œâ”€â”€ Performance Monitoring
    â””â”€â”€ Reporting System
</code></pre></div>

<h3 id="13-enterprise-upgrade-achievements">1.3 Enterprise Upgrade Achievements</h3>
<h4 id="security-enhancements">ğŸ” Security Enhancements</h4>
<ul>
<li><strong>KMS Key Management</strong>: Support for AWS KMS, GCP KMS, Azure Key Vault</li>
<li><strong>mTLS Mutual Authentication</strong>: Client certificate validation, CRL/OCSP checking</li>
<li><strong>API Key System</strong>: Secure keys based on <code>hsi_dev_key_*</code> format</li>
<li><strong>WireGuard VPN</strong>: Enterprise-grade network isolation</li>
<li><strong>Audit Logging</strong>: SOC 2 / PCI DSS / GDPR compliant</li>
</ul>
<h4 id="slo-monitoring">ğŸ“Š SLO Monitoring</h4>
<ul>
<li><strong>Availability</strong>: â‰¥99.95% (error budget â‰¤21.6 minutes/month)</li>
<li><strong>Latency</strong>: p95 â‰¤250ms</li>
<li><strong>Error Rate</strong>: â‰¤0.1%</li>
<li><strong>Prometheus Metrics</strong>: Comprehensive performance monitoring</li>
<li><strong>Circuit Breakers</strong>: Prevent cascading failures</li>
</ul>
<h4 id="performance-optimization">âš¡ Performance Optimization</h4>
<ul>
<li><strong>Request Coalescing</strong>: 9.8x performance improvement</li>
<li><strong>Multi-tier Caching</strong>: Redis + memory cache</li>
<li><strong>Connection Pooling</strong>: PostgreSQL connection optimization</li>
<li><strong>Batch Processing</strong>: Support for 5000+ concurrent miner imports</li>
</ul>
<h3 id="14-deployment-topology">1.4 Deployment Topology</h3>
<div class="codehilite"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Load Balancer                        â”‚
â”‚                  (Replit/Cloud Provider)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Gunicorn       â”‚         â”‚  Gunicorn        â”‚
â”‚  Worker 1       â”‚         â”‚  Worker 2        â”‚
â”‚  Port 5000      â”‚         â”‚  Port 5000       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PostgreSQL     â”‚         â”‚  Redis Cache     â”‚
â”‚  (Neon Hosted)  â”‚         â”‚  (Optional)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<hr />
<h2 id="chapter-2-environment-configuration">Chapter 2: Environment Configuration</h2>
<h3 id="21-required-environment-variables">2.1 Required Environment Variables</h3>
<p>These environment variables <strong>must</strong> be set, or the system will fail to start:</p>
<table>
<thead>
<tr>
<th>Variable Name</th>
<th>Type</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>DATABASE_URL</code></td>
<td>String</td>
<td>PostgreSQL connection string</td>
<td><code>postgresql://user:pass@host:5432/db</code></td>
</tr>
<tr>
<td><code>SESSION_SECRET</code></td>
<td>String</td>
<td>Flask session secret (â‰¥32 chars)</td>
<td><code>your-secure-random-secret-key-here</code></td>
</tr>
<tr>
<td><code>ENCRYPTION_PASSWORD</code></td>
<td>String</td>
<td>Data encryption master key (â‰¥32 chars)</td>
<td><code>encryption-master-key-32-chars-min</code></td>
</tr>
</tbody>
</table>
<h4 id="configuration-example">Configuration Example</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># .env file example</span>
<span class="nv">DATABASE_URL</span><span class="o">=</span>postgresql://hashinsight_user:secure_password@neon-host.us-east-1.aws.neon.tech:5432/hashinsight_db
<span class="nv">SESSION_SECRET</span><span class="o">=</span>generate_with_python_secrets_token_urlsafe_32
<span class="nv">ENCRYPTION_PASSWORD</span><span class="o">=</span>generate_with_python_secrets_token_urlsafe_32
</code></pre></div>

<h4 id="generate-secure-keys">Generate Secure Keys</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Generate secure random keys using Python</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">secrets</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SESSION_SECRET=</span><span class="si">{</span><span class="n">secrets</span><span class="o">.</span><span class="n">token_urlsafe</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ENCRYPTION_PASSWORD=</span><span class="si">{</span><span class="n">secrets</span><span class="o">.</span><span class="n">token_urlsafe</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="22-blockchain-integration-configuration">2.2 Blockchain Integration Configuration</h3>
<table>
<thead>
<tr>
<th>Variable Name</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>BLOCKCHAIN_ENABLED</code></td>
<td>Boolean</td>
<td><code>false</code></td>
<td>Enable blockchain features</td>
</tr>
<tr>
<td><code>BLOCKCHAIN_PRIVATE_KEY</code></td>
<td>String</td>
<td>-</td>
<td>Ethereum private key (0x prefix)</td>
</tr>
<tr>
<td><code>BLOCKCHAIN_NETWORK</code></td>
<td>String</td>
<td><code>base-sepolia</code></td>
<td>Blockchain network</td>
</tr>
<tr>
<td><code>BASE_RPC_URL</code></td>
<td>String</td>
<td><code>https://sepolia.base.org</code></td>
<td>Base L2 RPC endpoint</td>
</tr>
</tbody>
</table>
<div class="codehilite"><pre><span></span><code><span class="c1"># Blockchain configuration example</span>
<span class="nv">BLOCKCHAIN_ENABLED</span><span class="o">=</span><span class="nb">true</span>
<span class="nv">BLOCKCHAIN_PRIVATE_KEY</span><span class="o">=</span>0x1234567890abcdef...
<span class="nv">BLOCKCHAIN_NETWORK</span><span class="o">=</span>base-sepolia
</code></pre></div>

<h3 id="23-backup-system-configuration">2.3 Backup System Configuration</h3>
<table>
<thead>
<tr>
<th>Variable Name</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>BACKUP_DIR</code></td>
<td>String</td>
<td><code>/tmp/backups</code></td>
<td>Backup storage directory</td>
</tr>
<tr>
<td><code>BACKUP_ENCRYPTION_KEY</code></td>
<td>String</td>
<td>-</td>
<td>Backup encryption key</td>
</tr>
<tr>
<td><code>BACKUP_RETENTION_DAYS</code></td>
<td>Integer</td>
<td><code>30</code></td>
<td>Backup retention period (days)</td>
</tr>
<tr>
<td><code>BACKUP_STORAGE_TYPE</code></td>
<td>String</td>
<td><code>local</code></td>
<td>Remote storage type (s3/azure/gcs)</td>
</tr>
<tr>
<td><code>BACKUP_STORAGE_BUCKET</code></td>
<td>String</td>
<td>-</td>
<td>Remote storage bucket name</td>
</tr>
</tbody>
</table>
<div class="codehilite"><pre><span></span><code><span class="c1"># AWS S3 backup configuration</span>
<span class="nv">BACKUP_DIR</span><span class="o">=</span>/var/backups/hashinsight
<span class="nv">BACKUP_ENCRYPTION_KEY</span><span class="o">=</span>backup-encryption-key-32-chars
<span class="nv">BACKUP_RETENTION_DAYS</span><span class="o">=</span><span class="m">30</span>
<span class="nv">BACKUP_STORAGE_TYPE</span><span class="o">=</span>s3
<span class="nv">BACKUP_STORAGE_BUCKET</span><span class="o">=</span>hashinsight-backups
<span class="nv">BACKUP_STORAGE_REGION</span><span class="o">=</span>us-east-1
<span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=</span>AKIAXXXXXXXX
<span class="nv">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span>xxxxxxxxxx
</code></pre></div>

<h3 id="24-kms-key-management-configuration">2.4 KMS Key Management Configuration</h3>
<h4 id="aws-kms">AWS KMS</h4>
<div class="codehilite"><pre><span></span><code><span class="nv">AWS_KMS_KEY_ID</span><span class="o">=</span>arn:aws:kms:us-east-1:123456789:key/xxxxx
<span class="nv">AWS_KMS_REGION</span><span class="o">=</span>us-east-1
<span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=</span>AKIAXXXXXXXX
<span class="nv">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span>xxxxxxxxxx
</code></pre></div>

<h4 id="gcp-kms">GCP KMS</h4>
<div class="codehilite"><pre><span></span><code><span class="nv">GCP_KMS_PROJECT_ID</span><span class="o">=</span>hashinsight-prod
<span class="nv">GCP_KMS_LOCATION</span><span class="o">=</span>us-east1
<span class="nv">GCP_KMS_KEYRING</span><span class="o">=</span>hashinsight-keyring
<span class="nv">GCP_KMS_KEY_ID</span><span class="o">=</span>encryption-key
<span class="nv">GOOGLE_APPLICATION_CREDENTIALS</span><span class="o">=</span>/path/to/service-account.json
</code></pre></div>

<h4 id="azure-key-vault">Azure Key Vault</h4>
<div class="codehilite"><pre><span></span><code><span class="nv">AZURE_KEY_VAULT_URL</span><span class="o">=</span>https://hashinsight-vault.vault.azure.net/
<span class="nv">AZURE_TENANT_ID</span><span class="o">=</span>xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
<span class="nv">AZURE_CLIENT_ID</span><span class="o">=</span>xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
<span class="nv">AZURE_CLIENT_SECRET</span><span class="o">=</span>xxxxxxxxxx
</code></pre></div>

<h3 id="25-monitoring-and-performance-configuration">2.5 Monitoring and Performance Configuration</h3>
<table>
<thead>
<tr>
<th>Variable Name</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ENABLE_BACKGROUND_SERVICES</code></td>
<td>Boolean</td>
<td><code>false</code></td>
<td>Enable background data collection (must explicitly set to '1' to enable)</td>
</tr>
<tr>
<td><code>PROMETHEUS_PORT</code></td>
<td>Integer</td>
<td><code>9090</code></td>
<td>Prometheus export port</td>
</tr>
<tr>
<td><code>SLO_MEASUREMENT_WINDOW</code></td>
<td>Integer</td>
<td><code>30</code></td>
<td>SLO measurement window (minutes)</td>
</tr>
</tbody>
</table>
<p><strong>Note</strong>: <code>FAST_STARTUP</code> mode is hardcoded in <code>main.py</code>, not configured through environment variables. See Section 3.4.</p>
<h3 id="26-external-api-configuration">2.6 External API Configuration</h3>
<table>
<thead>
<tr>
<th>Variable Name</th>
<th>Description</th>
<th>How to Obtain</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>COINWARZ_API_KEY</code></td>
<td>CoinWarz mining data API</td>
<td>https://www.coinwarz.com/api</td>
</tr>
<tr>
<td><code>COINGECKO_API_KEY</code></td>
<td>CoinGecko price API</td>
<td>https://www.coingecko.com/api</td>
</tr>
<tr>
<td><code>SENDGRID_API_KEY</code></td>
<td>SendGrid email service</td>
<td>https://sendgrid.com</td>
</tr>
</tbody>
</table>
<h3 id="27-configuration-file-locations">2.7 Configuration File Locations</h3>
<div class="codehilite"><pre><span></span><code><span class="n">HashInsight</span><span class="o">/</span>
<span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">config</span><span class="o">.</span><span class="n">py</span><span class="w">                    </span><span class="c1"># Main configuration file (single source of truth)</span>
<span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="o">.</span><span class="n">env</span><span class="w">                         </span><span class="c1"># Environment variables (not committed to Git)</span>
<span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">example</span><span class="w">                 </span><span class="c1"># Environment variable template</span>
<span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">replit</span><span class="o">.</span><span class="n">md</span><span class="w">                   </span><span class="c1"># System architecture documentation</span>
</code></pre></div>

<h3 id="28-configuration-validation">2.8 Configuration Validation</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check required environment variables</span>
python<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;</span>
<span class="s2">import os</span>
<span class="s2">required = [&#39;DATABASE_URL&#39;, &#39;SESSION_SECRET&#39;, &#39;ENCRYPTION_PASSWORD&#39;]</span>
<span class="s2">missing = [v for v in required if not os.getenv(v)]</span>
<span class="s2">if missing:</span>
<span class="s2">    print(f&#39;âŒ Missing: {missing}&#39;)</span>
<span class="s2">    exit(1)</span>
<span class="s2">print(&#39;âœ… All required variables set&#39;)</span>
<span class="s2">&quot;</span>
</code></pre></div>

<hr />
<h2 id="chapter-3-deployment-operations-guide">Chapter 3: Deployment Operations Guide</h2>
<h3 id="31-startup-commands">3.1 Startup Commands</h3>
<h4 id="standard-startup-production-environment">Standard Startup (Production Environment)</h4>
<div class="codehilite"><pre><span></span><code>gunicorn<span class="w"> </span>--bind<span class="w"> </span><span class="m">0</span>.0.0.0:5000<span class="w"> </span>--reuse-port<span class="w"> </span>--reload<span class="w"> </span>main:app
</code></pre></div>

<h4 id="parameter-explanation">Parameter Explanation</h4>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>--bind 0.0.0.0:5000</code></td>
<td>Bind to all network interfaces, port 5000 (Replit required)</td>
</tr>
<tr>
<td><code>--reuse-port</code></td>
<td>Allow multiple workers to bind to same port</td>
</tr>
<tr>
<td><code>--reload</code></td>
<td>Auto-reload on code changes (development)</td>
</tr>
<tr>
<td><code>--workers 4</code></td>
<td>Number of worker processes (CPU cores Ã— 2 + 1)</td>
</tr>
<tr>
<td><code>--timeout 120</code></td>
<td>Worker timeout (seconds)</td>
</tr>
</tbody>
</table>
<h4 id="complete-production-startup">Complete Production Startup</h4>
<div class="codehilite"><pre><span></span><code>gunicorn<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--bind<span class="w"> </span><span class="m">0</span>.0.0.0:5000<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--workers<span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--threads<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--worker-class<span class="w"> </span>gthread<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--timeout<span class="w"> </span><span class="m">120</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--max-requests<span class="w"> </span><span class="m">1000</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--max-requests-jitter<span class="w"> </span><span class="m">50</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--access-logfile<span class="w"> </span>-<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--error-logfile<span class="w"> </span>-<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--log-level<span class="w"> </span>info<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--preload<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>main:app
</code></pre></div>

<h3 id="32-port-configuration">3.2 Port Configuration</h3>
<p><strong>âš ï¸ Important</strong>: Frontend application <strong>must</strong> bind to port 5000</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check port usage</span>
lsof<span class="w"> </span>-i<span class="w"> </span>:5000

<span class="c1"># Force kill occupying process</span>
<span class="nb">kill</span><span class="w"> </span>-9<span class="w"> </span><span class="k">$(</span>lsof<span class="w"> </span>-t<span class="w"> </span>-i:5000<span class="k">)</span>
</code></pre></div>

<h3 id="33-health-checks">3.3 Health Checks</h3>
<p>The system provides health check endpoints for monitoring:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Basic health check</span>
curl<span class="w"> </span>http://localhost:5000/health

<span class="c1"># Detailed health check (includes database status)</span>
curl<span class="w"> </span>http://localhost:5000/health/detailed

<span class="c1"># Expected response</span>
<span class="o">{</span>
<span class="w">  </span><span class="s2">&quot;status&quot;</span>:<span class="w"> </span><span class="s2">&quot;healthy&quot;</span>,
<span class="w">  </span><span class="s2">&quot;timestamp&quot;</span>:<span class="w"> </span><span class="s2">&quot;2025-10-03T12:00:00Z&quot;</span>,
<span class="w">  </span><span class="s2">&quot;database&quot;</span>:<span class="w"> </span><span class="s2">&quot;connected&quot;</span>,
<span class="w">  </span><span class="s2">&quot;cache&quot;</span>:<span class="w"> </span><span class="s2">&quot;available&quot;</span>,
<span class="w">  </span><span class="s2">&quot;version&quot;</span>:<span class="w"> </span><span class="s2">&quot;2.0.0&quot;</span>
<span class="o">}</span>
</code></pre></div>

<h3 id="34-fast-startup-mode">3.4 Fast Startup Mode</h3>
<p>HashInsight's fast startup mode is <strong>hardcoded in <code>main.py</code></strong> as a built-in behavior, not managed through <code>config.py</code>.</p>
<h4 id="implementation-location">Implementation Location</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Hardcoded implementation in main.py</span>
<span class="n">fast_startup</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;FAST_STARTUP&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="s2">&quot;yes&quot;</span><span class="p">)</span>  <span class="c1"># Default: enabled</span>
<span class="n">skip_db_check</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SKIP_DATABASE_HEALTH_CHECK&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="s2">&quot;yes&quot;</span><span class="p">)</span>  <span class="c1"># Default: enabled</span>
</code></pre></div>

<h4 id="control-method-optional-environment-variables">Control Method (Optional Environment Variables)</h4>
<p>Although these variables are not defined in <code>config.py</code>, they can be temporarily adjusted via environment variables:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Enable fast startup (default behavior, no need to set)</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">FAST_STARTUP</span><span class="o">=</span><span class="m">1</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">SKIP_DATABASE_HEALTH_CHECK</span><span class="o">=</span><span class="m">1</span>

<span class="c1"># Disable fast startup (full initialization)</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">FAST_STARTUP</span><span class="o">=</span><span class="m">0</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">SKIP_DATABASE_HEALTH_CHECK</span><span class="o">=</span><span class="m">0</span>
</code></pre></div>

<p><strong>âš ï¸ Important Note</strong>:
- These variables are <strong>not in the <code>config.py</code> single source of truth</strong>
- They are temporary control switches for the <code>main.py</code> startup script
- Production configuration should be managed through <code>config.py</code></p>
<h4 id="fast-startup-behavior">Fast Startup Behavior</h4>
<p>When enabled (default):
1. Main application starts immediately (2-3 seconds)
2. Background services delayed 5 seconds (if <code>ENABLE_BACKGROUND_SERVICES=1</code>)
3. Database health checks skipped
4. Suitable for CI/CD rapid deployment</p>
<p>When disabled:
1. Full database health check
2. Synchronous startup of all services
3. Longer startup time (10-15 seconds)
4. Suitable for initial production deployment</p>
<h3 id="35-database-migration">3.5 Database Migration</h3>
<p><strong>âš ï¸ Important</strong>: System uses ORM auto-migration, <strong>avoid manual SQL operations</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Database tables created automatically on application startup</span>
<span class="c1"># See db.create_all() in app.py</span>

<span class="c1"># Manually trigger migration if needed</span>
python<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;from app import app, db; app.app_context().push(); db.create_all()&quot;</span>
</code></pre></div>

<h3 id="36-rolling-deployment-strategy">3.6 Rolling Deployment Strategy</h3>
<h4 id="canary-deployment-process">Canary Deployment Process</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Step 1: Deploy new version to Canary instance</span>
<span class="c1"># Only 1 worker runs new version</span>
gunicorn<span class="w"> </span>--bind<span class="w"> </span><span class="m">0</span>.0.0.0:5001<span class="w"> </span>--workers<span class="w"> </span><span class="m">1</span><span class="w"> </span>main:app

<span class="c1"># Step 2: Monitor Canary instance (5-10 minutes)</span>
watch<span class="w"> </span>-n<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="s1">&#39;curl -s http://localhost:5001/health | jq&#39;</span>

<span class="c1"># Step 3: Gradually shift traffic</span>
<span class="c1"># Use load balancer to adjust weights: old(90%) -&gt; new(10%)</span>
<span class="c1"># Monitor error rate and latency</span>

<span class="c1"># Step 4: Full cutover</span>
<span class="c1"># old(0%) -&gt; new(100%)</span>
killall<span class="w"> </span>-9<span class="w"> </span>gunicorn<span class="w">  </span><span class="c1"># Stop old version</span>
gunicorn<span class="w"> </span>--bind<span class="w"> </span><span class="m">0</span>.0.0.0:5000<span class="w"> </span>--workers<span class="w"> </span><span class="m">4</span><span class="w"> </span>main:app<span class="w">  </span><span class="c1"># Start new version</span>
</code></pre></div>

<h3 id="37-graceful-shutdown">3.7 Graceful Shutdown</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Send SIGTERM signal (graceful shutdown)</span>
<span class="nb">kill</span><span class="w"> </span>-TERM<span class="w"> </span><span class="k">$(</span>cat<span class="w"> </span>/var/run/gunicorn.pid<span class="k">)</span>

<span class="c1"># Wait 30 seconds to process existing requests</span>
sleep<span class="w"> </span><span class="m">30</span>

<span class="c1"># Force stop (if still running)</span>
<span class="nb">kill</span><span class="w"> </span>-KILL<span class="w"> </span><span class="k">$(</span>cat<span class="w"> </span>/var/run/gunicorn.pid<span class="k">)</span>
</code></pre></div>

<h3 id="38-log-management">3.8 Log Management</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Enable structured logging at startup</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">LOG_LEVEL</span><span class="o">=</span>INFO
<span class="nb">export</span><span class="w"> </span><span class="nv">LOG_FORMAT</span><span class="o">=</span>json

<span class="c1"># View real-time logs</span>
tail<span class="w"> </span>-f<span class="w"> </span>/var/log/hashinsight/app.log

<span class="c1"># View error logs</span>
grep<span class="w"> </span>ERROR<span class="w"> </span>/var/log/hashinsight/app.log<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-20

<span class="c1"># Replit environment logs</span>
<span class="c1"># Logs output to stdout, view through Replit Console</span>
</code></pre></div>

<h3 id="39-deployment-checklist">3.9 Deployment Checklist</h3>
<ul>
<li>[ ] Environment variables configured (DATABASE_URL, SESSION_SECRET, ENCRYPTION_PASSWORD)</li>
<li>[ ] Database connection working</li>
<li>[ ] Port 5000 available</li>
<li>[ ] Health check endpoint returns 200</li>
<li>[ ] Audit log directory writable (<code>logs/audit.jsonl</code>)</li>
<li>[ ] Backup directory created</li>
<li>[ ] SSL certificates valid (if mTLS enabled)</li>
<li>[ ] KMS keys accessible (if enabled)</li>
<li>[ ] Prometheus metrics accessible (<code>:9090/metrics</code>)</li>
</ul>
<hr />
<h2 id="chapter-4-monitoring-alerting">Chapter 4: Monitoring &amp; Alerting</h2>
<h3 id="41-slo-definitions">4.1 SLO Definitions</h3>
<p>HashInsight follows strict SLO standards:</p>
<h4 id="availability-slo">Availability SLO</h4>
<table>
<thead>
<tr>
<th>Metric</th>
<th>Target</th>
<th>Error Budget</th>
<th>Measurement Period</th>
</tr>
</thead>
<tbody>
<tr>
<td>Availability</td>
<td>â‰¥99.95%</td>
<td>â‰¤21.6 minutes/month</td>
<td>30-day rolling</td>
</tr>
<tr>
<td>Success Rate</td>
<td>â‰¥99.9%</td>
<td>â‰¤43.2 minutes/month</td>
<td>30-day rolling</td>
</tr>
</tbody>
</table>
<h4 id="latency-slo">Latency SLO</h4>
<table>
<thead>
<tr>
<th>Percentile</th>
<th>Target</th>
<th>Measurement Window</th>
</tr>
</thead>
<tbody>
<tr>
<td>P50</td>
<td>â‰¤100ms</td>
<td>5 minutes</td>
</tr>
<tr>
<td>P95</td>
<td>â‰¤250ms</td>
<td>5 minutes</td>
</tr>
<tr>
<td>P99</td>
<td>â‰¤500ms</td>
<td>5 minutes</td>
</tr>
</tbody>
</table>
<h4 id="error-rate-slo">Error Rate SLO</h4>
<table>
<thead>
<tr>
<th>Type</th>
<th>Target</th>
<th>Threshold</th>
</tr>
</thead>
<tbody>
<tr>
<td>4xx errors</td>
<td>â‰¤1%</td>
<td>Warning</td>
</tr>
<tr>
<td>5xx errors</td>
<td>â‰¤0.1%</td>
<td>Critical</td>
</tr>
</tbody>
</table>
<h3 id="42-prometheus-metrics">4.2 Prometheus Metrics</h3>
<h4 id="system-metrics-export">System Metrics Export</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># monitoring/prometheus_exporter.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">prometheus_client</span><span class="w"> </span><span class="kn">import</span> <span class="n">Counter</span><span class="p">,</span> <span class="n">Histogram</span><span class="p">,</span> <span class="n">Gauge</span>

<span class="c1"># Request count</span>
<span class="n">request_count</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span>
    <span class="s1">&#39;hashinsight_requests_total&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Total request count&#39;</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="s1">&#39;endpoint&#39;</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Request latency</span>
<span class="n">request_latency</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">(</span>
    <span class="s1">&#39;hashinsight_request_latency_seconds&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Request latency&#39;</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="s1">&#39;endpoint&#39;</span><span class="p">],</span>
    <span class="n">buckets</span><span class="o">=</span><span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Cache hit rate</span>
<span class="n">cache_hit_rate</span> <span class="o">=</span> <span class="n">Gauge</span><span class="p">(</span>
    <span class="s1">&#39;hashinsight_cache_hit_rate&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Cache hit rate percentage&#39;</span>
<span class="p">)</span>

<span class="c1"># Database query duration</span>
<span class="n">db_query_duration</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">(</span>
    <span class="s1">&#39;hashinsight_db_query_duration_seconds&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Database query duration&#39;</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">&#39;query_type&#39;</span><span class="p">],</span>
    <span class="n">buckets</span><span class="o">=</span><span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># SLO compliance</span>
<span class="n">slo_compliance</span> <span class="o">=</span> <span class="n">Gauge</span><span class="p">(</span>
    <span class="s1">&#39;hashinsight_slo_compliance&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SLO compliance percentage&#39;</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">&#39;slo_type&#39;</span><span class="p">]</span>
<span class="p">)</span>
</code></pre></div>

<h4 id="metrics-access">Metrics Access</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># View Prometheus metrics</span>
curl<span class="w"> </span>http://localhost:9090/metrics

<span class="c1"># Example output</span>
<span class="c1"># HELP hashinsight_requests_total Total request count</span>
<span class="c1"># TYPE hashinsight_requests_total counter</span>
hashinsight_requests_total<span class="o">{</span><span class="nv">method</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span>,endpoint<span class="o">=</span><span class="s2">&quot;/dashboard&quot;</span>,status<span class="o">=</span><span class="s2">&quot;200&quot;</span><span class="o">}</span><span class="w"> </span><span class="m">1234</span>

<span class="c1"># HELP hashinsight_request_latency_seconds Request latency</span>
<span class="c1"># TYPE hashinsight_request_latency_seconds histogram</span>
hashinsight_request_latency_seconds_bucket<span class="o">{</span><span class="nv">method</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span>,endpoint<span class="o">=</span><span class="s2">&quot;/api/miners&quot;</span>,le<span class="o">=</span><span class="s2">&quot;0.1&quot;</span><span class="o">}</span><span class="w"> </span><span class="m">450</span>
hashinsight_request_latency_seconds_bucket<span class="o">{</span><span class="nv">method</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span>,endpoint<span class="o">=</span><span class="s2">&quot;/api/miners&quot;</span>,le<span class="o">=</span><span class="s2">&quot;0.25&quot;</span><span class="o">}</span><span class="w"> </span><span class="m">480</span>
</code></pre></div>

<h3 id="43-grafana-dashboard">4.3 Grafana Dashboard</h3>
<h4 id="core-monitoring-panels">Core Monitoring Panels</h4>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;dashboard&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;HashInsight Production Monitoring&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;panels&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Request Rate&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;targets&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">          </span><span class="nt">&quot;expr&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;rate(hashinsight_requests_total[5m])&quot;</span>
<span class="w">        </span><span class="p">}]</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;P95 Latency&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;targets&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">          </span><span class="nt">&quot;expr&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;histogram_quantile(0.95, rate(hashinsight_request_latency_seconds_bucket[5m]))&quot;</span>
<span class="w">        </span><span class="p">}]</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Error Rate&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;targets&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">          </span><span class="nt">&quot;expr&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;rate(hashinsight_requests_total{status=~\&quot;5..\&quot;}[5m]) / rate(hashinsight_requests_total[5m])&quot;</span>
<span class="w">        </span><span class="p">}]</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SLO Compliance&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;targets&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">          </span><span class="nt">&quot;expr&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;hashinsight_slo_compliance&quot;</span>
<span class="w">        </span><span class="p">}]</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="44-alert-rules">4.4 Alert Rules</h3>
<h4 id="prometheus-alert-rules">Prometheus Alert Rules</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># prometheus/alerts.yml</span>
<span class="nt">groups</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hashinsight_alerts</span>
<span class="w">    </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
<span class="w">    </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">      </span><span class="c1"># Availability alert</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HighErrorRate</span>
<span class="w">        </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">rate(hashinsight_requests_total{status=~&quot;5..&quot;}[5m]) </span>
<span class="w">          </span><span class="no">/ rate(hashinsight_requests_total[5m]) &gt; 0.01</span>
<span class="w">        </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<span class="w">        </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">          </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">critical</span>
<span class="w">        </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">          </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;High</span><span class="nv"> </span><span class="s">5xx</span><span class="nv"> </span><span class="s">error</span><span class="nv"> </span><span class="s">rate</span><span class="nv"> </span><span class="s">detected&quot;</span>
<span class="w">          </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Error</span><span class="nv"> </span><span class="s">rate</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$value</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">humanizePercentage</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="w">      </span><span class="c1"># Latency alert</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HighLatency</span>
<span class="w">        </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">histogram_quantile(0.95, </span>
<span class="w">            </span><span class="no">rate(hashinsight_request_latency_seconds_bucket[5m])</span>
<span class="w">          </span><span class="no">) &gt; 0.25</span>
<span class="w">        </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10m</span>
<span class="w">        </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">          </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">warning</span>
<span class="w">        </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">          </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;P95</span><span class="nv"> </span><span class="s">latency</span><span class="nv"> </span><span class="s">exceeds</span><span class="nv"> </span><span class="s">SLO&quot;</span>
<span class="w">          </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;P95</span><span class="nv"> </span><span class="s">latency</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$value</span><span class="nv"> </span><span class="s">}}s</span><span class="nv"> </span><span class="s">(SLO:</span><span class="nv"> </span><span class="s">0.25s)&quot;</span>

<span class="w">      </span><span class="c1"># SLO error budget alert</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ErrorBudgetExhausted</span>
<span class="w">        </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hashinsight_slo_error_budget_remaining &lt; 0.1</span>
<span class="w">        </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<span class="w">        </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">          </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">critical</span>
<span class="w">        </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">          </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;SLO</span><span class="nv"> </span><span class="s">error</span><span class="nv"> </span><span class="s">budget</span><span class="nv"> </span><span class="s">nearly</span><span class="nv"> </span><span class="s">exhausted&quot;</span>
<span class="w">          </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Only</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$value</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">humanizePercentage</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">budget</span><span class="nv"> </span><span class="s">remaining&quot;</span>

<span class="w">      </span><span class="c1"># Database connection alert</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DatabaseConnectionFailure</span>
<span class="w">        </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hashinsight_db_connection_status == 0</span>
<span class="w">        </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2m</span>
<span class="w">        </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">          </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">critical</span>
<span class="w">        </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">          </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Database</span><span class="nv"> </span><span class="s">connection</span><span class="nv"> </span><span class="s">failure&quot;</span>
<span class="w">          </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Unable</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">connect</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">PostgreSQL&quot;</span>

<span class="w">      </span><span class="c1"># Cache hit rate alert</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LowCacheHitRate</span>
<span class="w">        </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hashinsight_cache_hit_rate &lt; 50</span>
<span class="w">        </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15m</span>
<span class="w">        </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">          </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">warning</span>
<span class="w">        </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">          </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Low</span><span class="nv"> </span><span class="s">cache</span><span class="nv"> </span><span class="s">hit</span><span class="nv"> </span><span class="s">rate&quot;</span>
<span class="w">          </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Cache</span><span class="nv"> </span><span class="s">hit</span><span class="nv"> </span><span class="s">rate</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$value</span><span class="nv"> </span><span class="s">}}%&quot;</span>
</code></pre></div>

<h3 id="45-circuit-breaker-configuration">4.5 Circuit Breaker Configuration</h3>
<p>HashInsight uses circuit breaker pattern to prevent cascading failures:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># monitoring/circuit_breaker.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">monitoring.circuit_breaker</span><span class="w"> </span><span class="kn">import</span> <span class="n">CircuitBreaker</span><span class="p">,</span> <span class="n">circuit_breaker</span>

<span class="c1"># Database query circuit breaker</span>
<span class="n">db_breaker</span> <span class="o">=</span> <span class="n">CircuitBreaker</span><span class="p">(</span>
    <span class="n">failure_threshold</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>      <span class="c1"># Trigger after 5 consecutive failures</span>
    <span class="n">recovery_timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>      <span class="c1"># Attempt recovery after 60 seconds</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;database_queries&quot;</span>
<span class="p">)</span>

<span class="c1"># API call circuit breaker</span>
<span class="nd">@circuit_breaker</span><span class="p">(</span>
    <span class="n">failure_threshold</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">recovery_timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;external_api&quot;</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">call_external_api</span><span class="p">():</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://api.coinwarz.com/...&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</code></pre></div>

<h4 id="circuit-breaker-status-monitoring">Circuit Breaker Status Monitoring</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># View circuit breaker status</span>
curl<span class="w"> </span>http://localhost:5000/api/circuit-breakers

<span class="c1"># Response example</span>
<span class="o">{</span>
<span class="w">  </span><span class="s2">&quot;database_queries&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;state&quot;</span>:<span class="w"> </span><span class="s2">&quot;closed&quot;</span>,
<span class="w">    </span><span class="s2">&quot;failure_count&quot;</span>:<span class="w"> </span><span class="m">0</span>,
<span class="w">    </span><span class="s2">&quot;total_calls&quot;</span>:<span class="w"> </span><span class="m">1234</span>,
<span class="w">    </span><span class="s2">&quot;success_rate&quot;</span>:<span class="w"> </span><span class="s2">&quot;99.8%&quot;</span>
<span class="w">  </span><span class="o">}</span>,
<span class="w">  </span><span class="s2">&quot;external_api&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;state&quot;</span>:<span class="w"> </span><span class="s2">&quot;half_open&quot;</span>,
<span class="w">    </span><span class="s2">&quot;failure_count&quot;</span>:<span class="w"> </span><span class="m">3</span>,
<span class="w">    </span><span class="s2">&quot;total_calls&quot;</span>:<span class="w"> </span><span class="m">456</span>,
<span class="w">    </span><span class="s2">&quot;success_rate&quot;</span>:<span class="w"> </span><span class="s2">&quot;95.2%&quot;</span>
<span class="w">  </span><span class="o">}</span>
<span class="o">}</span>
</code></pre></div>

<h3 id="46-alert-notifications">4.6 Alert Notifications</h3>
<h4 id="slack-integration">Slack Integration</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Environment variable configuration</span>
<span class="nv">SLACK_WEBHOOK_URL</span><span class="o">=</span>https://hooks.slack.com/services/T00/B00/xxxxx
<span class="nv">ALERT_SLACK_CHANNEL</span><span class="o">=</span><span class="c1">#hashinsight-alerts</span>
</code></pre></div>

<h4 id="pagerduty-integration">PagerDuty Integration</h4>
<div class="codehilite"><pre><span></span><code><span class="nv">PAGERDUTY_API_KEY</span><span class="o">=</span>xxxxx
<span class="nv">PAGERDUTY_SERVICE_KEY</span><span class="o">=</span>xxxxx
</code></pre></div>

<h3 id="47-monitoring-checklist">4.7 Monitoring Checklist</h3>
<ul>
<li>[ ] Prometheus scraping metrics (<code>:9090/targets</code>)</li>
<li>[ ] Grafana dashboard displaying data</li>
<li>[ ] Alert rules loaded</li>
<li>[ ] Slack/PagerDuty notifications working</li>
<li>[ ] SLO monitoring panel shows green</li>
<li>[ ] Circuit breaker status normal</li>
</ul>
<hr />
<h2 id="chapter-5-backup-recovery">Chapter 5: Backup &amp; Recovery</h2>
<h3 id="51-automated-backup-strategy">5.1 Automated Backup Strategy</h3>
<p>HashInsight uses <code>backup/backup_manager.py</code> for automated backups:</p>
<h4 id="backup-features">Backup Features</h4>
<ul>
<li>âœ… <strong>PostgreSQL full backup</strong> (pg_dump)</li>
<li>âœ… <strong>AES-256 encryption</strong> (backup file encryption)</li>
<li>âœ… <strong>gzip compression</strong> (save storage space)</li>
<li>âœ… <strong>Remote storage</strong> (S3/Azure/GCS support)</li>
<li>âœ… <strong>Integrity verification</strong> (SHA256 checksum)</li>
</ul>
<h4 id="backup-scheduling">Backup Scheduling</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Configure automatic backups via cron</span>
<span class="c1"># /etc/cron.d/hashinsight-backup</span>

<span class="c1"># Daily full backup at 2 AM</span>
<span class="m">0</span><span class="w"> </span><span class="m">2</span><span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>/usr/bin/python3<span class="w"> </span>/app/backup/backup_manager.py<span class="w"> </span>--type<span class="w"> </span>full

<span class="c1"># Incremental backup every 4 hours</span>
<span class="m">0</span><span class="w"> </span>*/4<span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>/usr/bin/python3<span class="w"> </span>/app/backup/backup_manager.py<span class="w"> </span>--type<span class="w"> </span>incremental

<span class="c1"># Upload to remote storage every Sunday at 3 AM</span>
<span class="m">0</span><span class="w"> </span><span class="m">3</span><span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span><span class="m">0</span><span class="w"> </span>/usr/bin/python3<span class="w"> </span>/app/backup/backup_manager.py<span class="w"> </span>--upload
</code></pre></div>

<h3 id="52-manual-backup">5.2 Manual Backup</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Execute full backup</span>
python<span class="w"> </span>backup/backup_manager.py

<span class="c1"># Backup output example</span>
âœ…<span class="w"> </span>Backup<span class="w"> </span>created<span class="w"> </span>successfully:<span class="w"> </span>hashinsight_backup_20251003_140000.sql.gz.enc
ğŸ“¦<span class="w"> </span>Size:<span class="w"> </span><span class="m">245</span>.3<span class="w"> </span>MB
ğŸ”<span class="w"> </span>Encrypted:<span class="w"> </span>AES-256
âœ…<span class="w"> </span>Checksum:<span class="w"> </span>e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855
â±ï¸<span class="w">  </span>Duration:<span class="w"> </span><span class="m">45</span>.2s
</code></pre></div>

<h3 id="53-backup-retention-policy">5.3 Backup Retention Policy</h3>
<table>
<thead>
<tr>
<th>Backup Type</th>
<th>Retention Period</th>
<th>Frequency</th>
</tr>
</thead>
<tbody>
<tr>
<td>Full backup</td>
<td>30 days</td>
<td>Daily</td>
</tr>
<tr>
<td>Incremental backup</td>
<td>7 days</td>
<td>Every 4 hours</td>
</tr>
<tr>
<td>Weekly backup</td>
<td>12 weeks</td>
<td>Every Sunday</td>
</tr>
<tr>
<td>Monthly backup</td>
<td>12 months</td>
<td>1st of month</td>
</tr>
</tbody>
</table>
<h4 id="automatic-cleanup-of-old-backups">Automatic Cleanup of Old Backups</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Clean up backups older than 30 days</span>
python<span class="w"> </span>backup/backup_manager.py<span class="w"> </span>--cleanup<span class="w"> </span>--days<span class="w"> </span><span class="m">30</span>

<span class="c1"># Output</span>
ğŸ—‘ï¸<span class="w">  </span>Deleting<span class="w"> </span>old<span class="w"> </span>backups:<span class="w"> </span>hashinsight_backup_20250903_*.sql.gz.enc
âœ…<span class="w"> </span>Cleanup<span class="w"> </span>complete:<span class="w"> </span><span class="m">2</span>.1<span class="w"> </span>GB<span class="w"> </span>freed
</code></pre></div>

<h3 id="54-rtorpo-targets">5.4 RTO/RPO Targets</h3>
<table>
<thead>
<tr>
<th>Metric</th>
<th>Target</th>
<th>Actual</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>RTO</strong> (Recovery Time Objective)</td>
<td>â‰¤4 hours</td>
<td>~2 hours</td>
</tr>
<tr>
<td><strong>RPO</strong> (Recovery Point Objective)</td>
<td>â‰¤15 minutes</td>
<td>~4 hours</td>
</tr>
</tbody>
</table>
<h3 id="55-backup-recovery-process">5.5 Backup Recovery Process</h3>
<h4 id="step-1-list-available-backups">Step 1: List Available Backups</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># List local backups</span>
ls<span class="w"> </span>-lh<span class="w"> </span>/tmp/backups/

<span class="c1"># List remote backups (S3)</span>
aws<span class="w"> </span>s3<span class="w"> </span>ls<span class="w"> </span>s3://hashinsight-backups/
</code></pre></div>

<h4 id="step-2-download-backup-if-remote">Step 2: Download Backup (if remote)</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Download from S3</span>
aws<span class="w"> </span>s3<span class="w"> </span>cp<span class="w"> </span>s3://hashinsight-backups/hashinsight_backup_20251003_020000.sql.gz.enc<span class="w"> </span>/tmp/restore/

<span class="c1"># Download from Azure</span>
az<span class="w"> </span>storage<span class="w"> </span>blob<span class="w"> </span>download<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--account-name<span class="w"> </span>hashinsight<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--container-name<span class="w"> </span>backups<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--name<span class="w"> </span>hashinsight_backup_20251003_020000.sql.gz.enc<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--file<span class="w"> </span>/tmp/restore/backup.sql.gz.enc
</code></pre></div>

<h4 id="step-3-decrypt-backup">Step 3: Decrypt Backup</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Decrypt using backup_manager</span>
python<span class="w"> </span>backup/backup_manager.py<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--decrypt<span class="w"> </span>/tmp/restore/hashinsight_backup_20251003_020000.sql.gz.enc<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--output<span class="w"> </span>/tmp/restore/backup.sql.gz

<span class="c1"># Manual decryption (if needed)</span>
openssl<span class="w"> </span>enc<span class="w"> </span>-d<span class="w"> </span>-aes-256-cbc<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-in<span class="w"> </span>hashinsight_backup_20251003_020000.sql.gz.enc<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-out<span class="w"> </span>backup.sql.gz<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-pass<span class="w"> </span>env:BACKUP_ENCRYPTION_KEY
</code></pre></div>

<h4 id="step-4-decompress-backup">Step 4: Decompress Backup</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Decompress</span>
gunzip<span class="w"> </span>/tmp/restore/backup.sql.gz

<span class="c1"># Verify file integrity</span>
sha256sum<span class="w"> </span>/tmp/restore/backup.sql
</code></pre></div>

<h4 id="step-5-restore-database">Step 5: Restore Database</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># âš ï¸ Warning: This will overwrite current database!</span>

<span class="c1"># 1. Stop application</span>
systemctl<span class="w"> </span>stop<span class="w"> </span>hashinsight

<span class="c1"># 2. Create emergency backup of current state</span>
python<span class="w"> </span>backup/backup_manager.py<span class="w"> </span>--type<span class="w"> </span>emergency

<span class="c1"># 3. Restore from backup</span>
psql<span class="w"> </span><span class="nv">$DATABASE_URL</span><span class="w"> </span>&lt;<span class="w"> </span>/tmp/restore/backup.sql

<span class="c1"># 4. Verify restoration</span>
psql<span class="w"> </span><span class="nv">$DATABASE_URL</span><span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;SELECT COUNT(*) FROM miners;&quot;</span>

<span class="c1"># 5. Restart application</span>
systemctl<span class="w"> </span>start<span class="w"> </span>hashinsight
</code></pre></div>

<h3 id="56-disaster-recovery-plan">5.6 Disaster Recovery Plan</h3>
<h4 id="complete-system-recovery-steps">Complete System Recovery Steps</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># 1. Prepare new environment</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">DATABASE_URL</span><span class="o">=</span><span class="s2">&quot;new_database_url&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">SESSION_SECRET</span><span class="o">=</span><span class="s2">&quot;new_session_secret&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">ENCRYPTION_PASSWORD</span><span class="o">=</span><span class="s2">&quot;new_encryption_password&quot;</span>

<span class="c1"># 2. Download latest backup</span>
python<span class="w"> </span>backup/backup_manager.py<span class="w"> </span>--download-latest

<span class="c1"># 3. Restore database</span>
python<span class="w"> </span>backup/backup_manager.py<span class="w"> </span>--restore-latest

<span class="c1"># 4. Deploy application</span>
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/hashinsight/platform.git
<span class="nb">cd</span><span class="w"> </span>platform
pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt

<span class="c1"># 5. Verify configuration</span>
python<span class="w"> </span>scripts/verify_setup.py

<span class="c1"># 6. Start application</span>
gunicorn<span class="w"> </span>--bind<span class="w"> </span><span class="m">0</span>.0.0.0:5000<span class="w"> </span>--workers<span class="w"> </span><span class="m">4</span><span class="w"> </span>main:app

<span class="c1"># 7. Verify service health</span>
curl<span class="w"> </span>http://localhost:5000/health
</code></pre></div>

<h3 id="57-backup-testing">5.7 Backup Testing</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Regular backup restoration testing (quarterly)</span>
<span class="c1"># 1. Create test environment</span>
docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>test-postgres<span class="w"> </span>-e<span class="w"> </span><span class="nv">POSTGRES_PASSWORD</span><span class="o">=</span><span class="nb">test</span><span class="w"> </span>postgres:15

<span class="c1"># 2. Restore to test environment</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">TEST_DATABASE_URL</span><span class="o">=</span><span class="s2">&quot;postgresql://postgres:test@localhost:5432/test_db&quot;</span>
psql<span class="w"> </span><span class="nv">$TEST_DATABASE_URL</span><span class="w"> </span>&lt;<span class="w"> </span>/tmp/backups/latest_backup.sql

<span class="c1"># 3. Verify data integrity</span>
python<span class="w"> </span>scripts/verify_backup_integrity.py<span class="w"> </span>--database<span class="w"> </span><span class="nv">$TEST_DATABASE_URL</span>

<span class="c1"># 4. Cleanup test environment</span>
docker<span class="w"> </span>stop<span class="w"> </span>test-postgres
docker<span class="w"> </span>rm<span class="w"> </span>test-postgres
</code></pre></div>

<h3 id="58-backup-checklist">5.8 Backup Checklist</h3>
<ul>
<li>[ ] Daily automated backups running</li>
<li>[ ] Backup encryption enabled</li>
<li>[ ] Remote storage configured</li>
<li>[ ] Backup integrity verification passing</li>
<li>[ ] Restoration tested within last 90 days</li>
<li>[ ] Old backups automatically cleaned up</li>
<li>[ ] Backup monitoring alerts configured</li>
<li>[ ] Documentation up to date</li>
</ul>
<hr />
<h2 id="chapter-6-security-operations">Chapter 6: Security Operations</h2>
<h3 id="61-kms-key-management">6.1 KMS Key Management</h3>
<p>HashInsight supports enterprise-grade Key Management Systems (KMS):</p>
<h4 id="supported-kms-providers">Supported KMS Providers</h4>
<ul>
<li><strong>AWS KMS</strong>: Amazon Web Services Key Management Service</li>
<li><strong>GCP KMS</strong>: Google Cloud Platform Key Management Service</li>
<li><strong>Azure Key Vault</strong>: Microsoft Azure Key Vault</li>
</ul>
<h5 id="aws-kms-configuration">AWS KMS Configuration</h5>
<div class="codehilite"><pre><span></span><code><span class="c1"># Configure AWS KMS</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">security.kms_client</span><span class="w"> </span><span class="kn">import</span> <span class="n">KMSClient</span><span class="p">,</span> <span class="n">KMSProvider</span><span class="p">,</span> <span class="n">EncryptionContext</span>

<span class="n">kms_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;key_id&#39;</span><span class="p">:</span> <span class="s1">&#39;arn:aws:kms:us-east-1:123456789:key/xxxxx&#39;</span><span class="p">,</span>
    <span class="s1">&#39;region&#39;</span><span class="p">:</span> <span class="s1">&#39;us-east-1&#39;</span>
<span class="p">}</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">KMSClient</span><span class="p">(</span><span class="n">KMSProvider</span><span class="o">.</span><span class="n">AWS_KMS</span><span class="p">,</span> <span class="n">kms_config</span><span class="p">)</span>

<span class="c1"># Encrypt data</span>
<span class="n">context</span> <span class="o">=</span> <span class="n">EncryptionContext</span><span class="p">(</span>
    <span class="n">purpose</span><span class="o">=</span><span class="s2">&quot;user_data_encryption&quot;</span><span class="p">,</span>
    <span class="n">tenant_id</span><span class="o">=</span><span class="s2">&quot;tenant_123&quot;</span>
<span class="p">)</span>

<span class="n">ciphertext</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">encrypt_secret</span><span class="p">(</span>
    <span class="n">plaintext</span><span class="o">=</span><span class="s2">&quot;sensitive data&quot;</span><span class="p">,</span>
    <span class="n">key_id</span><span class="o">=</span><span class="n">kms_config</span><span class="p">[</span><span class="s1">&#39;key_id&#39;</span><span class="p">],</span>
    <span class="n">context</span><span class="o">=</span><span class="n">context</span>
<span class="p">)</span>
</code></pre></div>

<h5 id="gcp-kms-configuration">GCP KMS Configuration</h5>
<div class="codehilite"><pre><span></span><code><span class="c1"># Configure GCP KMS</span>
<span class="n">kms_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;project_id&#39;</span><span class="p">:</span> <span class="s1">&#39;hashinsight-prod&#39;</span><span class="p">,</span>
    <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;us-east1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;keyring&#39;</span><span class="p">:</span> <span class="s1">&#39;hashinsight-keyring&#39;</span><span class="p">,</span>
    <span class="s1">&#39;key_id&#39;</span><span class="p">:</span> <span class="s1">&#39;encryption-key&#39;</span>
<span class="p">}</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">KMSClient</span><span class="p">(</span><span class="n">KMSProvider</span><span class="o">.</span><span class="n">GCP_KMS</span><span class="p">,</span> <span class="n">kms_config</span><span class="p">)</span>
</code></pre></div>

<h5 id="azure-key-vault-configuration">Azure Key Vault Configuration</h5>
<div class="codehilite"><pre><span></span><code><span class="c1"># Configure Azure Key Vault</span>
<span class="n">kms_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;vault_url&#39;</span><span class="p">:</span> <span class="s1">&#39;https://hashinsight-vault.vault.azure.net/&#39;</span><span class="p">,</span>
    <span class="s1">&#39;key_name&#39;</span><span class="p">:</span> <span class="s1">&#39;encryption-key&#39;</span>
<span class="p">}</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">KMSClient</span><span class="p">(</span><span class="n">KMSProvider</span><span class="o">.</span><span class="n">AZURE_KEY_VAULT</span><span class="p">,</span> <span class="n">kms_config</span><span class="p">)</span>
</code></pre></div>

<h4 id="key-rotation-process">Key Rotation Process</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># 1. Create new key version in KMS</span>
aws<span class="w"> </span>kms<span class="w"> </span>create-key<span class="w"> </span>--description<span class="w"> </span><span class="s2">&quot;HashInsight Master Key v2&quot;</span>

<span class="c1"># 2. Update application configuration</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">AWS_KMS_KEY_ID</span><span class="o">=</span>arn:aws:kms:us-east-1:123456789:key/new-key-id

<span class="c1"># 3. Re-encrypt existing data (background task)</span>
python<span class="w"> </span>scripts/rotate_encryption_keys.py<span class="w"> </span>--old-key<span class="w"> </span>OLD_KEY_ID<span class="w"> </span>--new-key<span class="w"> </span>NEW_KEY_ID

<span class="c1"># 4. Verify new key</span>
python<span class="w"> </span>scripts/verify_encryption.py<span class="w"> </span>--key-id<span class="w"> </span>NEW_KEY_ID

<span class="c1"># 5. Disable old key (retain for 90 days)</span>
aws<span class="w"> </span>kms<span class="w"> </span>disable-key<span class="w"> </span>--key-id<span class="w"> </span>OLD_KEY_ID
</code></pre></div>

<h3 id="62-mtls-mutual-authentication">6.2 mTLS Mutual Authentication</h3>
<h4 id="certificate-generation">Certificate Generation</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># 1. Generate CA certificate</span>
openssl<span class="w"> </span>genrsa<span class="w"> </span>-out<span class="w"> </span>ca.key<span class="w"> </span><span class="m">4096</span>
openssl<span class="w"> </span>req<span class="w"> </span>-new<span class="w"> </span>-x509<span class="w"> </span>-days<span class="w"> </span><span class="m">3650</span><span class="w"> </span>-key<span class="w"> </span>ca.key<span class="w"> </span>-out<span class="w"> </span>ca.crt<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-subj<span class="w"> </span><span class="s2">&quot;/C=US/O=HashInsight/CN=HashInsight Root CA&quot;</span>

<span class="c1"># 2. Generate server certificate</span>
openssl<span class="w"> </span>genrsa<span class="w"> </span>-out<span class="w"> </span>server.key<span class="w"> </span><span class="m">4096</span>
openssl<span class="w"> </span>req<span class="w"> </span>-new<span class="w"> </span>-key<span class="w"> </span>server.key<span class="w"> </span>-out<span class="w"> </span>server.csr<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-subj<span class="w"> </span><span class="s2">&quot;/C=US/O=HashInsight/CN=*.hashinsight.net&quot;</span>
openssl<span class="w"> </span>x509<span class="w"> </span>-req<span class="w"> </span>-days<span class="w"> </span><span class="m">365</span><span class="w"> </span>-in<span class="w"> </span>server.csr<span class="w"> </span>-CA<span class="w"> </span>ca.crt<span class="w"> </span>-CAkey<span class="w"> </span>ca.key<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-CAcreateserial<span class="w"> </span>-out<span class="w"> </span>server.crt

<span class="c1"># 3. Generate client certificate</span>
openssl<span class="w"> </span>genrsa<span class="w"> </span>-out<span class="w"> </span>client.key<span class="w"> </span><span class="m">4096</span>
openssl<span class="w"> </span>req<span class="w"> </span>-new<span class="w"> </span>-key<span class="w"> </span>client.key<span class="w"> </span>-out<span class="w"> </span>client.csr<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-subj<span class="w"> </span><span class="s2">&quot;/C=US/O=HashInsight/CN=client.hashinsight.net&quot;</span>
openssl<span class="w"> </span>x509<span class="w"> </span>-req<span class="w"> </span>-days<span class="w"> </span><span class="m">365</span><span class="w"> </span>-in<span class="w"> </span>client.csr<span class="w"> </span>-CA<span class="w"> </span>ca.crt<span class="w"> </span>-CAkey<span class="w"> </span>ca.key<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-CAcreateserial<span class="w"> </span>-out<span class="w"> </span>client.crt
</code></pre></div>

<h4 id="mtls-configuration">mTLS Configuration</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Environment variable configuration</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">MTLS_ENABLED</span><span class="o">=</span><span class="nb">true</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">MTLS_CA_CERT_PATH</span><span class="o">=</span>/app/certs/ca.crt
<span class="nb">export</span><span class="w"> </span><span class="nv">MTLS_SERVER_CERT_PATH</span><span class="o">=</span>/app/certs/server.crt
<span class="nb">export</span><span class="w"> </span><span class="nv">MTLS_SERVER_KEY_PATH</span><span class="o">=</span>/app/certs/server.key
<span class="nb">export</span><span class="w"> </span><span class="nv">MTLS_VERIFY_CLIENT</span><span class="o">=</span><span class="nb">true</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">MTLS_ALLOWED_DN_PATTERNS</span><span class="o">=</span><span class="s2">&quot;CN=*.hashinsight.net,O=HashInsight,C=US&quot;</span>
</code></pre></div>

<h4 id="using-mtls-authentication">Using mTLS Authentication</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">common.mtls_auth</span><span class="w"> </span><span class="kn">import</span> <span class="n">require_mtls</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/admin/sensitive&#39;</span><span class="p">)</span>
<span class="nd">@require_mtls</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">sensitive_endpoint</span><span class="p">():</span>
    <span class="c1"># Only allow requests with valid client certificates</span>
    <span class="n">client_dn</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">client_cert_subject</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Authenticated as </span><span class="si">{</span><span class="n">client_dn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">})</span>
</code></pre></div>

<h3 id="63-api-key-management">6.3 API Key Management</h3>
<h4 id="key-format">Key Format</h4>
<p>HashInsight API key format: <code>hsi_{env}_key_{random}</code></p>
<p>Examples:
- Production: <code>hsi_prod_key_a1b2c3d4e5f6g7h8</code>
- Development: <code>hsi_dev_key_x9y8z7w6v5u4t3s2</code></p>
<h4 id="create-api-key">Create API Key</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Create using management tool</span>
python<span class="w"> </span>scripts/create_api_key.py<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--user-id<span class="w"> </span><span class="m">123</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--permissions<span class="w"> </span><span class="s2">&quot;miners:read,miners:write&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--expires-in<span class="w"> </span><span class="m">90</span>

<span class="c1"># Output</span>
âœ…<span class="w"> </span>API<span class="w"> </span>key<span class="w"> </span>created
Key:<span class="w"> </span>hsi_prod_key_a1b2c3d4e5f6g7h8
User<span class="w"> </span>ID:<span class="w"> </span><span class="m">123</span>
Permissions:<span class="w"> </span>miners:read,miners:write
Expires:<span class="w"> </span><span class="m">2025</span>-12-31T23:59:59Z
âš ï¸<span class="w">  </span>Please<span class="w"> </span>store<span class="w"> </span>this<span class="w"> </span>key<span class="w"> </span>securely,<span class="w"> </span>it<span class="w"> </span>will<span class="w"> </span>not<span class="w"> </span>be<span class="w"> </span>shown<span class="w"> </span>again
</code></pre></div>

<h4 id="api-key-rotation">API Key Rotation</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># 1. Create new key</span>
<span class="nv">new_key</span><span class="o">=</span><span class="k">$(</span>python<span class="w"> </span>scripts/create_api_key.py<span class="w"> </span>--user-id<span class="w"> </span><span class="m">123</span><span class="w"> </span>--copy-from<span class="w"> </span>old_key_id<span class="k">)</span>

<span class="c1"># 2. Update client configuration (7-day dual-key period)</span>
<span class="c1"># Both old and new keys valid simultaneously</span>

<span class="c1"># 3. Verify new key</span>
curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$new_key</span><span class="s2">&quot;</span><span class="w"> </span>http://localhost:5000/api/miners

<span class="c1"># 4. Revoke old key</span>
python<span class="w"> </span>scripts/revoke_api_key.py<span class="w"> </span>--key-id<span class="w"> </span>old_key_id
</code></pre></div>

<h3 id="64-wireguard-enterprise-network">6.4 WireGuard Enterprise Network</h3>
<h4 id="hub-server-deployment">Hub Server Deployment</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># 1. Run Hub installation script</span>
sudo<span class="w"> </span>bash<span class="w"> </span>wireguard/hub_setup.sh

<span class="c1"># 2. Configure firewall</span>
sudo<span class="w"> </span>ufw<span class="w"> </span>allow<span class="w"> </span><span class="m">51820</span>/udp
sudo<span class="w"> </span>ufw<span class="w"> </span><span class="nb">enable</span>

<span class="c1"># 3. Start WireGuard</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>wg-quick@wg0
sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>wg-quick@wg0

<span class="c1"># 4. Check status</span>
sudo<span class="w"> </span>wg<span class="w"> </span>show
</code></pre></div>

<h4 id="site-gateway-configuration">Site Gateway Configuration</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># 1. Generate site keys</span>
<span class="nb">cd</span><span class="w"> </span>wireguard/site-gateway
python<span class="w"> </span>key_manager.py<span class="w"> </span>--generate-keys<span class="w"> </span>--site<span class="w"> </span>beijing-dc1

<span class="c1"># 2. Add to Hub configuration</span>
sudo<span class="w"> </span>nano<span class="w"> </span>/etc/wireguard/wg0.conf

<span class="c1"># Add Peer configuration</span>
<span class="o">[</span>Peer<span class="o">]</span>
<span class="nv">PublicKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>site_public_key
<span class="nv">AllowedIPs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span>.8.1.0/24
<span class="nv">Endpoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>beijing-gateway.hashinsight.net:51820

<span class="c1"># 3. Reload configuration</span>
sudo<span class="w"> </span>wg-quick<span class="w"> </span>down<span class="w"> </span>wg0
sudo<span class="w"> </span>wg-quick<span class="w"> </span>up<span class="w"> </span>wg0
</code></pre></div>

<h3 id="65-audit-logging">6.5 Audit Logging</h3>
<p>HashInsight logs all critical operations to audit logs (<code>audit/audit_logger.py</code>):</p>
<h4 id="audit-event-types">Audit Event Types</h4>
<ul>
<li>âœ… Authentication (login/logout/failure)</li>
<li>âœ… Data access (CRUD operations)</li>
<li>âœ… Configuration changes</li>
<li>âœ… Permission changes</li>
<li>âœ… Encryption operations</li>
<li>âœ… API key management</li>
<li>âœ… Suspicious activities</li>
</ul>
<h4 id="audit-log-format">Audit Log Format</h4>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-10-03T12:00:00.000Z&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;event_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;a1b2c3d4e5f6g7h8&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;level&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;category&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;authentication&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;login&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;user_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;123&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;user_email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user@example.com&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;user_role&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;admin&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;ip_address&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;192.168.1.100&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;success&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;details&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;login_method&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;password&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;two_factor&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="query-audit-logs">Query Audit Logs</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># View last 100 audit logs</span>
tail<span class="w"> </span>-100<span class="w"> </span>logs/audit.jsonl

<span class="c1"># Query specific user operations</span>
jq<span class="w"> </span><span class="s1">&#39;select(.user_email == &quot;admin@hashinsight.net&quot;)&#39;</span><span class="w"> </span>logs/audit.jsonl

<span class="c1"># Query failed login attempts</span>
jq<span class="w"> </span><span class="s1">&#39;select(.action == &quot;login_failed&quot;)&#39;</span><span class="w"> </span>logs/audit.jsonl

<span class="c1"># Query security events from last 24 hours</span>
jq<span class="w"> </span>--arg<span class="w"> </span>date<span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>date<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;24 hours ago&#39;</span><span class="w"> </span>-Iseconds<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="s1">&#39;select(.timestamp &gt; $date and .level == &quot;SECURITY&quot;)&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>logs/audit.jsonl
</code></pre></div>

<h3 id="66-compliance-requirements">6.6 Compliance Requirements</h3>
<p>HashInsight follows these compliance standards:</p>
<h4 id="soc-2-type-ii">SOC 2 Type II</h4>
<ul>
<li>âœ… Access control</li>
<li>âœ… Encrypted transmission (TLS 1.3)</li>
<li>âœ… Encrypted storage (AES-256)</li>
<li>âœ… Audit logging (immutable)</li>
<li>âœ… Change management</li>
<li>âœ… Disaster recovery</li>
</ul>
<h4 id="pci-dss-if-processing-payments">PCI DSS (if processing payments)</h4>
<ul>
<li>âœ… Sensitive data masking</li>
<li>âœ… Key management (KMS)</li>
<li>âœ… Network isolation (WireGuard)</li>
<li>âœ… Regular penetration testing</li>
</ul>
<h4 id="gdpr">GDPR</h4>
<ul>
<li>âœ… Data minimization</li>
<li>âœ… User data export</li>
<li>âœ… Data deletion (right to be forgotten)</li>
<li>âœ… Data processing records</li>
</ul>
<h3 id="67-security-checklist">6.7 Security Checklist</h3>
<ul>
<li>[ ] All keys stored in KMS (not in code/config files)</li>
<li>[ ] mTLS enabled (production environment)</li>
<li>[ ] API keys rotated regularly (90 days)</li>
<li>[ ] SSL/TLS certificates valid and not expired</li>
<li>[ ] Audit logs writing normally</li>
<li>[ ] No sensitive information leaked to logs</li>
<li>[ ] Database connections encrypted (SSL)</li>
<li>[ ] Session key strength â‰¥256 bits</li>
<li>[ ] Regular security scans (quarterly)</li>
<li>[ ] Penetration testing report (annually)</li>
</ul>
<hr />
<h2 id="chapter-7-troubleshooting-guide">Chapter 7: Troubleshooting Guide</h2>
<h3 id="71-application-wont-start">7.1 Application Won't Start</h3>
<h4 id="symptoms">Symptoms</h4>
<div class="codehilite"><pre><span></span><code><span class="err">$</span><span class="w"> </span><span class="n">gunicorn</span><span class="w"> </span><span class="nl">main</span><span class="p">:</span><span class="n">app</span>
<span class="o">[</span><span class="n">ERROR</span><span class="o">]</span><span class="w"> </span><span class="n">Application</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">start</span>
</code></pre></div>

<h4 id="diagnostic-steps">Diagnostic Steps</h4>
<p><strong>1. Check Port Usage</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check port 5000 usage</span>
lsof<span class="w"> </span>-i<span class="w"> </span>:5000

<span class="c1"># If occupied, kill process</span>
<span class="nb">kill</span><span class="w"> </span>-9<span class="w"> </span><span class="k">$(</span>lsof<span class="w"> </span>-t<span class="w"> </span>-i:5000<span class="k">)</span>
</code></pre></div>

<p><strong>2. Check Environment Variables</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Verify required variables</span>
python3<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s">import os</span>
<span class="s">required = [&#39;DATABASE_URL&#39;, &#39;SESSION_SECRET&#39;, &#39;ENCRYPTION_PASSWORD&#39;]</span>
<span class="s">for var in required:</span>
<span class="s">    value = os.getenv(var)</span>
<span class="s">    if not value:</span>
<span class="s">        print(f&quot;âŒ Missing: {var}&quot;)</span>
<span class="s">    else:</span>
<span class="s">        print(f&quot;âœ… {var}: {&#39;*&#39; * 8} (set)&quot;)</span>
<span class="s">EOF</span>
</code></pre></div>

<p><strong>3. Check Database Connection</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Test PostgreSQL connection</span>
psql<span class="w"> </span><span class="nv">$DATABASE_URL</span><span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;SELECT version();&quot;</span>

<span class="c1"># If fails, check Neon endpoint status</span>
<span class="c1"># Visit https://console.neon.tech</span>
</code></pre></div>

<p><strong>4. Check Python Dependencies</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Verify key libraries</span>
python3<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;</span>
<span class="s2">import flask</span>
<span class="s2">import gunicorn</span>
<span class="s2">import psycopg2</span>
<span class="s2">import sqlalchemy</span>
<span class="s2">print(&#39;âœ… All dependencies OK&#39;)</span>
<span class="s2">&quot;</span>
</code></pre></div>

<p><strong>5. View Detailed Errors</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Enable debug mode</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">FLASK_DEBUG</span><span class="o">=</span><span class="m">1</span>
python3<span class="w"> </span>main.py

<span class="c1"># View full stack trace</span>
</code></pre></div>

<h4 id="common-errors-and-solutions">Common Errors and Solutions</h4>
<table>
<thead>
<tr>
<th>Error</th>
<th>Cause</th>
<th>Solution</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ModuleNotFoundError: No module named 'flask'</code></td>
<td>Dependencies not installed</td>
<td><code>pip install -r requirements.txt</code></td>
</tr>
<tr>
<td><code>OperationalError: could not connect to server</code></td>
<td>Database connection failed</td>
<td>Check DATABASE_URL, verify Neon endpoint</td>
</tr>
<tr>
<td><code>ValueError: SECRET_KEY must be set</code></td>
<td>SESSION_SECRET not set</td>
<td><code>export SESSION_SECRET=$(python -c 'import secrets; print(secrets.token_urlsafe(32))')</code></td>
</tr>
<tr>
<td><code>Address already in use</code></td>
<td>Port occupied</td>
<td><code>kill -9 $(lsof -t -i:5000)</code></td>
</tr>
</tbody>
</table>
<h3 id="72-database-connection-failure">7.2 Database Connection Failure</h3>
<h4 id="symptoms_1">Symptoms</h4>
<div class="codehilite"><pre><span></span><code><span class="nv">sqlalchemy</span>.<span class="nv">exc</span>.<span class="nv">OperationalError</span>:<span class="w"> </span><span class="ss">(</span><span class="nv">psycopg2</span>.<span class="nv">OperationalError</span><span class="ss">)</span><span class="w"> </span>
<span class="nv">could</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="k">connect</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">server</span>:<span class="w"> </span><span class="nv">Connection</span><span class="w"> </span><span class="nv">timed</span><span class="w"> </span><span class="nv">out</span>
</code></pre></div>

<h4 id="diagnostic-steps_1">Diagnostic Steps</h4>
<p><strong>1. Verify Connection String</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Parse DATABASE_URL</span>
python3<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s">import os</span>
<span class="s">from urllib.parse import urlparse</span>
<span class="s">url = os.getenv(&#39;DATABASE_URL&#39;)</span>
<span class="s">parsed = urlparse(url)</span>
<span class="s">print(f&quot;Host: {parsed.hostname}&quot;)</span>
<span class="s">print(f&quot;Port: {parsed.port}&quot;)</span>
<span class="s">print(f&quot;Database: {parsed.path[1:]}&quot;)</span>
<span class="s">print(f&quot;User: {parsed.username}&quot;)</span>
<span class="s">EOF</span>
</code></pre></div>

<p><strong>2. Test Network Connectivity</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Extract host and port</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">DB_HOST</span><span class="o">=</span><span class="k">$(</span>python3<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;from urllib.parse import urlparse; import os; print(urlparse(os.getenv(&#39;DATABASE_URL&#39;)).hostname)&quot;</span><span class="k">)</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">DB_PORT</span><span class="o">=</span><span class="k">$(</span>python3<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;from urllib.parse import urlparse; import os; print(urlparse(os.getenv(&#39;DATABASE_URL&#39;)).port or 5432)&quot;</span><span class="k">)</span>

<span class="c1"># Test TCP connection</span>
nc<span class="w"> </span>-zv<span class="w"> </span><span class="nv">$DB_HOST</span><span class="w"> </span><span class="nv">$DB_PORT</span>
</code></pre></div>

<p><strong>3. Check Connection Pool</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Connection pool configuration (config.py)</span>
<span class="n">SQLALCHEMY_ENGINE_OPTIONS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;pool_size&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>           <span class="c1"># Default 10 connections</span>
    <span class="s1">&#39;pool_recycle&#39;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span>       <span class="c1"># Recycle after 5 minutes</span>
    <span class="s1">&#39;pool_pre_ping&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>     <span class="c1"># Test connection before use</span>
    <span class="s1">&#39;pool_timeout&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>        <span class="c1"># 30 second timeout</span>
    <span class="s1">&#39;max_overflow&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>        <span class="c1"># Max 20 overflow connections</span>
    <span class="s1">&#39;connect_args&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;connect_timeout&#39;</span><span class="p">:</span> <span class="mi">15</span>  <span class="c1"># 15 second connect timeout</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>4. Check Neon Endpoint Status</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Visit Neon Console</span>
<span class="c1"># https://console.neon.tech/app/projects</span>

<span class="c1"># Check endpoint status:</span>
<span class="c1"># - Active (green) - Normal</span>
<span class="c1"># - Idle (yellow) - Needs wake-up</span>
<span class="c1"># - Suspended (gray) - Suspended</span>
</code></pre></div>

<p><strong>5. Enable Connection Retry</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Add retry logic in app.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span><span class="p">,</span> <span class="n">exc</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.pool</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pool</span>

<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">Pool</span><span class="p">,</span> <span class="s2">&quot;connect&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_connect</span><span class="p">(</span><span class="n">dbapi_conn</span><span class="p">,</span> <span class="n">connection_record</span><span class="p">):</span>
    <span class="n">connection_record</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;pid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()</span>

<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">Pool</span><span class="p">,</span> <span class="s2">&quot;checkout&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_checkout</span><span class="p">(</span><span class="n">dbapi_conn</span><span class="p">,</span> <span class="n">connection_record</span><span class="p">,</span> <span class="n">connection_proxy</span><span class="p">):</span>
    <span class="n">pid</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">connection_record</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;pid&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">pid</span><span class="p">:</span>
        <span class="n">connection_record</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="n">connection_proxy</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">DisconnectionError</span><span class="p">(</span>
            <span class="s2">&quot;Connection record belongs to pid </span><span class="si">%s</span><span class="s2">, &quot;</span>
            <span class="s2">&quot;attempting to check out in pid </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
            <span class="p">(</span><span class="n">connection_record</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;pid&#39;</span><span class="p">],</span> <span class="n">pid</span><span class="p">)</span>
        <span class="p">)</span>
</code></pre></div>

<h3 id="73-cache-issues">7.3 Cache Issues</h3>
<h4 id="symptoms_2">Symptoms</h4>
<ul>
<li>Response time significantly increased</li>
<li>Cache hit rate below 50%</li>
<li>Redis connection errors</li>
</ul>
<h4 id="diagnostic-steps_2">Diagnostic Steps</h4>
<p><strong>1. Check Redis Connection</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Test Redis</span>
redis-cli<span class="w"> </span>ping
<span class="c1"># Expected: PONG</span>

<span class="c1"># Check Redis memory</span>
redis-cli<span class="w"> </span>info<span class="w"> </span>memory

<span class="c1"># Check key count</span>
redis-cli<span class="w"> </span>dbsize
</code></pre></div>

<p><strong>2. View Cache Hit Rate</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Query via API</span>
<span class="n">curl</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">cache</span><span class="o">/</span><span class="n">stats</span>

<span class="c1"># Expected response</span>
<span class="p">{</span>
  <span class="s2">&quot;cache_type&quot;</span><span class="p">:</span> <span class="s2">&quot;redis&quot;</span><span class="p">,</span>
  <span class="s2">&quot;hit_rate&quot;</span><span class="p">:</span> <span class="mf">75.5</span><span class="p">,</span>
  <span class="s2">&quot;total_requests&quot;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
  <span class="s2">&quot;hits&quot;</span><span class="p">:</span> <span class="mi">7550</span><span class="p">,</span>
  <span class="s2">&quot;misses&quot;</span><span class="p">:</span> <span class="mi">2450</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>3. Cache Fallback Mechanism</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># cache_manager.py automatic fallback</span>
<span class="k">if</span> <span class="n">redis_available</span><span class="p">:</span>
    <span class="n">cache_backend</span> <span class="o">=</span> <span class="n">RedisCache</span><span class="p">()</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Redis unavailable, falling back to memory cache&quot;</span><span class="p">)</span>
    <span class="n">cache_backend</span> <span class="o">=</span> <span class="n">MemoryCache</span><span class="p">()</span>
</code></pre></div>

<p><strong>4. Clear Cache</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Clear all cache</span>
redis-cli<span class="w"> </span>FLUSHDB

<span class="c1"># Clear specific prefix</span>
redis-cli<span class="w"> </span>--scan<span class="w"> </span>--pattern<span class="w"> </span><span class="s1">&#39;hashinsight:*&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="w"> </span>redis-cli<span class="w"> </span>DEL
</code></pre></div>

<h3 id="74-performance-degradation">7.4 Performance Degradation</h3>
<h4 id="symptoms_3">Symptoms</h4>
<ul>
<li>API response time p95 &gt; 250ms</li>
<li>Slow database queries</li>
<li>High CPU/memory usage</li>
</ul>
<h4 id="diagnostic-steps_3">Diagnostic Steps</h4>
<p><strong>1. Check Request Coalescing Status</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># View request merging statistics</span>
curl<span class="w"> </span>http://localhost:5000/api/performance/coalescing-stats

<span class="c1"># Expected response</span>
<span class="o">{</span>
<span class="w">  </span><span class="s2">&quot;enabled&quot;</span>:<span class="w"> </span>true,
<span class="w">  </span><span class="s2">&quot;performance_improvement&quot;</span>:<span class="w"> </span><span class="s2">&quot;9.8x&quot;</span>,
<span class="w">  </span><span class="s2">&quot;deduplicated_requests&quot;</span>:<span class="w"> </span><span class="m">5432</span>,
<span class="w">  </span><span class="s2">&quot;total_requests&quot;</span>:<span class="w"> </span><span class="m">53210</span>
<span class="o">}</span>
</code></pre></div>

<p><strong>2. Analyze Slow Queries</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">-- Enable slow query log (PostgreSQL)</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">DATABASE</span><span class="w"> </span><span class="n">hashinsight_db</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">log_min_duration_statement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span>

<span class="c1">-- Query slow queries</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">query</span><span class="p">,</span><span class="w"> </span><span class="n">calls</span><span class="p">,</span><span class="w"> </span><span class="n">total_time</span><span class="p">,</span><span class="w"> </span><span class="n">mean_time</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">pg_stat_statements</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">mean_time</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1000</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">mean_time</span><span class="w"> </span><span class="k">DESC</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
</code></pre></div>

<p><strong>3. Check Database Indexes</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Run index optimization</span>
python<span class="w"> </span>database/optimize_indexes.py<span class="w"> </span>--analyze

<span class="c1"># View missing indexes</span>
python<span class="w"> </span>database/optimize_indexes.py<span class="w"> </span>--suggest
</code></pre></div>

<p><strong>4. Monitor System Resources</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># CPU usage</span>
top<span class="w"> </span>-b<span class="w"> </span>-n<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>gunicorn

<span class="c1"># Memory usage</span>
ps<span class="w"> </span>aux<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>gunicorn<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{sum+=$6} END {print sum/1024 &quot; MB&quot;}&#39;</span>

<span class="c1"># Database connections</span>
psql<span class="w"> </span><span class="nv">$DATABASE_URL</span><span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;SELECT count(*) FROM pg_stat_activity WHERE datname = &#39;hashinsight_db&#39;;&quot;</span>
</code></pre></div>

<p><strong>5. Enable Performance Profiling</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Add to routes requiring profiling</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">werkzeug.middleware.profiler</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProfilerMiddleware</span>

<span class="n">app</span><span class="o">.</span><span class="n">wsgi_app</span> <span class="o">=</span> <span class="n">ProfilerMiddleware</span><span class="p">(</span>
    <span class="n">app</span><span class="o">.</span><span class="n">wsgi_app</span><span class="p">,</span>
    <span class="n">restrictions</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span>
    <span class="n">profile_dir</span><span class="o">=</span><span class="s1">&#39;./profiles&#39;</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="75-blockchain-integration-errors">7.5 Blockchain Integration Errors</h3>
<h4 id="symptoms_4">Symptoms</h4>
<div class="codehilite"><pre><span></span><code><span class="n">ERROR</span><span class="o">:</span><span class="n">blockchain_integration</span><span class="o">:</span><span class="w"> </span><span class="n">Encryption</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="n">error</span><span class="o">:</span><span class="w"> </span><span class="n">ENCRYPTION_PASSWORD</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="kd">set</span>
<span class="n">ERROR</span><span class="o">:</span><span class="n">sla_nft_routes</span><span class="o">:</span><span class="w"> </span><span class="n">Failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="kd">get</span><span class="w"> </span><span class="n">SLA</span><span class="w"> </span><span class="n">status</span>
</code></pre></div>

<h4 id="diagnostic-steps_4">Diagnostic Steps</h4>
<p><strong>1. Check ENCRYPTION_PASSWORD</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Verify environment variable</span>
<span class="nb">echo</span><span class="w"> </span><span class="nv">$ENCRYPTION_PASSWORD</span>

<span class="c1"># If not set</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">ENCRYPTION_PASSWORD</span><span class="o">=</span><span class="k">$(</span>python3<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;import secrets; print(secrets.token_urlsafe(32))&#39;</span><span class="k">)</span>
</code></pre></div>

<p><strong>2. Check Blockchain Configuration</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Verify blockchain environment variables</span>
python3<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s">import os</span>
<span class="s">config = {</span>
<span class="s">    &#39;BLOCKCHAIN_ENABLED&#39;: os.getenv(&#39;BLOCKCHAIN_ENABLED&#39;),</span>
<span class="s">    &#39;BLOCKCHAIN_PRIVATE_KEY&#39;: &#39;***&#39; if os.getenv(&#39;BLOCKCHAIN_PRIVATE_KEY&#39;) else None,</span>
<span class="s">    &#39;BLOCKCHAIN_NETWORK&#39;: os.getenv(&#39;BLOCKCHAIN_NETWORK&#39;, &#39;base-sepolia&#39;),</span>
<span class="s">    &#39;BASE_RPC_URL&#39;: os.getenv(&#39;BASE_RPC_URL&#39;, &#39;https://sepolia.base.org&#39;)</span>
<span class="s">}</span>
<span class="s">for k, v in config.items():</span>
<span class="s">    status = &#39;âœ…&#39; if v else &#39;âŒ&#39;</span>
<span class="s">    print(f&quot;{status} {k}: {v}&quot;)</span>
<span class="s">EOF</span>
</code></pre></div>

<p><strong>3. Test Web3 Connection</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">python3</span> <span class="o">&lt;&lt;</span> <span class="s1">&#39;EOF&#39;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">web3</span><span class="w"> </span><span class="kn">import</span> <span class="n">Web3</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="n">rpc_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;BASE_RPC_URL&#39;</span><span class="p">,</span> <span class="s1">&#39;https://sepolia.base.org&#39;</span><span class="p">)</span>
<span class="n">w3</span> <span class="o">=</span> <span class="n">Web3</span><span class="p">(</span><span class="n">Web3</span><span class="o">.</span><span class="n">HTTPProvider</span><span class="p">(</span><span class="n">rpc_url</span><span class="p">))</span>

<span class="k">if</span> <span class="n">w3</span><span class="o">.</span><span class="n">is_connected</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âœ… Web3 connected to </span><span class="si">{</span><span class="n">rpc_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Block number: </span><span class="si">{</span><span class="n">w3</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">block_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ Web3 connection failed&quot;</span><span class="p">)</span>
<span class="n">EOF</span>
</code></pre></div>

<p><strong>4. Verify Private Key Format</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Private key should start with 0x, followed by 64 hex characters</span>
python3<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s">import os</span>
<span class="s">import re</span>

<span class="s">private_key = os.getenv(&#39;BLOCKCHAIN_PRIVATE_KEY&#39;, &#39;&#39;)</span>
<span class="s">if re.match(r&#39;^0x[0-9a-fA-F]{64}$&#39;, private_key):</span>
<span class="s">    print(&quot;âœ… Private key format valid&quot;)</span>
<span class="s">else:</span>
<span class="s">    print(&quot;âŒ Invalid private key format&quot;)</span>
<span class="s">    print(&quot;Expected: 0x + 64 hex characters&quot;)</span>
<span class="s">EOF</span>
</code></pre></div>

<h3 id="76-log-locations">7.6 Log Locations</h3>
<table>
<thead>
<tr>
<th>Log Type</th>
<th>Path</th>
<th>Format</th>
</tr>
</thead>
<tbody>
<tr>
<td>Application logs</td>
<td>stdout</td>
<td>Text</td>
</tr>
<tr>
<td>Audit logs</td>
<td><code>logs/audit.jsonl</code></td>
<td>JSON Lines</td>
</tr>
<tr>
<td>Error logs</td>
<td>stderr</td>
<td>Text</td>
</tr>
<tr>
<td>Gunicorn logs</td>
<td><code>/var/log/gunicorn/</code></td>
<td>Text</td>
</tr>
<tr>
<td>PostgreSQL logs</td>
<td>Neon Console</td>
<td>Text</td>
</tr>
<tr>
<td>Workflow logs</td>
<td><code>/tmp/logs/</code></td>
<td>Text</td>
</tr>
</tbody>
</table>
<h4 id="view-logs">View Logs</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Real-time application logs</span>
tail<span class="w"> </span>-f<span class="w"> </span>/var/log/hashinsight/app.log

<span class="c1"># View error logs</span>
grep<span class="w"> </span>ERROR<span class="w"> </span>/var/log/hashinsight/app.log<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-50

<span class="c1"># View audit logs</span>
tail<span class="w"> </span>-f<span class="w"> </span>logs/audit.jsonl<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;.&#39;</span>

<span class="c1"># View Gunicorn access logs</span>
tail<span class="w"> </span>-f<span class="w"> </span>/var/log/gunicorn/access.log
</code></pre></div>

<hr />
<h2 id="chapter-8-daily-operations">Chapter 8: Daily Operations</h2>
<h3 id="81-database-maintenance">8.1 Database Maintenance</h3>
<h4 id="811-index-optimization">8.1.1 Index Optimization</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Automatically optimize indexes</span>
python<span class="w"> </span>database/optimize_indexes.py<span class="w"> </span>--auto

<span class="c1"># Analyze and suggest indexes</span>
python<span class="w"> </span>database/optimize_indexes.py<span class="w"> </span>--analyze<span class="w"> </span>--suggest

<span class="c1"># Output example:</span>
<span class="c1"># âœ… Existing indexes: 45</span>
<span class="c1"># ğŸ” Scanning slow queries...</span>
<span class="c1"># ğŸ’¡ Suggested indexes:</span>
<span class="c1">#   - CREATE INDEX idx_miners_user_id ON miners(user_id)</span>
<span class="c1">#   - CREATE INDEX idx_market_data_timestamp ON market_analytics(created_at DESC)</span>
</code></pre></div>

<h4 id="812-connection-pool-monitoring">8.1.2 Connection Pool Monitoring</h4>
<div class="codehilite"><pre><span></span><code><span class="c1">-- View current connections</span>
<span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="n">pid</span><span class="p">,</span>
<span class="w">    </span><span class="n">usename</span><span class="p">,</span>
<span class="w">    </span><span class="n">application_name</span><span class="p">,</span>
<span class="w">    </span><span class="n">client_addr</span><span class="p">,</span>
<span class="w">    </span><span class="k">state</span><span class="p">,</span>
<span class="w">    </span><span class="n">query_start</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">pg_stat_activity</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">datname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;hashinsight_db&#39;</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">query_start</span><span class="p">;</span>

<span class="c1">-- Kill idle connections</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">pg_terminate_backend</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">pg_stat_activity</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">datname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;hashinsight_db&#39;</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="k">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;idle&#39;</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">state_change</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">NOW</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="s1">&#39;30 minutes&#39;</span><span class="p">;</span>
</code></pre></div>

<h4 id="813-slow-query-analysis">8.1.3 Slow Query Analysis</h4>
<div class="codehilite"><pre><span></span><code><span class="c1">-- Enable pg_stat_statements</span>
<span class="k">CREATE</span><span class="w"> </span><span class="n">EXTENSION</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">pg_stat_statements</span><span class="p">;</span>

<span class="c1">-- View Top 10 slow queries</span>
<span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="k">substring</span><span class="p">(</span><span class="n">query</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">short_query</span><span class="p">,</span>
<span class="w">    </span><span class="n">calls</span><span class="p">,</span>
<span class="w">    </span><span class="n">total_time</span><span class="p">,</span>
<span class="w">    </span><span class="n">mean_time</span><span class="p">,</span>
<span class="w">    </span><span class="n">max_time</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">pg_stat_statements</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%pg_stat_statements%&#39;</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">mean_time</span><span class="w"> </span><span class="k">DESC</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>

<span class="c1">-- Reset statistics</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">pg_stat_statements_reset</span><span class="p">();</span>
</code></pre></div>

<h4 id="814-database-cleanup">8.1.4 Database Cleanup</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Clean old data (retain 90 days)</span>
python<span class="w"> </span>scripts/cleanup_old_data.py<span class="w"> </span>--days<span class="w"> </span><span class="m">90</span>

<span class="c1"># Cleanup example:</span>
<span class="c1"># âœ… Deleted market_analytics older than 90 days: 12,543 records</span>
<span class="c1"># âœ… Deleted audit logs older than 90 days: 45,123 records</span>
<span class="c1"># âœ… Cleanup complete, freed space: 2.3 GB</span>
</code></pre></div>

<h3 id="82-cache-management">8.2 Cache Management</h3>
<h4 id="821-redis-cache-cleanup">8.2.1 Redis Cache Cleanup</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Clear all HashInsight cache</span>
redis-cli<span class="w"> </span>--scan<span class="w"> </span>--pattern<span class="w"> </span><span class="s1">&#39;hashinsight:*&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="w"> </span>redis-cli<span class="w"> </span>DEL

<span class="c1"># Clear specific module cache</span>
redis-cli<span class="w"> </span>--scan<span class="w"> </span>--pattern<span class="w"> </span><span class="s1">&#39;hashinsight:miners:*&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="w"> </span>redis-cli<span class="w"> </span>DEL

<span class="c1"># Clear expired keys (Redis automatic, manual trigger)</span>
redis-cli<span class="w"> </span>--scan<span class="w"> </span>--pattern<span class="w"> </span><span class="s1">&#39;hashinsight:*&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>key<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span>redis-cli<span class="w"> </span>TTL<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$key</span><span class="s2">&quot;</span>
<span class="k">done</span>
</code></pre></div>

<h4 id="822-memory-cache-monitoring">8.2.2 Memory Cache Monitoring</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Query memory cache status via API</span>
<span class="n">curl</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">cache</span><span class="o">/</span><span class="n">memory</span><span class="o">-</span><span class="n">stats</span>

<span class="c1"># Response</span>
<span class="p">{</span>
  <span class="s2">&quot;cache_type&quot;</span><span class="p">:</span> <span class="s2">&quot;memory&quot;</span><span class="p">,</span>
  <span class="s2">&quot;size_mb&quot;</span><span class="p">:</span> <span class="mf">124.5</span><span class="p">,</span>
  <span class="s2">&quot;entries&quot;</span><span class="p">:</span> <span class="mi">5432</span><span class="p">,</span>
  <span class="s2">&quot;hit_rate&quot;</span><span class="p">:</span> <span class="mf">82.3</span><span class="p">,</span>
  <span class="s2">&quot;evictions&quot;</span><span class="p">:</span> <span class="mi">234</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="823-request-coalescer-status">8.2.3 Request Coalescer Status</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># View request merging statistics</span>
curl<span class="w"> </span>http://localhost:5000/api/performance/coalescing-stats<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq

<span class="c1"># Manually clear coalescing cache</span>
curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:5000/api/performance/clear-coalescing-cache
</code></pre></div>

<h3 id="83-batch-tasks">8.3 Batch Tasks</h3>
<h4 id="831-bulk-import-miners">8.3.1 Bulk Import Miners</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Prepare CSV file (max 5000 miners)</span>
<span class="c1"># Format: name,model,hashrate_th,power_w,efficiency</span>

<span class="c1"># Execute bulk import</span>
python<span class="w"> </span>batch/batch_import_manager.py<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--file<span class="w"> </span>miners_upload_5000.csv<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--user-id<span class="w"> </span><span class="m">123</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--validate

<span class="c1"># Output:</span>
<span class="c1"># âœ… File validation passed</span>
<span class="c1"># ğŸ“Š Record count: 5000</span>
<span class="c1"># âš™ï¸  Processing...</span>
<span class="c1"># [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100%</span>
<span class="c1"># âœ… Import complete: 5000 miners (Duration: 45.2s)</span>
</code></pre></div>

<h4 id="832-data-collection-tasks">8.3.2 Data Collection Tasks</h4>
<p>HashInsight automatically collects market data every 15 minutes:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Manually trigger data collection</span>
python<span class="w"> </span>modules/analytics/engines/analytics_engine.py<span class="w"> </span>--collect-now

<span class="c1"># View collection status</span>
curl<span class="w"> </span>http://localhost:5000/api/analytics/collection-status

<span class="c1"># Response</span>
<span class="o">{</span>
<span class="w">  </span><span class="s2">&quot;last_collection&quot;</span>:<span class="w"> </span><span class="s2">&quot;2025-10-03T12:15:00Z&quot;</span>,
<span class="w">  </span><span class="s2">&quot;next_collection&quot;</span>:<span class="w"> </span><span class="s2">&quot;2025-10-03T12:30:00Z&quot;</span>,
<span class="w">  </span><span class="s2">&quot;status&quot;</span>:<span class="w"> </span><span class="s2">&quot;healthy&quot;</span>,
<span class="w">  </span><span class="s2">&quot;data_points_today&quot;</span>:<span class="w"> </span><span class="m">8</span>
<span class="o">}</span>
</code></pre></div>

<h4 id="833-data-collection-scheduling">8.3.3 Data Collection Scheduling</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Configure data collection frequency (config.py)</span>
<span class="n">ANALYTICS_COLLECTION_INTERVAL</span> <span class="o">=</span> <span class="mi">15</span>  <span class="c1"># minutes</span>
<span class="n">ANALYTICS_MAX_DATA_POINTS_PER_DAY</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># Daily limit</span>

<span class="c1"># Enable/disable background services (default: disabled, i.e., 0)</span>
<span class="n">export</span> <span class="n">ENABLE_BACKGROUND_SERVICES</span><span class="o">=</span><span class="mi">1</span>  <span class="c1"># Enable background data collection</span>
<span class="n">export</span> <span class="n">ENABLE_BACKGROUND_SERVICES</span><span class="o">=</span><span class="mi">0</span>  <span class="c1"># Disable background data collection (default)</span>
</code></pre></div>

<h3 id="84-user-management">8.4 User Management</h3>
<h4 id="841-create-user">8.4.1 Create User</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Create via admin interface</span>
<span class="c1"># Visit: http://localhost:5000/admin/users/create</span>

<span class="c1"># Create via command line</span>
python<span class="w"> </span>scripts/create_user.py<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--email<span class="w"> </span>admin@hashinsight.net<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--username<span class="w"> </span>admin<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--role<span class="w"> </span>owner<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--password-prompt

<span class="c1"># Output:</span>
<span class="c1"># Please enter password: ********</span>
<span class="c1"># âœ… User created</span>
<span class="c1"># ID: 123</span>
<span class="c1"># Email: admin@hashinsight.net</span>
<span class="c1"># Role: owner</span>
</code></pre></div>

<h4 id="842-role-assignment">8.4.2 Role Assignment</h4>
<table>
<thead>
<tr>
<th>Role</th>
<th>Permissions</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>owner</code></td>
<td>All permissions</td>
<td>System owner</td>
</tr>
<tr>
<td><code>admin</code></td>
<td>Management permissions</td>
<td>System administrator</td>
</tr>
<tr>
<td><code>broker</code></td>
<td>Broker permissions</td>
<td>Customer management, orders</td>
</tr>
<tr>
<td><code>client</code></td>
<td>Client permissions</td>
<td>View own data</td>
</tr>
</tbody>
</table>
<div class="codehilite"><pre><span></span><code><span class="c1"># Change user role</span>
python<span class="w"> </span>scripts/change_user_role.py<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--user-id<span class="w"> </span><span class="m">123</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--new-role<span class="w"> </span>admin

<span class="c1"># Bulk import users</span>
python<span class="w"> </span>scripts/bulk_import_users.py<span class="w"> </span>--file<span class="w"> </span>users.csv
</code></pre></div>

<h4 id="843-permission-management">8.4.3 Permission Management</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check user permissions</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">decorators</span><span class="w"> </span><span class="kn">import</span> <span class="n">has_permission</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/miners/delete/&lt;int:miner_id&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DELETE&#39;</span><span class="p">])</span>
<span class="nd">@login_required</span>
<span class="nd">@requires_permission</span><span class="p">(</span><span class="s1">&#39;miners:delete&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">delete_miner</span><span class="p">(</span><span class="n">miner_id</span><span class="p">):</span>
    <span class="c1"># Only allow users with miners:delete permission</span>
    <span class="k">pass</span>
</code></pre></div>

<h3 id="85-data-cleanup">8.5 Data Cleanup</h3>
<h4 id="851-daily-data-point-limits">8.5.1 Daily Data Point Limits</h4>
<p>To control storage costs, HashInsight limits daily data points:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># config.py</span>
<span class="n">ANALYTICS_MAX_DATA_POINTS_PER_DAY</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># Max 10 data points per day</span>
</code></pre></div>

<h4 id="852-historical-data-archival">8.5.2 Historical Data Archival</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Archive data older than 90 days to cold storage</span>
python<span class="w"> </span>scripts/archive_historical_data.py<span class="w"> </span>--days<span class="w"> </span><span class="m">90</span><span class="w"> </span>--storage<span class="w"> </span>s3

<span class="c1"># Output:</span>
<span class="c1"># ğŸ“¦ Scanning data for archival...</span>
<span class="c1"># âœ… Archived 45,234 records to S3</span>
<span class="c1"># âœ… Deleted archived data from primary database</span>
<span class="c1"># â±ï¸  Duration: 12m 34s</span>
</code></pre></div>

<h3 id="86-monitoring-tasks">8.6 Monitoring Tasks</h3>
<h4 id="861-daily-health-check">8.6.1 Daily Health Check</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Run daily health check script</span>
python<span class="w"> </span>scripts/daily_health_check.py

<span class="c1"># Output:</span>
<span class="c1"># âœ… Application: Healthy</span>
<span class="c1"># âœ… Database: Connected, 15 active connections</span>
<span class="c1"># âœ… Cache: Redis available, 78.5% hit rate</span>
<span class="c1"># âœ… Disk space: 234 GB available (85% free)</span>
<span class="c1"># âœ… Backups: Latest backup 2 hours ago</span>
<span class="c1"># âœ… SSL certificates: Valid, expires in 45 days</span>
<span class="c1"># âš ï¸  Warning: API key &#39;hsi_prod_key_abc123&#39; expires in 7 days</span>
</code></pre></div>

<h4 id="862-weekly-reports">8.6.2 Weekly Reports</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Generate weekly operations report</span>
python<span class="w"> </span>scripts/weekly_report.py<span class="w"> </span>--email<span class="w"> </span>ops@hashinsight.net

<span class="c1"># Report includes:</span>
<span class="c1"># - System uptime and availability</span>
<span class="c1"># - Performance metrics (latency, error rate)</span>
<span class="c1"># - Resource usage trends</span>
<span class="c1"># - Security events</span>
<span class="c1"># - Backup status</span>
<span class="c1"># - Action items</span>
</code></pre></div>

<hr />
<h2 id="chapter-9-performance-tuning-guide">Chapter 9: Performance Tuning Guide</h2>
<h3 id="91-request-coalescing-optimization">9.1 Request Coalescing Optimization</h3>
<p>HashInsight implements Request Coalescing pattern to achieve <strong>9.8x performance improvement</strong>:</p>
<h4 id="how-it-works">How It Works</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Multiple concurrent identical requests merged into single request</span>
<span class="c1"># Example: 10 simultaneous &quot;get BTC price&quot; requests â†’ 1 API call</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">performance.request_coalescer</span><span class="w"> </span><span class="kn">import</span> <span class="n">RequestCoalescer</span>

<span class="n">coalescer</span> <span class="o">=</span> <span class="n">RequestCoalescer</span><span class="p">()</span>

<span class="nd">@coalescer</span><span class="o">.</span><span class="n">coalesce</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;btc_price&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_btc_price</span><span class="p">():</span>
    <span class="c1"># Expensive API call</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://api.coingecko.com/...&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

<span class="c1"># 10 concurrent calls to get_btc_price() â†’ Only 1 API call executed</span>
<span class="c1"># 9 requests wait for the first one to complete and share result</span>
</code></pre></div>

<h4 id="performance-metrics">Performance Metrics</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># View coalescing statistics</span>
curl<span class="w"> </span>http://localhost:5000/api/performance/coalescing-stats

<span class="c1"># Response</span>
<span class="o">{</span>
<span class="w">  </span><span class="s2">&quot;enabled&quot;</span>:<span class="w"> </span>true,
<span class="w">  </span><span class="s2">&quot;total_requests&quot;</span>:<span class="w"> </span><span class="m">98234</span>,
<span class="w">  </span><span class="s2">&quot;deduplicated_requests&quot;</span>:<span class="w"> </span><span class="m">85432</span>,
<span class="w">  </span><span class="s2">&quot;api_calls_saved&quot;</span>:<span class="w"> </span><span class="m">85432</span>,
<span class="w">  </span><span class="s2">&quot;performance_improvement&quot;</span>:<span class="w"> </span><span class="s2">&quot;9.8x&quot;</span>,
<span class="w">  </span><span class="s2">&quot;average_wait_time_ms&quot;</span>:<span class="w"> </span><span class="m">45</span>
<span class="o">}</span>
</code></pre></div>

<h3 id="92-database-optimization">9.2 Database Optimization</h3>
<h4 id="921-index-strategy">9.2.1 Index Strategy</h4>
<div class="codehilite"><pre><span></span><code><span class="c1">-- High-frequency query field indexes</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_miners_user_id</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">miners</span><span class="p">(</span><span class="n">user_id</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_market_data_timestamp</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">market_analytics</span><span class="p">(</span><span class="n">created_at</span><span class="w"> </span><span class="k">DESC</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_calculations_user_created</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">calculations</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span><span class="w"> </span><span class="n">created_at</span><span class="p">);</span>

<span class="c1">-- Composite indexes (commonly queried together)</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_miners_user_model</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">miners</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">);</span>

<span class="c1">-- Partial indexes (index only active data)</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_active_miners</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">miners</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;active&#39;</span><span class="p">;</span>
</code></pre></div>

<h4 id="922-query-optimization">9.2.2 Query Optimization</h4>
<p><strong>Use EXPLAIN to Analyze Queries</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">EXPLAIN</span><span class="w"> </span><span class="k">ANALYZE</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">username</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">miners</span><span class="w"> </span><span class="n">m</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;active&#39;</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">created_at</span><span class="w"> </span><span class="k">DESC</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>

<span class="c1">-- Review execution plan, optimize slow queries</span>
</code></pre></div>

<p><strong>Avoid N+1 Queries</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># âŒ Bad - N+1 queries</span>
<span class="n">miners</span> <span class="o">=</span> <span class="n">Miner</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="k">for</span> <span class="n">miner</span> <span class="ow">in</span> <span class="n">miners</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">miner</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="p">)</span>  <span class="c1"># One query per loop iteration</span>

<span class="c1"># âœ… Good - Use JOIN</span>
<span class="n">miners</span> <span class="o">=</span> <span class="n">Miner</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Miner</span><span class="o">.</span><span class="n">user_id</span> <span class="o">==</span> <span class="n">user_id</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="k">for</span> <span class="n">miner</span> <span class="ow">in</span> <span class="n">miners</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">miner</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="p">)</span>  <span class="c1"># Single query</span>
</code></pre></div>

<h4 id="923-connection-pool-tuning">9.2.3 Connection Pool Tuning</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># config.py</span>
<span class="n">SQLALCHEMY_ENGINE_OPTIONS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;pool_size&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>           <span class="c1"># Adjust based on concurrency (workers Ã— 2)</span>
    <span class="s1">&#39;pool_recycle&#39;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span>       <span class="c1"># Recycle connections after 5 minutes</span>
    <span class="s1">&#39;pool_pre_ping&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>     <span class="c1"># Test connection before use (Neon required)</span>
    <span class="s1">&#39;pool_timeout&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>        <span class="c1"># 30 second timeout</span>
    <span class="s1">&#39;max_overflow&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>        <span class="c1"># Max 20 overflow connections</span>
    <span class="s1">&#39;connect_args&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;connect_timeout&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>         <span class="c1"># Connection timeout</span>
        <span class="s1">&#39;application_name&#39;</span><span class="p">:</span> <span class="s1">&#39;hashinsight&#39;</span><span class="p">,</span>  <span class="c1"># For monitoring</span>
        <span class="s1">&#39;options&#39;</span><span class="p">:</span> <span class="s1">&#39;-c statement_timeout=30000&#39;</span>  <span class="c1"># Query timeout 30 seconds</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="93-caching-strategy">9.3 Caching Strategy</h3>
<h4 id="931-multi-tier-caching">9.3.1 Multi-tier Caching</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Three-tier cache architecture</span>
<span class="n">L1</span><span class="p">:</span> <span class="n">Memory</span> <span class="n">cache</span> <span class="p">(</span><span class="n">fastest</span><span class="p">,</span> <span class="n">smallest</span> <span class="n">capacity</span><span class="p">)</span>
    <span class="err">â†“</span> <span class="n">miss</span>
<span class="n">L2</span><span class="p">:</span> <span class="n">Redis</span> <span class="n">cache</span> <span class="p">(</span><span class="n">fast</span><span class="p">,</span> <span class="n">medium</span> <span class="n">capacity</span><span class="p">)</span>
    <span class="err">â†“</span> <span class="n">miss</span>
<span class="n">L3</span><span class="p">:</span> <span class="n">Database</span> <span class="p">(</span><span class="n">slowest</span><span class="p">,</span> <span class="n">largest</span> <span class="n">capacity</span><span class="p">)</span>

<span class="c1"># Implementation</span>
<span class="nd">@cache_manager</span><span class="o">.</span><span class="n">cached</span><span class="p">(</span><span class="n">ttl</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;L1&#39;</span><span class="p">)</span>  <span class="c1"># 5 minutes</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_user_profile</span><span class="p">(</span><span class="n">user_id</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>

<span class="nd">@cache_manager</span><span class="o">.</span><span class="n">cached</span><span class="p">(</span><span class="n">ttl</span><span class="o">=</span><span class="mi">3600</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;L2&#39;</span><span class="p">)</span>  <span class="c1"># 1 hour</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_market_data</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">fetch_from_api</span><span class="p">()</span>
</code></pre></div>

<h4 id="932-ttl-configuration">9.3.2 TTL Configuration</h4>
<table>
<thead>
<tr>
<th>Data Type</th>
<th>TTL</th>
<th>Reason</th>
</tr>
</thead>
<tbody>
<tr>
<td>User info</td>
<td>5 minutes</td>
<td>May change</td>
</tr>
<tr>
<td>Market data</td>
<td>5 minutes</td>
<td>Real-time requirement</td>
</tr>
<tr>
<td>Miner list</td>
<td>1 hour</td>
<td>Low change frequency</td>
</tr>
<tr>
<td>Statistics</td>
<td>10 minutes</td>
<td>Compute-intensive</td>
</tr>
<tr>
<td>Static content</td>
<td>24 hours</td>
<td>Rarely changes</td>
</tr>
</tbody>
</table>
<h4 id="933-cache-warming">9.3.3 Cache Warming</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Warm critical caches at startup</span>
python<span class="w"> </span>scripts/warmup_cache.py

<span class="c1"># Script contents:</span>
<span class="c1"># 1. Load popular user data</span>
<span class="c1"># 2. Load current market data</span>
<span class="c1"># 3. Pre-calculate statistics</span>
<span class="c1"># 4. Load configuration data</span>

<span class="c1"># Output:</span>
<span class="c1"># âœ… Warmed user cache: 1,234 entries</span>
<span class="c1"># âœ… Warmed market data: Current price + hashrate</span>
<span class="c1"># âœ… Warmed statistics: 10 dashboards</span>
<span class="c1"># â±ï¸  Duration: 12.3s</span>
</code></pre></div>

<h3 id="94-batch-processing-optimization">9.4 Batch Processing Optimization</h3>
<h4 id="941-vectorized-computation">9.4.1 Vectorized Computation</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># âŒ Bad - Individual calculation</span>
<span class="k">for</span> <span class="n">miner</span> <span class="ow">in</span> <span class="n">miners</span><span class="p">:</span>
    <span class="n">daily_revenue</span> <span class="o">=</span> <span class="n">calculate_revenue</span><span class="p">(</span>
        <span class="n">miner</span><span class="o">.</span><span class="n">hashrate</span><span class="p">,</span> 
        <span class="n">btc_price</span><span class="p">,</span> 
        <span class="n">network_difficulty</span>
    <span class="p">)</span>
<span class="c1"># Duration: 5000 miners Ã— 10ms = 50 seconds</span>

<span class="c1"># âœ… Good - Vectorized calculation</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">hashrates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">m</span><span class="o">.</span><span class="n">hashrate</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">miners</span><span class="p">])</span>
<span class="n">revenues</span> <span class="o">=</span> <span class="n">calculate_revenue_vectorized</span><span class="p">(</span>
    <span class="n">hashrates</span><span class="p">,</span> 
    <span class="n">btc_price</span><span class="p">,</span> 
    <span class="n">network_difficulty</span>
<span class="p">)</span>
<span class="c1"># Duration: ~500ms (100x improvement)</span>
</code></pre></div>

<h4 id="942-concurrent-processing">9.4.2 Concurrent Processing</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">concurrent.futures</span><span class="w"> </span><span class="kn">import</span> <span class="n">ThreadPoolExecutor</span>

<span class="c1"># Concurrent batch processing</span>
<span class="k">def</span><span class="w"> </span><span class="nf">process_miner_batch</span><span class="p">(</span><span class="n">miners</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
        <span class="n">futures</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">miners</span><span class="p">),</span> <span class="n">batch_size</span><span class="p">):</span>
            <span class="n">batch</span> <span class="o">=</span> <span class="n">miners</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">batch_size</span><span class="p">]</span>
            <span class="n">future</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">process_batch</span><span class="p">,</span> <span class="n">batch</span><span class="p">)</span>
            <span class="n">futures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">result</span><span class="p">()</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">futures</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">results</span>
</code></pre></div>

<h4 id="943-memory-optimization">9.4.3 Memory Optimization</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Batch insert (avoid ORM overhead)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">insert</span>

<span class="c1"># âŒ Bad - Individual inserts</span>
<span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">large_dataset</span><span class="p">:</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Model</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">))</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>  <span class="c1"># Commit each time</span>

<span class="c1"># âœ… Good - Batch insert</span>
<span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">bulk_insert_mappings</span><span class="p">(</span><span class="n">Model</span><span class="p">,</span> <span class="n">large_dataset</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>  <span class="c1"># Single commit</span>

<span class="c1"># âœ… Better - Use bulk insert</span>
<span class="n">stmt</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="n">Model</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">large_dataset</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</code></pre></div>

<h3 id="95-performance-monitoring">9.5 Performance Monitoring</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Regularly run performance benchmarks</span>
python<span class="w"> </span>scripts/performance_benchmark.py

<span class="c1"># Output:</span>
<span class="c1"># ğŸ“Š API response times:</span>
<span class="c1">#   - /api/miners: p50=45ms, p95=120ms, p99=250ms âœ…</span>
<span class="c1">#   - /api/dashboard: p50=80ms, p95=200ms, p99=400ms âœ…</span>
<span class="c1"># ğŸ“Š Database queries:</span>
<span class="c1">#   - Average query time: 15ms âœ…</span>
<span class="c1">#   - Slow queries (&gt;1s): 0 âœ…</span>
<span class="c1"># ğŸ“Š Cache performance:</span>
<span class="c1">#   - Hit rate: 78.5% âœ…</span>
<span class="c1">#   - Request Coalescing: 9.8x improvement âœ…</span>
</code></pre></div>

<hr />
<h2 id="chapter-10-emergency-response">Chapter 10: Emergency Response</h2>
<h3 id="101-on-call-rotation">10.1 On-Call Rotation</h3>
<h4 id="rotation-schedule">Rotation Schedule</h4>
<table>
<thead>
<tr>
<th>Time Period</th>
<th>Primary On-Call</th>
<th>Backup On-Call</th>
<th>Escalation Contact</th>
</tr>
</thead>
<tbody>
<tr>
<td>Weekdays 09:00-18:00</td>
<td>DevOps Engineer</td>
<td>Backend Engineer</td>
<td>Technical Director</td>
</tr>
<tr>
<td>Weekdays 18:00-09:00</td>
<td>Rotation Engineer</td>
<td>Backup Engineer</td>
<td>On-Call Manager</td>
</tr>
<tr>
<td>Weekends/Holidays</td>
<td>Rotation Engineer</td>
<td>Backup Engineer</td>
<td>On-Call Manager</td>
</tr>
</tbody>
</table>
<h4 id="on-call-tools">On-Call Tools</h4>
<ul>
<li>ğŸ“± <strong>PagerDuty</strong>: Alert notifications</li>
<li>ğŸ’¬ <strong>Slack</strong>: #incident-response channel</li>
<li>ğŸ“Š <strong>Grafana</strong>: Real-time monitoring</li>
<li>ğŸ“ <strong>Incident.io</strong>: Incident management</li>
</ul>
<h3 id="102-incident-severity-levels">10.2 Incident Severity Levels</h3>
<table>
<thead>
<tr>
<th>Level</th>
<th>Impact</th>
<th>Response Time</th>
<th>Escalation Time</th>
<th>Examples</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>P0</strong></td>
<td>Complete service outage</td>
<td>15 minutes</td>
<td>30 minutes</td>
<td>Database down, application inaccessible</td>
</tr>
<tr>
<td><strong>P1</strong></td>
<td>Core functionality degraded</td>
<td>30 minutes</td>
<td>1 hour</td>
<td>API latency &gt;5s, error rate &gt;5%</td>
</tr>
<tr>
<td><strong>P2</strong></td>
<td>Partial functionality failure</td>
<td>2 hours</td>
<td>4 hours</td>
<td>Single feature unavailable</td>
</tr>
<tr>
<td><strong>P3</strong></td>
<td>Performance degradation</td>
<td>4 hours</td>
<td>8 hours</td>
<td>Slower response but functional</td>
</tr>
<tr>
<td><strong>P4</strong></td>
<td>Non-urgent issues</td>
<td>1 business day</td>
<td>2 business days</td>
<td>UI display issues, minor bugs</td>
</tr>
</tbody>
</table>
<h3 id="103-response-process">10.3 Response Process</h3>
<h4 id="p0p1-critical-incident-process">P0/P1 Critical Incident Process</h4>
<div class="codehilite"><pre><span></span><code><span class="mf">1.</span><span class="w"> </span><span class="err">[</span><span class="mf">0</span><span class="o">-</span><span class="mf">5</span><span class="w"> </span><span class="n">minutes</span><span class="err">]</span><span class="w"> </span><span class="n">Alert</span><span class="w"> </span><span class="n">triggered</span>
<span class="w">   </span><span class="err">â”œâ†’</span><span class="w"> </span><span class="n">PagerDuty</span><span class="w"> </span><span class="ow">not</span><span class="kr">if</span><span class="n">ies</span><span class="w"> </span><span class="n">primary</span><span class="w"> </span><span class="kr">on</span><span class="o">-</span><span class="n">call</span>
<span class="w">   </span><span class="err">â”œâ†’</span><span class="w"> </span><span class="n">Automatically</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">Slack</span><span class="w"> </span><span class="n">incident</span><span class="w"> </span><span class="n">channel</span>
<span class="w">   </span><span class="err">â””â†’</span><span class="w"> </span><span class="n">Automatically</span><span class="w"> </span><span class="ow">not</span><span class="kr">if</span><span class="n">y</span><span class="w"> </span><span class="n">backup</span><span class="w"> </span><span class="kr">on</span><span class="o">-</span><span class="n">call</span>

<span class="mf">2.</span><span class="w"> </span><span class="err">[</span><span class="mf">5</span><span class="o">-</span><span class="mf">15</span><span class="w"> </span><span class="n">minutes</span><span class="err">]</span><span class="w"> </span><span class="n">Initial</span><span class="w"> </span><span class="n">response</span>
<span class="w">   </span><span class="err">â”œâ†’</span><span class="w"> </span><span class="n">Acknowledge</span><span class="w"> </span><span class="n">incident</span><span class="w"> </span><span class="p">(</span><span class="n">ACK</span><span class="w"> </span><span class="n">alert</span><span class="p">)</span>
<span class="w">   </span><span class="err">â”œâ†’</span><span class="w"> </span><span class="nb">Pos</span><span class="n">t</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="n">update</span>
<span class="w">   </span><span class="err">â”œâ†’</span><span class="w"> </span><span class="n">Begin</span><span class="w"> </span><span class="n">troubleshooting</span>
<span class="w">   </span><span class="err">â””â†’</span><span class="w"> </span><span class="n">Record</span><span class="w"> </span><span class="n">timeline</span>

<span class="mf">3.</span><span class="w"> </span><span class="err">[</span><span class="mf">15</span><span class="o">-</span><span class="mf">30</span><span class="w"> </span><span class="n">minutes</span><span class="err">]</span><span class="w"> </span><span class="n">Emergency</span><span class="w"> </span><span class="n">mitigation</span>
<span class="w">   </span><span class="err">â”œâ†’</span><span class="w"> </span><span class="n">Implement</span><span class="w"> </span><span class="n">temporary</span><span class="w"> </span><span class="n">mitigation</span>
<span class="w">   </span><span class="err">â”œâ†’</span><span class="w"> </span><span class="n">Assess</span><span class="w"> </span><span class="n">impact</span><span class="w"> </span><span class="n">scope</span>
<span class="w">   </span><span class="err">â”œâ†’</span><span class="w"> </span><span class="n">Decide</span><span class="w"> </span><span class="n">whether</span><span class="w"> </span><span class="kr">to</span><span class="w"> </span><span class="n">escalate</span>
<span class="w">   </span><span class="err">â””â†’</span><span class="w"> </span><span class="n">Update</span><span class="w"> </span><span class="n">incident</span><span class="w"> </span><span class="n">status</span>

<span class="mf">4.</span><span class="w"> </span><span class="err">[</span><span class="mf">30</span><span class="w"> </span><span class="n">minutes</span><span class="o">+</span><span class="err">]</span><span class="w"> </span><span class="n">Full</span><span class="w"> </span><span class="n">resolution</span>
<span class="w">   </span><span class="err">â”œâ†’</span><span class="w"> </span><span class="n">Implement</span><span class="w"> </span><span class="n">permanent</span><span class="w"> </span><span class="n">fix</span>
<span class="w">   </span><span class="err">â”œâ†’</span><span class="w"> </span><span class="kr">Verify</span><span class="w"> </span><span class="n">service</span><span class="w"> </span><span class="n">recovery</span>
<span class="w">   </span><span class="err">â”œâ†’</span><span class="w"> </span><span class="nb">Pos</span><span class="n">t</span><span class="w"> </span><span class="n">recovery</span><span class="w"> </span><span class="n">announcement</span>
<span class="w">   </span><span class="err">â””â†’</span><span class="w"> </span><span class="n">Begin</span><span class="w"> </span><span class="nb">pos</span><span class="n">t</span><span class="o">-</span><span class="n">incident</span><span class="w"> </span><span class="n">review</span>
</code></pre></div>

<h3 id="104-common-emergency-scenarios">10.4 Common Emergency Scenarios</h3>
<h4 id="scenario-1-database-connection-pool-exhausted">Scenario 1: Database Connection Pool Exhausted</h4>
<p><strong>Symptoms</strong></p>
<div class="codehilite"><pre><span></span><code>sqlalchemy.exc.TimeoutError: QueuePool limit of size 10 overflow 20 reached
</code></pre></div>

<p><strong>Emergency Response</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># 1. Immediately kill long idle connections</span>
psql<span class="w"> </span><span class="nv">$DATABASE_URL</span><span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;</span>
<span class="s2">SELECT pg_terminate_backend(pid)</span>
<span class="s2">FROM pg_stat_activity</span>
<span class="s2">WHERE state = &#39;idle&#39; </span>
<span class="s2">  AND state_change &lt; NOW() - INTERVAL &#39;10 minutes&#39;;</span>
<span class="s2">&quot;</span>

<span class="c1"># 2. Increase connection pool limits (temporary)</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">SQLALCHEMY_POOL_SIZE</span><span class="o">=</span><span class="m">20</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">SQLALCHEMY_MAX_OVERFLOW</span><span class="o">=</span><span class="m">40</span>

<span class="c1"># 3. Restart application</span>
systemctl<span class="w"> </span>restart<span class="w"> </span>hashinsight

<span class="c1"># 4. Monitor connection count</span>
watch<span class="w"> </span>-n<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="s2">&quot;psql </span><span class="nv">$DATABASE_URL</span><span class="s2"> -c &#39;SELECT count(*) FROM pg_stat_activity;&#39;&quot;</span>
</code></pre></div>

<h4 id="scenario-2-memory-leak-causing-oom">Scenario 2: Memory Leak Causing OOM</h4>
<p><strong>Symptoms</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">MemoryError</span><span class="o">:</span><span class="w"> </span><span class="n">Unable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">allocate</span><span class="w"> </span><span class="n">array</span>
<span class="n">Killed</span><span class="w"> </span><span class="o">(</span><span class="n">OOM</span><span class="o">)</span>
</code></pre></div>

<p><strong>Emergency Response</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># 1. Immediately restart affected worker</span>
<span class="nb">kill</span><span class="w"> </span>-HUP<span class="w"> </span><span class="k">$(</span>cat<span class="w"> </span>/var/run/gunicorn.pid<span class="k">)</span>

<span class="c1"># 2. Clear cache to free memory</span>
redis-cli<span class="w"> </span>FLUSHDB

<span class="c1"># 3. Limit worker count (temporary)</span>
gunicorn<span class="w"> </span>--workers<span class="w"> </span><span class="m">2</span><span class="w"> </span>--max-requests<span class="w"> </span><span class="m">500</span><span class="w"> </span>main:app

<span class="c1"># 4. Monitor memory usage</span>
watch<span class="w"> </span>-n<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="s1">&#39;free -h&#39;</span>
</code></pre></div>

<h4 id="scenario-3-malicious-traffic-attack">Scenario 3: Malicious Traffic Attack</h4>
<p><strong>Symptoms</strong>
- Abnormally high request volume
- Many 401/403 errors
- Suspicious requests from specific IP ranges</p>
<p><strong>Emergency Response</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># 1. Enable rate limiting</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">RATE_LIMIT_ENABLED</span><span class="o">=</span><span class="nb">true</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">RATE_LIMIT_REQUESTS_PER_MINUTE</span><span class="o">=</span><span class="m">10</span>

<span class="c1"># 2. Block malicious IPs (via firewall)</span>
ufw<span class="w"> </span>deny<span class="w"> </span>from<span class="w"> </span><span class="m">192</span>.168.1.0/24

<span class="c1"># 3. Enable Cloudflare protection (if using)</span>
<span class="c1"># Visit Cloudflare Dashboard -&gt; Security -&gt; DDoS</span>

<span class="c1"># 4. Analyze attack patterns</span>
tail<span class="w"> </span>-1000<span class="w"> </span>/var/log/gunicorn/access.log<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>awk<span class="w"> </span><span class="s1">&#39;{print $1}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span><span class="p">|</span><span class="w"> </span>uniq<span class="w"> </span>-c<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-rn<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-20
</code></pre></div>

<h3 id="105-rollback-procedures">10.5 Rollback Procedures</h3>
<h4 id="code-rollback">Code Rollback</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># 1. Determine rollback version</span>
git<span class="w"> </span>log<span class="w"> </span>--oneline<span class="w"> </span>-10

<span class="c1"># 2. Rollback to last stable version</span>
git<span class="w"> </span>revert<span class="w"> </span>HEAD<span class="w"> </span>--no-edit
<span class="c1"># Or</span>
git<span class="w"> </span>checkout<span class="w"> </span>v1.9.5

<span class="c1"># 3. Redeploy</span>
git<span class="w"> </span>push<span class="w"> </span>origin<span class="w"> </span>main

<span class="c1"># 4. Verify rollback success</span>
curl<span class="w"> </span>http://localhost:5000/health<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;.version&#39;</span>

<span class="c1"># 5. Notify team</span>
<span class="c1"># Slack: &quot;Rolled back to v1.9.5, service restored&quot;</span>
</code></pre></div>

<h4 id="database-rollback">Database Rollback</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># âš ï¸ Warning: Database rollback is high-risk, must backup first!</span>

<span class="c1"># 1. Create current state backup</span>
python<span class="w"> </span>backup/backup_manager.py<span class="w"> </span>--type<span class="w"> </span>emergency

<span class="c1"># 2. Restore to rollback point</span>
psql<span class="w"> </span><span class="nv">$DATABASE_URL</span><span class="w"> </span>&lt;<span class="w"> </span>/tmp/backups/hashinsight_backup_20251003_020000.sql

<span class="c1"># 3. Verify data integrity</span>
python<span class="w"> </span>scripts/verify_database_integrity.py

<span class="c1"># 4. Restart application</span>
systemctl<span class="w"> </span>restart<span class="w"> </span>hashinsight
</code></pre></div>

<h3 id="106-communication-templates">10.6 Communication Templates</h3>
<h4 id="initial-incident-announcement">Initial Incident Announcement</h4>
<div class="codehilite"><pre><span></span><code><span class="err">ğŸ“¢</span><span class="w"> </span><span class="p">[</span><span class="n">P0</span><span class="w"> </span><span class="n">Incident</span><span class="p">]</span><span class="w"> </span><span class="n">HashInsight</span><span class="w"> </span><span class="n">Service</span><span class="w"> </span><span class="n">Outage</span>

<span class="nl">Time</span><span class="p">:</span><span class="w"> </span><span class="mi">2025-10</span><span class="mo">-03</span><span class="w"> </span><span class="mi">14</span><span class="o">:</span><span class="mi">23</span><span class="w"> </span><span class="n">UTC</span>
<span class="nl">Impact</span><span class="p">:</span><span class="w"> </span><span class="n">All</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="n">unable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">access</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">application</span>
<span class="nl">Status</span><span class="p">:</span><span class="w"> </span><span class="n">Under</span><span class="w"> </span><span class="n">investigation</span>

<span class="n">We</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">confirmed</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">service</span><span class="w"> </span><span class="n">outage</span><span class="p">,</span><span class="w"> </span><span class="n">team</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">urgently</span><span class="w"> </span><span class="n">investigating</span><span class="p">.</span>
<span class="n">Will</span><span class="w"> </span><span class="n">provide</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="n">within</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="n">minutes</span><span class="p">.</span>

<span class="n">Incident</span><span class="w"> </span><span class="n">channel</span><span class="o">:</span><span class="w"> </span><span class="err">#</span><span class="n">incident</span><span class="mi">-2025-10</span><span class="mo">-03</span><span class="o">-</span><span class="n">db</span><span class="o">-</span><span class="n">outage</span>
<span class="n">On</span><span class="o">-</span><span class="n">call</span><span class="w"> </span><span class="n">engineer</span><span class="o">:</span><span class="w"> </span><span class="p">@</span><span class="n">john</span><span class="p">.</span><span class="n">doe</span>
</code></pre></div>

<h4 id="progress-update">Progress Update</h4>
<div class="codehilite"><pre><span></span><code><span class="err">ğŸ”„</span><span class="w"> </span><span class="o">[</span><span class="n">Update</span><span class="o">]</span><span class="w"> </span><span class="n">HashInsight</span><span class="w"> </span><span class="n">Incident</span><span class="w"> </span><span class="n">Progress</span>

<span class="nc">Time</span><span class="err">:</span><span class="w"> </span><span class="mi">2025</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">03</span><span class="w"> </span><span class="mi">14</span><span class="err">:</span><span class="mi">45</span><span class="w"> </span><span class="n">UTC</span>
<span class="n">Root</span><span class="w"> </span><span class="nl">cause</span><span class="p">:</span><span class="w"> </span><span class="k">Database</span><span class="w"> </span><span class="k">connection</span><span class="w"> </span><span class="n">pool</span><span class="w"> </span><span class="n">exhausted</span>
<span class="nl">Mitigation</span><span class="p">:</span><span class="w"> </span><span class="n">Restarted</span><span class="w"> </span><span class="k">database</span><span class="w"> </span><span class="k">connection</span><span class="w"> </span><span class="n">pool</span>
<span class="k">Current</span><span class="w"> </span><span class="nl">status</span><span class="p">:</span><span class="w"> </span><span class="n">Service</span><span class="w"> </span><span class="n">partially</span><span class="w"> </span><span class="n">restored</span><span class="p">,</span><span class="w"> </span><span class="n">monitoring</span>

<span class="k">Next</span><span class="w"> </span><span class="k">update</span><span class="err">:</span><span class="w"> </span><span class="mi">15</span><span class="err">:</span><span class="mi">00</span><span class="w"> </span><span class="n">UTC</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">major</span><span class="w"> </span><span class="n">progress</span><span class="w"> </span><span class="n">made</span>
</code></pre></div>

<h4 id="recovery-announcement">Recovery Announcement</h4>
<div class="codehilite"><pre><span></span><code><span class="err">âœ…</span><span class="w"> </span><span class="o">[</span><span class="n">Resolved</span><span class="o">]</span><span class="w"> </span><span class="n">HashInsight</span><span class="w"> </span><span class="n">Service</span><span class="w"> </span><span class="n">Restored</span>

<span class="nc">Time</span><span class="err">:</span><span class="w"> </span><span class="mi">2025</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">03</span><span class="w"> </span><span class="mi">15</span><span class="err">:</span><span class="mi">12</span><span class="w"> </span><span class="n">UTC</span>
<span class="nl">Duration</span><span class="p">:</span><span class="w"> </span><span class="mi">49</span><span class="w"> </span><span class="n">minutes</span>
<span class="n">Root</span><span class="w"> </span><span class="nl">cause</span><span class="p">:</span><span class="w"> </span><span class="n">Improper</span><span class="w"> </span><span class="n">PostgreSQL</span><span class="w"> </span><span class="k">connection</span><span class="w"> </span><span class="n">pool</span><span class="w"> </span><span class="n">configuration</span>
<span class="nl">Solution</span><span class="p">:</span><span class="w"> </span><span class="n">Increased</span><span class="w"> </span><span class="k">connection</span><span class="w"> </span><span class="n">pool</span><span class="w"> </span><span class="n">limits</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">optimized</span><span class="w"> </span><span class="n">slow</span><span class="w"> </span><span class="n">queries</span>

<span class="ow">All</span><span class="w"> </span><span class="n">services</span><span class="w"> </span><span class="n">now</span><span class="w"> </span><span class="n">fully</span><span class="w"> </span><span class="n">restored</span><span class="p">.</span>
<span class="n">Post</span><span class="o">-</span><span class="n">incident</span><span class="w"> </span><span class="n">review</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">published</span><span class="w"> </span><span class="k">within</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="n">hours</span><span class="p">.</span>

<span class="n">Thank</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">patience</span><span class="p">.</span>
</code></pre></div>

<h3 id="107-post-incident-review-postmortem">10.7 Post-Incident Review (Postmortem)</h3>
<h4 id="template">Template</h4>
<div class="codehilite"><pre><span></span><code><span class="gh"># HashInsight Incident Report - 2025-10-03 Database Outage</span>

<span class="gu">## Summary</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**Incident ID**</span>: INC-2025-1003-001
<span class="k">-</span><span class="w"> </span><span class="gs">**Severity**</span>: P0
<span class="k">-</span><span class="w"> </span><span class="gs">**Start Time**</span>: 2025-10-03 14:23 UTC
<span class="k">-</span><span class="w"> </span><span class="gs">**Recovery Time**</span>: 2025-10-03 15:12 UTC
<span class="k">-</span><span class="w"> </span><span class="gs">**Duration**</span>: 49 minutes
<span class="k">-</span><span class="w"> </span><span class="gs">**Affected Users**</span>: 100% (all users)

<span class="gu">## Timeline</span>
<span class="k">-</span><span class="w"> </span>14:23 - Prometheus alert: Database connection failure
<span class="k">-</span><span class="w"> </span>14:25 - On-call engineer confirms incident
<span class="k">-</span><span class="w"> </span>14:30 - Identified connection pool exhaustion
<span class="k">-</span><span class="w"> </span>14:35 - Implemented temporary mitigation (killed idle connections)
<span class="k">-</span><span class="w"> </span>14:45 - Service partially restored
<span class="k">-</span><span class="w"> </span>15:00 - Implemented permanent fix (increased connection pool)
<span class="k">-</span><span class="w"> </span>15:12 - Service fully restored

<span class="gu">## Root Cause</span>
PostgreSQL connection pool size configured at 10, but actual concurrent
demand reached 30+, causing connection wait timeouts.

<span class="gu">## Resolution</span>
<span class="k">1.</span> Temporary: Killed idle connections, freed connection pool
<span class="k">2.</span> Permanent: Increased connection pool size to 20, overflow to 40
<span class="k">3.</span> Optimization: Identified and optimized 3 slow queries

<span class="gu">## Prevention Measures</span>
<span class="k">- [ ]</span> Set connection pool alerts (usage &gt;80%)
<span class="k">- [ ]</span> Regular slow query review
<span class="k">- [ ]</span> Add capacity planning process
<span class="k">- [ ]</span> Add connection pool monitoring dashboard

<span class="gu">## Lessons Learned</span>
âœ… Quick response and good communication
âŒ Lacked connection pool monitoring
âŒ Insufficient capacity planning
</code></pre></div>

<hr />
<h2 id="appendices">Appendices</h2>
<h3 id="appendix-a-quick-command-reference">Appendix A: Quick Command Reference</h3>
<h4 id="application-management">Application Management</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Start application</span>
gunicorn<span class="w"> </span>--bind<span class="w"> </span><span class="m">0</span>.0.0.0:5000<span class="w"> </span>--workers<span class="w"> </span><span class="m">4</span><span class="w"> </span>main:app

<span class="c1"># Graceful restart</span>
<span class="nb">kill</span><span class="w"> </span>-HUP<span class="w"> </span><span class="k">$(</span>cat<span class="w"> </span>/var/run/gunicorn.pid<span class="k">)</span>

<span class="c1"># Stop application</span>
<span class="nb">kill</span><span class="w"> </span>-TERM<span class="w"> </span><span class="k">$(</span>cat<span class="w"> </span>/var/run/gunicorn.pid<span class="k">)</span>

<span class="c1"># View processes</span>
ps<span class="w"> </span>aux<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>gunicorn

<span class="c1"># View logs</span>
tail<span class="w"> </span>-f<span class="w"> </span>/var/log/hashinsight/app.log
</code></pre></div>

<h4 id="database">Database</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Connect to database</span>
psql<span class="w"> </span><span class="nv">$DATABASE_URL</span>

<span class="c1"># View tables</span>
<span class="se">\d</span>t

<span class="c1"># View connection count</span>
SELECT<span class="w"> </span>count<span class="o">(</span>*<span class="o">)</span><span class="w"> </span>FROM<span class="w"> </span>pg_stat_activity<span class="p">;</span>

<span class="c1"># Backup database</span>
pg_dump<span class="w"> </span><span class="nv">$DATABASE_URL</span><span class="w"> </span>&gt;<span class="w"> </span>backup.sql

<span class="c1"># Restore database</span>
psql<span class="w"> </span><span class="nv">$DATABASE_URL</span><span class="w"> </span>&lt;<span class="w"> </span>backup.sql
</code></pre></div>

<h4 id="cache">Cache</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Redis connection</span>
redis-cli

<span class="c1"># View all keys</span>
redis-cli<span class="w"> </span>KEYS<span class="w"> </span><span class="s1">&#39;hashinsight:*&#39;</span>

<span class="c1"># Clear cache</span>
redis-cli<span class="w"> </span>FLUSHDB

<span class="c1"># View memory usage</span>
redis-cli<span class="w"> </span>INFO<span class="w"> </span>memory
</code></pre></div>

<h4 id="monitoring">Monitoring</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># View health status</span>
curl<span class="w"> </span>http://localhost:5000/health<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq

<span class="c1"># View Prometheus metrics</span>
curl<span class="w"> </span>http://localhost:9090/metrics

<span class="c1"># View SLO status</span>
curl<span class="w"> </span>http://localhost:5000/api/slo/status<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq
</code></pre></div>

<h3 id="appendix-b-configuration-file-examples">Appendix B: Configuration File Examples</h3>
<h4 id="env-example">.env Example</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Required configuration</span>
<span class="nv">DATABASE_URL</span><span class="o">=</span>postgresql://user:pass@host:5432/hashinsight_db
<span class="nv">SESSION_SECRET</span><span class="o">=</span>your-secret-key-min-32-chars
<span class="nv">ENCRYPTION_PASSWORD</span><span class="o">=</span>encryption-key-min-32-chars

<span class="c1"># Blockchain configuration</span>
<span class="nv">BLOCKCHAIN_ENABLED</span><span class="o">=</span><span class="nb">true</span>
<span class="nv">BLOCKCHAIN_PRIVATE_KEY</span><span class="o">=</span>0x1234567890abcdef...
<span class="nv">BLOCKCHAIN_NETWORK</span><span class="o">=</span>base-sepolia
<span class="nv">BASE_RPC_URL</span><span class="o">=</span>https://sepolia.base.org

<span class="c1"># Backup configuration</span>
<span class="nv">BACKUP_DIR</span><span class="o">=</span>/var/backups/hashinsight
<span class="nv">BACKUP_ENCRYPTION_KEY</span><span class="o">=</span>backup-encryption-key
<span class="nv">BACKUP_RETENTION_DAYS</span><span class="o">=</span><span class="m">30</span>
<span class="nv">BACKUP_STORAGE_TYPE</span><span class="o">=</span>s3
<span class="nv">BACKUP_STORAGE_BUCKET</span><span class="o">=</span>hashinsight-backups

<span class="c1"># KMS configuration (AWS)</span>
<span class="nv">AWS_KMS_KEY_ID</span><span class="o">=</span>arn:aws:kms:us-east-1:123456789:key/xxxxx
<span class="nv">AWS_KMS_REGION</span><span class="o">=</span>us-east-1
<span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=</span>AKIAXXXXXXXX
<span class="nv">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span>xxxxxxxxxx

<span class="c1"># Monitoring configuration</span>
<span class="nv">ENABLE_BACKGROUND_SERVICES</span><span class="o">=</span><span class="m">0</span><span class="w">  </span><span class="c1"># Default: disabled; set to 1 to enable background data collection</span>
<span class="nv">PROMETHEUS_PORT</span><span class="o">=</span><span class="m">9090</span>
<span class="nv">SLO_MEASUREMENT_WINDOW</span><span class="o">=</span><span class="m">30</span>

<span class="c1"># API configuration</span>
<span class="nv">COINWARZ_API_KEY</span><span class="o">=</span>your-coinwarz-api-key
<span class="nv">COINGECKO_API_KEY</span><span class="o">=</span>your-coingecko-api-key
</code></pre></div>

<h4 id="systemd-service-file-example">systemd Service File Example</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># /etc/systemd/system/hashinsight.service</span>

<span class="k">[Unit]</span>
<span class="na">Description</span><span class="o">=</span><span class="s">HashInsight Platform</span>
<span class="na">After</span><span class="o">=</span><span class="s">network.target postgresql.service</span>

<span class="k">[Service]</span>
<span class="na">Type</span><span class="o">=</span><span class="s">notify</span>
<span class="na">User</span><span class="o">=</span><span class="s">hashinsight</span>
<span class="na">Group</span><span class="o">=</span><span class="s">hashinsight</span>
<span class="na">WorkingDirectory</span><span class="o">=</span><span class="s">/opt/hashinsight</span>
<span class="na">EnvironmentFile</span><span class="o">=</span><span class="s">/opt/hashinsight/.env</span>

<span class="na">ExecStart</span><span class="o">=</span><span class="s">/opt/hashinsight/venv/bin/gunicorn </span>\
<span class="w">  </span><span class="s">--bind 0.0.0.0:5000 </span>\
<span class="w">  </span><span class="s">--workers 4 </span>\
<span class="w">  </span><span class="s">--threads 2 </span>\
<span class="w">  </span><span class="s">--worker-class gthread </span>\
<span class="w">  </span><span class="s">--timeout 120 </span>\
<span class="w">  </span><span class="s">--max-requests 1000 </span>\
<span class="w">  </span><span class="s">--access-logfile /var/log/hashinsight/access.log </span>\
<span class="w">  </span><span class="s">--error-logfile /var/log/hashinsight/error.log </span>\
<span class="w">  </span><span class="s">--pid /var/run/gunicorn.pid </span>\
<span class="w">  </span><span class="s">main:app</span>

<span class="na">ExecReload</span><span class="o">=</span><span class="s">/bin/kill -s HUP $MAINPID</span>
<span class="na">KillMode</span><span class="o">=</span><span class="s">mixed</span>
<span class="na">KillSignal</span><span class="o">=</span><span class="s">SIGTERM</span>
<span class="na">TimeoutStopSec</span><span class="o">=</span><span class="s">30</span>

<span class="na">Restart</span><span class="o">=</span><span class="s">on-failure</span>
<span class="na">RestartSec</span><span class="o">=</span><span class="s">10</span>

<span class="k">[Install]</span>
<span class="na">WantedBy</span><span class="o">=</span><span class="s">multi-user.target</span>
</code></pre></div>

<h3 id="appendix-c-monitoring-metrics-reference">Appendix C: Monitoring Metrics Reference</h3>
<h4 id="prometheus-metrics-list">Prometheus Metrics List</h4>
<table>
<thead>
<tr>
<th>Metric Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>hashinsight_requests_total</code></td>
<td>Counter</td>
<td>Total request count</td>
</tr>
<tr>
<td><code>hashinsight_request_latency_seconds</code></td>
<td>Histogram</td>
<td>Request latency</td>
</tr>
<tr>
<td><code>hashinsight_error_rate</code></td>
<td>Gauge</td>
<td>Error rate</td>
</tr>
<tr>
<td><code>hashinsight_cache_hit_rate</code></td>
<td>Gauge</td>
<td>Cache hit rate</td>
</tr>
<tr>
<td><code>hashinsight_db_query_duration_seconds</code></td>
<td>Histogram</td>
<td>Database query duration</td>
</tr>
<tr>
<td><code>hashinsight_db_connection_pool_size</code></td>
<td>Gauge</td>
<td>Database connection pool size</td>
</tr>
<tr>
<td><code>hashinsight_db_connection_pool_active</code></td>
<td>Gauge</td>
<td>Active connection count</td>
</tr>
<tr>
<td><code>hashinsight_slo_compliance</code></td>
<td>Gauge</td>
<td>SLO compliance</td>
</tr>
<tr>
<td><code>hashinsight_slo_error_budget_remaining</code></td>
<td>Gauge</td>
<td>Error budget remaining</td>
</tr>
<tr>
<td><code>hashinsight_circuit_breaker_state</code></td>
<td>Gauge</td>
<td>Circuit breaker state</td>
</tr>
</tbody>
</table>
<h4 id="slo-thresholds">SLO Thresholds</h4>
<table>
<thead>
<tr>
<th>SLO Type</th>
<th>Target</th>
<th>Warning Threshold</th>
<th>Critical Threshold</th>
</tr>
</thead>
<tbody>
<tr>
<td>Availability</td>
<td>99.95%</td>
<td>&lt;99.9%</td>
<td>&lt;99.5%</td>
</tr>
<tr>
<td>P95 latency</td>
<td>â‰¤250ms</td>
<td>&gt;200ms</td>
<td>&gt;300ms</td>
</tr>
<tr>
<td>Error rate</td>
<td>â‰¤0.1%</td>
<td>&gt;0.5%</td>
<td>&gt;1%</td>
</tr>
<tr>
<td>Error budget</td>
<td>21.6min/month</td>
<td>&lt;20%</td>
<td>&lt;10%</td>
</tr>
</tbody>
</table>
<h3 id="appendix-d-error-code-reference">Appendix D: Error Code Reference</h3>
<table>
<thead>
<tr>
<th>Error Code</th>
<th>HTTP Status</th>
<th>Description</th>
<th>Solution</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AUTH_001</code></td>
<td>401</td>
<td>Not logged in</td>
<td>Re-login</td>
</tr>
<tr>
<td><code>AUTH_002</code></td>
<td>403</td>
<td>Insufficient permissions</td>
<td>Contact administrator</td>
</tr>
<tr>
<td><code>AUTH_003</code></td>
<td>401</td>
<td>Session expired</td>
<td>Re-login</td>
</tr>
<tr>
<td><code>DB_001</code></td>
<td>500</td>
<td>Database connection failed</td>
<td>Check DATABASE_URL</td>
</tr>
<tr>
<td><code>DB_002</code></td>
<td>500</td>
<td>Query timeout</td>
<td>Optimize query or increase timeout</td>
</tr>
<tr>
<td><code>CACHE_001</code></td>
<td>503</td>
<td>Redis unavailable</td>
<td>Check Redis service</td>
</tr>
<tr>
<td><code>API_001</code></td>
<td>429</td>
<td>Too many requests</td>
<td>Reduce request frequency</td>
</tr>
<tr>
<td><code>API_002</code></td>
<td>500</td>
<td>External API failed</td>
<td>Retry later</td>
</tr>
<tr>
<td><code>BLOCKCHAIN_001</code></td>
<td>500</td>
<td>Private key not configured</td>
<td>Set BLOCKCHAIN_PRIVATE_KEY</td>
</tr>
<tr>
<td><code>ENCRYPTION_001</code></td>
<td>500</td>
<td>Encryption key not configured</td>
<td>Set ENCRYPTION_PASSWORD</td>
</tr>
</tbody>
</table>
<h3 id="appendix-e-version-history">Appendix E: Version History</h3>
<table>
<thead>
<tr>
<th>Version</th>
<th>Date</th>
<th>Author</th>
<th>Changes</th>
</tr>
</thead>
<tbody>
<tr>
<td>v2.0</td>
<td>2025-10-03</td>
<td>HashInsight Ops Team</td>
<td>Complete operations manual first release</td>
</tr>
<tr>
<td>v1.9</td>
<td>2025-09-15</td>
<td>DevOps Team</td>
<td>Added Request Coalescing optimization</td>
</tr>
<tr>
<td>v1.8</td>
<td>2025-08-20</td>
<td>Security Team</td>
<td>Enhanced KMS and mTLS documentation</td>
</tr>
<tr>
<td>v1.7</td>
<td>2025-07-10</td>
<td>Platform Team</td>
<td>Added SLO monitoring chapter</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="document-maintenance">Document Maintenance</h2>
<p><strong>Maintenance Responsibility</strong>: HashInsight Platform Operations Team<br />
<strong>Review Cycle</strong>: Quarterly<br />
<strong>Feedback Channel</strong>: ops@hashinsight.net<br />
<strong>Documentation Repository</strong>: https://github.com/hashinsight/operations-manual</p>
<p><strong>Last Updated</strong>: October 3, 2025<br />
<strong>Next Review</strong>: January 3, 2026</p>
<hr />
<p><strong>Â© 2025 HashInsight Platform. All Rights Reserved.</strong><br />
<strong>Confidential - Internal Use Only</strong></p>
</body>
</html>