<!DOCTYPE html>
<html lang="{{ 'zh-CN' if current_lang == 'zh' else 'en' }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitcoin Êï∞ÊçÆÂàÜÊûê‰ª™Ë°®Áõò</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background-color: #0d1421;
            color: #ffffff;
        }
        .card {
            background-color: #1a2332;
            border: 1px solid #2d3748;
        }
        .card-header {
            background-color: #2d3748;
            border-bottom: 1px solid #4a5568;
        }
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
        }
        .price-up {
            color: #48bb78;
        }
        .price-down {
            color: #f56565;
        }
        .loading {
            display: none;
        }
        .chart-container {
            position: relative;
            height: 400px;
        }
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        .status-online {
            background-color: #48bb78;
            animation: pulse 2s infinite;
        }
        .status-offline {
            background-color: #f56565;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        .metric-value {
            font-size: 2.5rem;
            font-weight: bold;
        }
        .metric-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        .metric-change {
            font-size: 1rem;
            font-weight: 500;
        }
        .risk-low {
            color: #48bb78;
        }
        .risk-medium {
            color: #ed8936;
        }
        .risk-high {
            color: #f56565;
        }
        .recommendation-item {
            padding: 0.5rem;
            margin: 0.25rem 0;
            background-color: #2d3748;
            border-radius: 4px;
            border-left: 4px solid #667eea;
        }
        
        /* Ê†áÁ≠æÈ°µÂàáÊç¢Âä®Áîª */
        .tab-pane {
            transition: opacity 0.3s ease-in-out;
        }
        
        .tab-pane.fade:not(.show) {
            opacity: 0;
        }
        
        .nav-tabs .nav-link {
            transition: all 0.3s ease;
            border-color: transparent;
        }
        
        .nav-tabs .nav-link:hover {
            background-color: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        .nav-tabs .nav-link.active {
            background-color: #1a202c;
            border-color: #f39c12 #f39c12 transparent;
            color: #f39c12;
        }
        
        /* Deribit‰∏ìÁî®Âä†ËΩΩÂä®Áîª */
        @keyframes deribitSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .deribit-loading {
            animation: deribitSpin 1s linear infinite;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-dark bg-dark">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">
                <i class="bi bi-graph-up"></i>
                <span data-i18n="analytics_dashboard_title">{% if current_lang == 'en' %}Bitcoin Analytics Dashboard{% else %}Bitcoin Êï∞ÊçÆÂàÜÊûê‰ª™Ë°®Áõò{% endif %}</span>
            </span>
            <div class="d-flex align-items-center">
                <button type="button" data-lang-switch="zh" data-lang="zh" 
                        class="btn btn-sm btn-outline-light {{ 'active' if current_lang == 'zh' else '' }} lang-switch-btn me-1">
                    ‰∏≠Êñá
                </button>
                <button type="button" data-lang-switch="en" data-lang="en" 
                        class="btn btn-sm btn-outline-light {{ 'active' if current_lang == 'en' else '' }} lang-switch-btn me-3">
                    EN
                </button>
                <span class="status-indicator status-online" id="statusIndicator"></span>
                <span id="statusText" data-i18n="realtime_monitoring">{% if current_lang == 'en' %}Real-time Monitoring{% else %}ÂÆûÊó∂ÁõëÊéß‰∏≠{% endif %}</span>
                <span class="ms-3 text-muted" id="lastUpdate">--</span>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <!-- Ê†áÁ≠æÈ°µÂØºËà™ -->
        <ul class="nav nav-tabs mb-4" id="dashboardTabs" role="tablist" style="border: 2px solid red; background: yellow; padding: 10px;">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab" aria-controls="overview" aria-selected="true" style="color: black; background: white;">
                    <i class="bi bi-speedometer2"></i> ÁªºÂêàÊ¶ÇËßà
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="treasury-tab" data-bs-toggle="tab" data-bs-target="#treasury" type="button" role="tab" aria-controls="treasury" aria-selected="false" style="color: white; background: #007bff; border: 3px solid #ffd700; font-weight: bold; font-size: 16px;">
                    <i class="bi bi-bank"></i> üè¶ Treasury Management üöÄ
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="deribit-tab" data-bs-toggle="tab" data-bs-target="#deribit" type="button" role="tab" aria-controls="deribit" aria-selected="false" style="color: black; background: lightblue;">
                    <i class="bi bi-graph-up-arrow"></i> DeribitÊ∑±Â∫¶ÂàÜÊûê
                </button>
            </li>
        </ul>

        <!-- Ê†áÁ≠æÈ°µÂÜÖÂÆπ -->
        <div class="tab-content" id="dashboardTabContent">
            <!-- ÁªºÂêàÊ¶ÇËßàÊ†áÁ≠æÈ°µ -->
            <div class="tab-pane fade show active" id="overview" role="tabpanel" aria-labelledby="overview-tab">
                <!-- ‰∏ªË¶ÅÊåáÊ†áË°å -->
                <div class="row mb-4">
            <div class="col-md-3">
                <div class="card metric-card text-white">
                    <div class="card-body text-center">
                        <div class="metric-value" id="btcPrice">--</div>
                        <div class="metric-label">BTC ‰ª∑Ê†º (USD)</div>
                        <div class="metric-change" id="priceChange24h">--</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card metric-card text-white">
                    <div class="card-body text-center">
                        <div class="metric-value" id="networkHashrate">--</div>
                        <div class="metric-label">ÁΩëÁªúÁÆóÂäõ (EH/s)</div>
                        <div class="metric-change" id="hashrateStatus">--</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card metric-card text-white">
                    <div class="card-body text-center">
                        <div class="metric-value" id="fearGreedIndex">--</div>
                        <div class="metric-label">ÊÅêÊÉßË¥™Â©™ÊåáÊï∞</div>
                        <div class="metric-change" id="fearGreedLabel">--</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card metric-card text-white">
                    <div class="card-body text-center">
                        <div class="metric-value" id="rsiValue">--</div>
                        <div class="metric-label">RSI (14)</div>
                        <div class="metric-change" id="rsiSignal">--</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‰∏âÂ§ß‰∫§ÊòìÊâÄ‰∫§ÊòìÊï∞ÊçÆÂàÜÊûê (È°∂ÈÉ®ÈáçË¶Å‰ΩçÁΩÆ) -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="bi bi-graph-up-arrow"></i>
                            ‰∏âÂ§ß‰∫§ÊòìÊâÄÂÆûÊó∂‰∫§ÊòìÊï∞ÊçÆ (Deribit + OKX + Binance)
                            <span class="badge bg-success ms-2" id="tradingDataStatus">ÂÆûÊó∂ÁõëÊéß</span>
                        </h5>
                        <button class="btn btn-sm btn-warning" onclick="window.loadExchangeTradingData()">
                            <i class="bi bi-arrow-clockwise"></i> ÊâãÂä®Âà∑Êñ∞
                        </button>
                    </div>
                    <div class="card-body">
                        <!-- ÁªüËÆ°Âç°ÁâáË°å -->
                        <div class="row mb-4">
                            <div class="col-md-3">
                                <div class="card bg-dark text-light border-warning">
                                    <div class="card-body text-center">
                                        <i class="bi bi-graph-up text-warning h3"></i>
                                        <h5 class="card-title">ÊÄª‰∫§ÊòìÊï∞</h5>
                                        <h3 class="text-warning" id="exchangeTotalTrades">
                                            <div class="spinner-border spinner-border-sm" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                        </h3>
                                        <small class="text-muted">‰∏âÂ§ß‰∫§ÊòìÊâÄÂêàËÆ°</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card bg-dark text-light border-info">
                                    <div class="card-body text-center">
                                        <i class="bi bi-currency-bitcoin text-info h3"></i>
                                        <h5 class="card-title">ÊÄª‰∫§ÊòìÈáè</h5>
                                        <h3 class="text-info" id="exchangeTotalVolume">
                                            <div class="spinner-border spinner-border-sm" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                        </h3>
                                        <small class="text-muted">Deribit + OKX + Binance</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card bg-dark text-light border-success">
                                    <div class="card-body text-center">
                                        <i class="bi bi-cash text-success h3"></i>
                                        <h5 class="card-title">Âπ≥Âùá‰ª∑Ê†º</h5>
                                        <h3 class="text-success" id="exchangeAvgPrice">
                                            <div class="spinner-border spinner-border-sm" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                        </h3>
                                        <small class="text-muted">Âä†ÊùÉÂπ≥Âùá‰ª∑Ê†º</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card bg-dark text-light border-secondary">
                                    <div class="card-body text-center">
                                        <i class="bi bi-clock text-secondary h3"></i>
                                        <h5 class="card-title">ÊúÄÊñ∞Êõ¥Êñ∞</h5>
                                        <h6 class="text-secondary" id="exchangeLastUpdate">
                                            <div class="spinner-border spinner-border-sm" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                        </h6>
                                        <small class="text-muted">ESTÊó∂Âå∫</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ÂõæË°®Ë°å -->
                        <div class="row mb-4">
                            <div class="col-md-8">
                                <div class="card">
                                    <div class="card-body">
                                        <h5><i class="bi bi-bar-chart"></i> ‰ª∑Ê†ºÂå∫Èó¥‰∫§ÊòìÈáèÂàÜÂ∏É</h5>
                                        <canvas id="exchangePriceRangeChart" width="400" height="200"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-body">
                                        <h5><i class="bi bi-pie-chart"></i> ‰∫§ÊòìÊñπÂêëÂàÜÂ∏É</h5>
                                        <canvas id="exchangeDirectionChart" width="200" height="200"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ‰ª∑Ê†ºÂå∫Èó¥ËØ¶ÁªÜÊï∞ÊçÆ -->
                        <div class="row">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-body">
                                        <h5><i class="bi bi-table"></i> ‰ª∑Ê†ºÂå∫Èó¥ÂàÜÊûêËØ¶ÊÉÖ</h5>
                                        <div id="exchangeLoadingIndicator" class="text-center p-4">
                                            <div class="spinner-border text-primary mx-auto mb-2"></div>
                                            <p>Ê≠£Âú®Âä†ËΩΩ‰∫§ÊòìÊï∞ÊçÆ...</p>
                                        </div>
                                        <div id="exchangePriceRangeDetails" style="display: none;">
                                            <!-- Âä®ÊÄÅÁîüÊàêÂÜÖÂÆπ -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÂõæË°®ÂíåÂàÜÊûêË°å -->
        <div class="row">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-graph-up-arrow"></i>
                            BTC ‰ª∑Ê†ºË∂ãÂäø (24Â∞èÊó∂)
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="priceChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-speedometer2"></i>
                            ÊäÄÊúØÂàÜÊûêÊåáÊ†á
                        </h5>
                    </div>
                    <div class="card-body">
                        <!-- ÁßªÂä®Âπ≥ÂùáÁ∫ø -->
                        <div class="mb-3 p-2" style="background-color: #2a3441; border-radius: 8px;">
                            <h6 class="text-info mb-2">ÁßªÂä®Âπ≥ÂùáÁ∫ø</h6>
                            <div class="row mb-2">
                                <div class="col-6">
                                    <small class="text-muted">SMA 20</small>
                                    <div class="fw-bold text-white" id="sma20">$119,537.90</div>
                                </div>
                                <div class="col-6">
                                    <small class="text-muted">SMA 50</small>
                                    <div class="fw-bold text-white" id="sma50">$120,450.42</div>
                                </div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-6">
                                    <small class="text-muted">EMA 12</small>
                                    <div class="fw-bold text-white" id="ema12">$119,156.41</div>
                                </div>
                                <div class="col-6">
                                    <small class="text-muted">EMA 26</small>
                                    <div class="fw-bold text-white" id="ema26">$119,623.03</div>
                                </div>
                            </div>
                        </div>

                        <!-- Âä®ÈáèÊåáÊ†á -->
                        <div class="mb-3 p-2" style="background-color: #2a3441; border-radius: 8px;">
                            <h6 class="text-warning mb-2">Âä®ÈáèÊåáÊ†á</h6>
                            <div class="row mb-2">
                                <div class="col-6">
                                    <small class="text-muted">RSI (14)</small>
                                    <div class="fw-bold text-white" id="rsi14">15.3</div>
                                </div>
                                <div class="col-6">
                                    <small class="text-muted">MACD</small>
                                    <div class="fw-bold text-white" id="macd">-466.6161</div>
                                </div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-12">
                                    <small class="text-muted">30Êó•Ê≥¢Âä®Áéá</small>
                                    <div class="fw-bold text-white" id="volatility">+0.21%</div>
                                </div>
                            </div>
                        </div>

                        <!-- Â∏ÉÊûóÂ∏¶ -->
                        <div class="mb-3 p-2" style="background-color: #2a3441; border-radius: 8px;">
                            <h6 class="text-success mb-2">Â∏ÉÊûóÂ∏¶</h6>
                            <div class="row mb-1">
                                <div class="col-12">
                                    <small class="text-muted">‰∏äËΩ®</small>
                                    <div class="fw-bold text-danger" id="bollingerUpper">$120,708.43</div>
                                </div>
                            </div>
                            <div class="row mb-1">
                                <div class="col-12">
                                    <small class="text-muted">‰∏≠ËΩ® (SMA20)</small>
                                    <div class="fw-bold text-warning" id="bollingerMiddle">$119,537.90</div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12">
                                    <small class="text-muted">‰∏ãËΩ®</small>
                                    <div class="fw-bold text-success" id="bollingerLower">$118,367.37</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‰∏âÂ§ß‰∫§ÊòìÊâÄ‰∫§ÊòìÊï∞ÊçÆÂàÜÊûê -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-graph-up-arrow"></i>
                            ‰∏âÂ§ß‰∫§ÊòìÊâÄÂÆûÊó∂‰∫§ÊòìÊï∞ÊçÆ (Deribit + OKX + Binance)
                            <span class="badge bg-success ms-2" id="tradingDataStatus">ÂÆûÊó∂ÁõëÊéß</span>
                        </h5>
                    </div>
                    <div class="card-body">
                        <!-- ÁªüËÆ°Âç°ÁâáË°å -->
                        <div class="row mb-4">
                            <div class="col-md-3">
                                <div class="card bg-dark text-light border-warning">
                                    <div class="card-body text-center">
                                        <i class="bi bi-graph-up text-warning h3"></i>
                                        <h5 class="card-title">ÊÄª‰∫§ÊòìÊï∞</h5>
                                        <h3 class="text-warning" id="exchangeTotalTrades">
                                            <div class="spinner-border spinner-border-sm" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                        </h3>
                                        <small class="text-muted">‰∏âÂ§ß‰∫§ÊòìÊâÄÂêàËÆ°</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card bg-dark text-light border-info">
                                    <div class="card-body text-center">
                                        <i class="bi bi-currency-bitcoin text-info h3"></i>
                                        <h5 class="card-title">ÊÄª‰∫§ÊòìÈáè</h5>
                                        <h3 class="text-info" id="exchangeTotalVolume">
                                            <div class="spinner-border spinner-border-sm" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                        </h3>
                                        <small class="text-muted">Deribit + OKX + Binance</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card bg-dark text-light border-success">
                                    <div class="card-body text-center">
                                        <i class="bi bi-cash text-success h3"></i>
                                        <h5 class="card-title">Âπ≥Âùá‰ª∑Ê†º</h5>
                                        <h3 class="text-success" id="exchangeAvgPrice">
                                            <div class="spinner-border spinner-border-sm" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                        </h3>
                                        <small class="text-muted">Âä†ÊùÉÂπ≥Âùá‰ª∑Ê†º</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card bg-dark text-light border-secondary">
                                    <div class="card-body text-center">
                                        <i class="bi bi-clock text-secondary h3"></i>
                                        <h5 class="card-title">ÊúÄÊñ∞Êõ¥Êñ∞</h5>
                                        <h6 class="text-secondary" id="exchangeLastUpdate">
                                            <div class="spinner-border spinner-border-sm" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                        </h6>
                                        <small class="text-muted">ESTÊó∂Âå∫</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ÂõæË°®Ë°å -->
                        <div class="row mb-4">
                            <div class="col-md-8">
                                <div class="card">
                                    <div class="card-body">
                                        <h5><i class="bi bi-bar-chart"></i> ‰ª∑Ê†ºÂå∫Èó¥‰∫§ÊòìÈáèÂàÜÂ∏É</h5>
                                        <canvas id="exchangePriceRangeChart" width="400" height="200"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-body">
                                        <h5><i class="bi bi-pie-chart"></i> ‰∫§ÊòìÊñπÂêëÂàÜÂ∏É</h5>
                                        <canvas id="exchangeDirectionChart" width="200" height="200"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ‰ª∑Ê†ºÂå∫Èó¥ËØ¶ÁªÜÊï∞ÊçÆ -->
                        <div class="row">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-body">
                                        <h5><i class="bi bi-table"></i> ‰ª∑Ê†ºÂå∫Èó¥ÂàÜÊûêËØ¶ÊÉÖ</h5>
                                        <div id="exchangeLoadingIndicator" class="text-center p-4">
                                            <div class="spinner-border text-primary mx-auto mb-2"></div>
                                            <p>Ê≠£Âú®Âä†ËΩΩ‰∫§ÊòìÊï∞ÊçÆ...</p>
                                        </div>
                                        <div id="exchangePriceRangeDetails" style="display: none;">
                                            <!-- Âä®ÊÄÅÁîüÊàêÂÜÖÂÆπ -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÁΩëÁªúÂéÜÂè≤Êï∞ÊçÆË°å -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-clock-history"></i>
                            ÁΩëÁªúÂéÜÂè≤Êï∞ÊçÆ (30Â§©)
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="chart-container" style="height: 200px;">
                                    <canvas id="priceHistoryChart"></canvas>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="chart-container" style="height: 200px;">
                                    <canvas id="difficultyHistoryChart"></canvas>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="chart-container" style="height: 200px;">
                                    <canvas id="hashrateHistoryChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÂàÜÊûêÊä•ÂëäË°å -->
        <div class="row mt-4">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-file-text"></i>
                            ÊúÄÊñ∞ÂàÜÊûêÊä•Âëä
                        </h5>
                    </div>
                    <div class="card-body">
                        <div id="reportTitle" class="h6 mb-3">--</div>
                        <div id="reportSummary" class="mb-3">--</div>
                        
                        <h6>ÂÖ≥ÈîÆÂèëÁé∞</h6>
                        <div id="keyFindings" class="mb-3">
                            <div class="row">
                                <div class="col-md-6">
                                    <small class="text-muted">‰ª∑Ê†ºÂå∫Èó¥</small>
                                    <div id="priceRange">--</div>
                                </div>
                                <div class="col-md-6">
                                    <small class="text-muted">Âπ≥Âùá‰ª∑Ê†º</small>
                                    <div id="avgPrice">--</div>
                                </div>
                            </div>
                        </div>

                        <h6>ÊäïËµÑÂª∫ËÆÆ</h6>
                        <div id="recommendations">
                            <!-- Âä®ÊÄÅÂ°´ÂÖÖÂª∫ËÆÆ -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-shield-exclamation"></i>
                            È£éÈô©ËØÑ‰º∞
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="text-center mb-3">
                            <div class="metric-value" id="riskScore">--</div>
                            <div class="metric-label">È£éÈô©ËØÑÂàÜ</div>
                            <div class="metric-change" id="riskLevel">--</div>
                        </div>
                        
                        <div class="mb-3">
                            <small class="text-muted">ÁΩÆ‰ø°Â∫¶</small>
                            <div class="fw-bold" id="confidenceScore">--</div>
                        </div>
                        
                        <div class="mb-3">
                            <small class="text-muted">Êï∞ÊçÆÊõ¥Êñ∞Êó∂Èó¥</small>
                            <div class="fw-bold" id="reportTime">--</div>
                        </div>
                        
                        <div>
                            <small class="text-muted">Â∏ÇÂú∫ÊÉÖÁª™</small>
                            <div class="fw-bold" id="marketSentiment">--</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
                            <div class="col-md-3">
                                <div class="card bg-dark text-light border-info">
                                    <div class="card-body text-center">
                                        <i class="bi bi-currency-bitcoin text-info h3"></i>
                                        <h5 class="card-title">ÊÄª‰∫§ÊòìÈáè</h5>
                                        <h3 class="text-info" id="exchangeTotalVolume">
                                            <div class="spinner-border spinner-border-sm" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                        </h3>
                                        <small class="text-muted">Deribit + OKX + Binance</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card bg-dark text-light border-success">
                                    <div class="card-body text-center">
                                        <i class="bi bi-cash text-success h3"></i>
                                        <h5 class="card-title">Âπ≥Âùá‰ª∑Ê†º</h5>
                                        <h3 class="text-success" id="exchangeAvgPrice">
                                            <div class="spinner-border spinner-border-sm" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                        </h3>
                                        <small class="text-muted">Êàê‰∫§Âùá‰ª∑</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card bg-dark text-light border-primary">
                                    <div class="card-body text-center">
                                        <i class="bi bi-clock text-primary h3"></i>
                                        <h5 class="card-title">ÊúÄÊñ∞Êõ¥Êñ∞</h5>
                                        <h6 class="text-primary" id="exchangeLastUpdate">
                                            <div class="spinner-border spinner-border-sm" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                        </h6>
                                        <small class="text-muted">Êï∞ÊçÆÊó∂Èó¥</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ÂõæË°®Ë°å -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="card bg-dark text-light border-secondary">
                                    <div class="card-header">
                                        <h6 class="mb-0">
                                            <i class="bi bi-bar-chart-line"></i>
                                            ‰ª∑Ê†ºÂå∫Èó¥‰∫§ÊòìÈáèÂàÜÂ∏É
                                        </h6>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="exchangePriceRangeChart" height="200"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card bg-dark text-light border-secondary">
                                    <div class="card-header">
                                        <h6 class="mb-0">
                                            <i class="bi bi-pie-chart"></i>
                                            ‰∫§ÊòìÊñπÂêëÂàÜÂ∏É
                                        </h6>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="exchangeDirectionChart" height="200"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ‰ª∑Ê†ºÂå∫Èó¥ÂàÜÊûêË°®Ê†º -->
                        <div class="row">
                            <div class="col-12">
                                <div class="card bg-dark text-light border-secondary">
                                    <div class="card-header">
                                        <h6 class="mb-0">
                                            <i class="bi bi-table"></i>
                                            ‰ª∑Ê†ºÂå∫Èó¥ËØ¶ÁªÜÂàÜÊûê
                                        </h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-dark table-striped">
                                                <thead>
                                                    <tr>
                                                        <th>‰ª∑Ê†ºÂå∫Èó¥</th>
                                                        <th>‰∫§ÊòìÊ¨°Êï∞</th>
                                                        <th>ÊÄª‰∫§ÊòìÈáè</th>
                                                        <th>Âç†ÊØî</th>
                                                        <th>Âπ≥Âùá‰ª∑Ê†º</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="exchangePriceRangeTable">
                                                    <tr>
                                                        <td colspan="5" class="text-center">
                                                            <div class="spinner-border spinner-border-sm" role="status">
                                                                <span class="visually-hidden">Loading...</span>
                                                            </div>
                                                            <span class="ms-2">Âä†ËΩΩ‰∏≠...</span>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
            </div>
            <!-- /Ê¶ÇËßàÊ†áÁ≠æÈ°µÁªìÊùü -->

            <!-- Treasury Management Ê†áÁ≠æÈ°µ -->
            <div class="tab-pane fade" id="treasury" role="tabpanel" aria-labelledby="treasury-tab">
                <!-- È°µÈù¢Ê†áÈ¢ò -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card" style="background: linear-gradient(135deg, rgba(52, 152, 219, 0.2), rgba(41, 128, 185, 0.2)); border: 1px solid rgba(52, 152, 219, 0.3);">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h2><i class="bi bi-bank"></i> HashInsight Treasury Management</h2>
                                    <div>
                                        <span class="status-indicator status-online"></span>
                                        <span>ÂÆûÊó∂ËøêË°å</span>
                                    </div>
                                </div>
                                <p class="text-muted">Êô∫ËÉΩBTCÂ∫ìÂ≠òÁÆ°ÁêÜ ¬∑ È£éÈô©ÂèØÊéßÁöÑÂçñÂá∫Á≠ñÁï• ¬∑ Â§öÂ±ÇÁ∫ßÂà©ÁõäÊúÄÂ§ßÂåñÁ≥ªÁªü</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Â±ÇÁ∫ßÈÄâÊã©ÊéßÂà∂Èù¢Êùø -->
                <div class="row mb-4">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="bi bi-sliders"></i> Á≠ñÁï•Â±ÇÁ∫ßÈÄâÊã©</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-8">
                                        <label class="form-label">ÈÄâÊã©ÂçñÂá∫Á≠ñÁï•Â±ÇÁ∫ßÔºö</label>
                                        <select id="layerSelector" class="form-select mb-3">
                                            <option value="L1">L1 ‰øùÂÆàÁ≠ñÁï• - 1.25x ÂÄçÊï∞ (‰ΩéÈ£éÈô©)</option>
                                            <option value="L2" selected>L2 Âπ≥Ë°°Á≠ñÁï• - 1.52x ÂÄçÊï∞ (‰∏≠Á≠âÈ£éÈô©)</option>
                                            <option value="L3">L3 ÊøÄËøõÁ≠ñÁï• - 1.85x ÂÄçÊï∞ (È´òÈ£éÈô©)</option>
                                            <option value="L4">L4 ÊûÅËá¥Á≠ñÁï• - 2.20x ÂÄçÊï∞ (ÊúÄÈ´òÈ£éÈô©)</option>
                                        </select>
                                        <button id="applyLayerBtn" class="btn btn-primary">
                                            <i class="bi bi-check-circle"></i> Â∫îÁî®Á≠ñÁï•
                                        </button>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="p-3 bg-dark rounded">
                                            <h6 class="text-info">ÂΩìÂâçÁ≠ñÁï•‰ø°ÊÅØ</h6>
                                            <div id="currentLayerInfo">
                                                <small class="text-muted">Â±ÇÁ∫ßÔºö</small><strong id="currentLayer">L2</strong><br>
                                                <small class="text-muted">ÂêçÁß∞Ôºö</small><strong id="currentLayerName">Âπ≥Ë°°Á≠ñÁï•</strong><br>
                                                <small class="text-muted">È£éÈô©Ôºö</small><strong id="currentRisk">Medium</strong><br>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TreasuryÊï∞ÊçÆÈù¢Êùø -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="bi bi-wallet2"></i> Next Sell PriceÊåáÊ†á</h5>
                            </div>
                            <div class="card-body">
                                <div class="text-center mb-3">
                                    <div class="metric-value text-success" id="nextSellPrice">--</div>
                                    <div class="metric-label">ÁõÆÊ†á‰ª∑Ê†º (USD)</div>
                                </div>
                                <div class="row">
                                    <div class="col-6">
                                        <small class="text-muted">Âå∫Èó¥‰∏ãÈôê</small>
                                        <div class="fw-bold" id="zoneLow">--</div>
                                    </div>
                                    <div class="col-6">
                                        <small class="text-muted">Âå∫Èó¥‰∏äÈôê</small>
                                        <div class="fw-bold" id="zoneHigh">--</div>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <small class="text-muted">Âª∫ËÆÆÊï∞ÈáèÔºö</small><span id="qtyBtc" class="fw-bold">--</span> BTC<br>
                                    <small class="text-muted">ÁΩÆ‰ø°Â∫¶Ôºö</small><span id="confidence" class="fw-bold">--</span><br>
                                    <small class="text-muted">Êé•ËøëÂ∫¶Ôºö</small><span id="proximity" class="fw-bold">--</span>%
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="bi bi-pie-chart"></i> ÊäïËµÑÁªÑÂêàÊ¶ÇËßà</h5>
                            </div>
                            <div class="card-body">
                                <div class="row mb-2">
                                    <div class="col-6">
                                        <small class="text-muted">BTCÂ∫ìÂ≠ò</small>
                                        <div class="fw-bold" id="btcInventory">--</div>
                                    </div>
                                    <div class="col-6">
                                        <small class="text-muted">ÊàêÊú¨Âü∫ÂáÜ</small>
                                        <div class="fw-bold" id="avgCostBasis">--</div>
                                    </div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col-6">
                                        <small class="text-muted">Áé∞ÈáëÂÇ®Â§á</small>
                                        <div class="fw-bold" id="cashReserves">--</div>
                                    </div>
                                    <div class="col-6">
                                        <small class="text-muted">ÊúàÂ∫¶OPEX</small>
                                        <div class="fw-bold" id="monthlyOpex">--</div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-12">
                                        <small class="text-muted">Êú™ÂÆûÁé∞Áõà‰∫è</small>
                                        <div class="fw-bold" id="unrealizedPL">--</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Á≠ñÁï•ËØ¥Êòé -->
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="bi bi-info-circle"></i> Êé®ÁêÜËøáÁ®ã</h5>
                            </div>
                            <div class="card-body">
                                <div id="reasonsList">
                                    <!-- Âä®ÊÄÅÁîüÊàêÁöÑÊé®ÁêÜËøáÁ®ã -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /Treasury ManagementÊ†áÁ≠æÈ°µÁªìÊùü -->

            <!-- DeribitÊ∑±Â∫¶ÂàÜÊûêÊ†áÁ≠æÈ°µ -->
            <div class="tab-pane fade" id="deribit" role="tabpanel" aria-labelledby="deribit-tab">
                <!-- DeribitÈ°µÈù¢Ê†áÈ¢ò -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card" style="background: linear-gradient(135deg, rgba(243, 156, 18, 0.2), rgba(230, 126, 34, 0.2)); border: 1px solid rgba(243, 156, 18, 0.3);">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h2><i class="bi bi-bar-chart-line"></i> Deribit‰∫§ÊòìÊï∞ÊçÆÊ∑±Â∫¶ÂàÜÊûêÁ≥ªÁªü</h2>
                                    <div>
                                        <span id="deribitConnectionStatus" class="status-indicator status-offline"></span>
                                        <span id="deribitStatusText">ËøûÊé•‰∏≠...</span>
                                    </div>
                                </div>
                                <p class="text-muted">ÂÆûÊó∂ÈááÈõÜDeribit + OKX + Binance‰∫§ÊòìÊï∞ÊçÆÔºåÊ∑±Â∫¶ÂàÜÊûê‰ª∑Ê†ºÂå∫Èó¥ÁöÑ‰∫§ÊòìÈáèÂàÜÂ∏ÉÂíåÊúüÊùÉ‰∫§ÊòìÊ®°Âºè</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ÊéßÂà∂Èù¢ÊùøÂíåÁ≥ªÁªüÁä∂ÊÄÅ -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5><i class="bi bi-gear"></i> Êï∞ÊçÆÈááÈõÜÊéßÂà∂</h5>
                                <div class="mb-3">
                                    <label for="deribitInstrumentSelect" class="form-label">ÈÄâÊã©ÂêàÁ∫¶:</label>
                                    <select id="deribitInstrumentSelect" class="form-select">
                                        <option value="BTC-PERPETUAL">BTC-PERPETUAL (Ê∞∏Áª≠ÂêàÁ∫¶)</option>
                                        <option value="auto">Ëá™Âä®ÈÄâÊã©Ê¥ªË∑ÉÊúüÊùÉ</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="deribitIntervalSelect" class="form-label">ÈááÈõÜÈó¥Èöî:</label>
                                    <select id="deribitIntervalSelect" class="form-select">
                                        <option value="1">1ÂàÜÈíü</option>
                                        <option value="5">5ÂàÜÈíü</option>
                                        <option value="15" selected>15ÂàÜÈíü</option>
                                        <option value="30">30ÂàÜÈíü</option>
                                        <option value="60">1Â∞èÊó∂</option>
                                    </select>
                                </div>
                                <button id="deribitStartCollection" class="btn btn-primary me-2">
                                    <i class="bi bi-play-fill"></i> ÂºÄÂßãÈááÈõÜ
                                </button>
                                <button id="deribitStopCollection" class="btn btn-secondary me-2" disabled>
                                    <i class="bi bi-stop-fill"></i> ÂÅúÊ≠¢ÈááÈõÜ
                                </button>
                                <button id="deribitManualAnalysis" class="btn btn-warning" onclick="loadDeribitAnalysisData()">
                                    <i class="bi bi-arrow-clockwise"></i> ÊâãÂä®ÂàÜÊûê
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5><i class="bi bi-info-circle"></i> Á≥ªÁªüÁä∂ÊÄÅ</h5>
                                <div class="row">
                                    <div class="col-6">
                                        <div class="metric-card" style="background: linear-gradient(135deg, rgba(243, 156, 18, 0.2), rgba(230, 126, 34, 0.2)); border: 1px solid rgba(243, 156, 18, 0.3); border-radius: 15px; padding: 20px; text-align: center; margin-bottom: 20px;">
                                            <h6>APIÁä∂ÊÄÅ</h6>
                                            <span id="deribitApiStatus" class="h4">Ê£ÄÊü•‰∏≠...</span>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="metric-card" style="background: linear-gradient(135deg, rgba(243, 156, 18, 0.2), rgba(230, 126, 34, 0.2)); border: 1px solid rgba(243, 156, 18, 0.3); border-radius: 15px; padding: 20px; text-align: center; margin-bottom: 20px;">
                                            <h6>Êï∞ÊçÆÂ∫ìËÆ∞ÂΩï</h6>
                                            <span id="deribitDbRecords" class="h4">0</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Deribit‰∫§ÊòìÊï∞ÊçÆÁªüËÆ°Âç°Áâá -->
                <div class="row mb-4">
                    <div class="col-md-3 mb-3">
                        <div class="card bg-dark text-light border-warning">
                            <div class="card-body text-center">
                                <i class="bi bi-graph-up text-warning h3"></i>
                                <h5 class="card-title">Deribit‰∫§ÊòìÊï∞</h5>
                                <h3 class="text-warning" id="deribitTotalTrades">
                                    <div class="spinner-border spinner-border-sm" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                </h3>
                                <small class="text-muted">ÂÆûÊó∂ÊúüÊùÉ‰∫§Êòì</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card bg-dark text-light border-info">
                            <div class="card-body text-center">
                                <i class="bi bi-currency-bitcoin text-info h3"></i>
                                <h5 class="card-title">Deribit‰∫§ÊòìÈáè</h5>
                                <h3 class="text-info" id="deribitTotalVolume">
                                    <div class="spinner-border spinner-border-sm" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                </h3>
                                <small class="text-muted">ÊúüÊùÉÂêàÁ∫¶ÊÄªÈáè</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card bg-dark text-light border-success">
                            <div class="card-body text-center">
                                <i class="bi bi-cash text-success h3"></i>
                                <h5 class="card-title">Âπ≥ÂùáÊúüÊùÉ‰ª∑Ê†º</h5>
                                <h3 class="text-success" id="deribitAvgPrice">
                                    <div class="spinner-border spinner-border-sm" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                </h3>
                                <small class="text-muted">USD Âü∫ÂáÜ‰ª∑Ê†º</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card bg-dark text-light border-secondary">
                            <div class="card-body text-center">
                                <i class="bi bi-clock text-secondary h3"></i>
                                <h5 class="card-title">ÊúÄÊñ∞Êõ¥Êñ∞</h5>
                                <h6 class="text-secondary" id="deribitLastUpdate">
                                    <div class="spinner-border spinner-border-sm" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                </h6>
                                <small class="text-muted">ESTÊó∂Âå∫</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ÂõæË°®ÂíåÂàÜÊûê -->
                <div class="row mb-4">
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-body">
                                <h5><i class="bi bi-bar-chart"></i> ‰ª∑Ê†ºÂå∫Èó¥‰∫§ÊòìÈáèÂàÜÂ∏É (Deribit‰∏ìÁî®)</h5>
                                <canvas id="deribitPriceRangeChart" width="400" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-body">
                                <h5><i class="bi bi-pie-chart"></i> ‰∫§ÊòìÊñπÂêëÂàÜÂ∏É (Deribit)</h5>
                                <canvas id="deribitDirectionChart" width="200" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ‰ª∑Ê†ºÂå∫Èó¥ËØ¶ÁªÜÊï∞ÊçÆ -->
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <h5><i class="bi bi-table"></i> Deribit‰ª∑Ê†ºÂå∫Èó¥ÂàÜÊûêËØ¶ÊÉÖ</h5>
                                <div id="deribitLoadingIndicator" class="text-center p-4">
                                    <div class="loading-spinner mx-auto mb-2" style="border: 3px solid rgba(255, 255, 255, 0.3); border-radius: 50%; border-top: 3px solid #f39c12; width: 30px; height: 30px; animation: spin 1s linear infinite;"></div>
                                    <p>Ê≠£Âú®Âä†ËΩΩDeribit‰∏ìÁî®Êï∞ÊçÆ...</p>
                                </div>
                                <div id="deribitPriceRangeDetails" style="display: none;">
                                    <div class="table-responsive">
                                        <table class="table table-dark table-striped">
                                            <thead>
                                                <tr>
                                                    <th>‰ª∑Ê†ºÂå∫Èó¥ ($)</th>
                                                    <th>ÊúüÊùÉ‰∫§ÊòìÊï∞</th>
                                                    <th>‰∫§ÊòìÈáè (BTC)</th>
                                                    <th>Â∏ÇÂú∫Âç†ÊØî</th>
                                                    <th>Âπ≥Âùá‰ª∑Ê†º (USD)</th>
                                                </tr>
                                            </thead>
                                            <tbody id="deribitPriceRangeTable">
                                                <tr>
                                                    <td colspan="5" class="text-center">Á≠âÂæÖÊï∞ÊçÆÂä†ËΩΩ...</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /DeribitÊ∑±Â∫¶ÂàÜÊûêÊ†áÁ≠æÈ°µÁªìÊùü -->
        </div>
        <!-- /Ê†áÁ≠æÈ°µÂÆπÂô®ÁªìÊùü -->
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let priceChart;
        let exchangePriceRangeChart, exchangeDirectionChart;
        
        // ÂàùÂßãÂåñ‰ª∑Ê†ºÂõæË°®
        function initPriceChart() {
            const ctx = document.getElementById('priceChart').getContext('2d');
            priceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'BTC ‰ª∑Ê†º',
                        data: [],
                        borderColor: '#48bb78',
                        backgroundColor: 'rgba(72, 187, 120, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#ffffff'
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#ffffff',
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#ffffff'
                            }
                        }
                    }
                }
            });
        }
        
        // Ê†ºÂºèÂåñÊï∞Â≠ó
        function formatNumber(num, decimals = 2) {
            if (num === null || num === undefined) return '--';
            return num.toLocaleString('en-US', {
                minimumFractionDigits: decimals,
                maximumFractionDigits: decimals
            });
        }

        // ‰∏âÂ§ß‰∫§ÊòìÊâÄÂõæË°®ÂèòÈáè
        let exchangePriceRangeChart = null;
        let exchangeDirectionChart = null;

        // ÂàùÂßãÂåñ‰∏âÂ§ß‰∫§ÊòìÊâÄÂõæË°®
        function initExchangeCharts() {
            // ÂàùÂßãÂåñ‰ª∑Ê†ºÂå∫Èó¥ÂõæË°®
            const priceRangeCtx = document.getElementById('exchangePriceRangeChart').getContext('2d');
            exchangePriceRangeChart = new Chart(priceRangeCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: '‰∫§ÊòìÈáè',
                        data: [],
                        backgroundColor: '#f39c12',
                        borderColor: '#e67e22',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { color: '#ffffff', maxRotation: 45 }
                        },
                        y: {
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { color: '#ffffff' }
                        }
                    },
                    plugins: {
                        legend: { labels: { color: '#ffffff' } }
                    }
                }
            });

            // ÂàùÂßãÂåñ‰∫§ÊòìÊñπÂêëÂõæË°®
            const directionCtx = document.getElementById('exchangeDirectionChart').getContext('2d');
            exchangeDirectionChart = new Chart(directionCtx, {
                type: 'doughnut',
                data: {
                    labels: ['‰π∞ÂÖ•', 'ÂçñÂá∫'],
                    datasets: [{
                        data: [0, 0],
                        backgroundColor: ['#27ae60', '#e74c3c'],
                        borderColor: ['#2ecc71', '#c0392b'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            labels: { color: '#ffffff' },
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Âä†ËΩΩ‰∏âÂ§ß‰∫§ÊòìÊâÄÁªüËÆ°Êï∞ÊçÆ
        window.loadExchangeTradingData = async function() {
            console.log('üöÄüöÄüöÄ loadExchangeTradingData function called! üöÄüöÄüöÄ');
            try {
                console.log('Loading exchange trading data...');
                const response = await fetch('/api/deribit/multi-exchange-trades');
                const result = await response.json();
                console.log('Exchange trading data response:', result);
                
                if (result.success) {
                    const data = result.data;
                    
                    // Êõ¥Êñ∞ÁªüËÆ°Âç°Áâá
                    document.getElementById('exchangeTotalTrades').textContent = data.total_trades.toLocaleString();
                    document.getElementById('exchangeTotalVolume').textContent = data.total_volume.toLocaleString();
                    document.getElementById('exchangeAvgPrice').textContent = '$' + data.avg_price.toLocaleString();
                    document.getElementById('exchangeLastUpdate').textContent = data.last_update;
                    
                    // Êõ¥Êñ∞Áä∂ÊÄÅÊåáÁ§∫Âô®
                    document.getElementById('tradingDataStatus').textContent = 'Êï∞ÊçÆÂ∑≤Êõ¥Êñ∞';
                    document.getElementById('tradingDataStatus').className = 'badge bg-success ms-2';
                    
                } else {
                    // ÊòæÁ§∫ÈîôËØØÁä∂ÊÄÅ
                    document.getElementById('exchangeTotalTrades').innerHTML = '<small class="text-danger">Ëé∑ÂèñÂ§±Ë¥•</small>';
                    document.getElementById('exchangeTotalVolume').innerHTML = '<small class="text-danger">Ëé∑ÂèñÂ§±Ë¥•</small>';
                    document.getElementById('exchangeAvgPrice').innerHTML = '<small class="text-danger">Ëé∑ÂèñÂ§±Ë¥•</small>';
                    document.getElementById('exchangeLastUpdate').innerHTML = '<small class="text-danger">Ëé∑ÂèñÂ§±Ë¥•</small>';
                    
                    document.getElementById('tradingDataStatus').textContent = 'Êï∞ÊçÆËé∑ÂèñÂ§±Ë¥•';
                    document.getElementById('tradingDataStatus').className = 'badge bg-danger ms-2';
                }
            } catch (error) {
                console.error('Âä†ËΩΩ‰∫§ÊòìÊï∞ÊçÆÂ§±Ë¥•:', error);
                // ÊòæÁ§∫ÁΩëÁªúÈîôËØØÁä∂ÊÄÅ
                document.getElementById('exchangeTotalTrades').innerHTML = '<small class="text-danger">ÁΩëÁªúÈîôËØØ</small>';
                document.getElementById('exchangeTotalVolume').innerHTML = '<small class="text-danger">ÁΩëÁªúÈîôËØØ</small>';
                document.getElementById('exchangeAvgPrice').innerHTML = '<small class="text-danger">ÁΩëÁªúÈîôËØØ</small>';
                document.getElementById('exchangeLastUpdate').innerHTML = '<small class="text-danger">ÁΩëÁªúÈîôËØØ</small>';
                
                document.getElementById('tradingDataStatus').textContent = 'ÁΩëÁªúËøûÊé•Â§±Ë¥•';
                document.getElementById('tradingDataStatus').className = 'badge bg-warning ms-2';
            }
        }

        // Âä†ËΩΩ‰∏âÂ§ß‰∫§ÊòìÊâÄÂàÜÊûêÊï∞ÊçÆÔºàÂõæË°®ÂíåËØ¶ÁªÜ‰ø°ÊÅØÔºâ
        async function loadExchangeAnalysisData() {
            try {
                document.getElementById('exchangeLoadingIndicator').style.display = 'block';
                document.getElementById('exchangePriceRangeDetails').style.display = 'none';
                
                const response = await fetch('/api/deribit/analysis-data');
                const result = await response.json();
                
                if (result.success && result.data.price_ranges && result.data.price_ranges.length > 0) {
                    const data = result.data;
                    
                    // Êõ¥Êñ∞‰ª∑Ê†ºÂå∫Èó¥ÂõæË°®
                    updateExchangePriceRangeChart(data.price_ranges);
                    
                    // Êõ¥Êñ∞‰∫§ÊòìÊñπÂêëÂõæË°®
                    if (data.direction_stats) {
                        updateExchangeDirectionChart(data.direction_stats);
                    }
                    
                    // ÊòæÁ§∫ËØ¶ÁªÜË°®Ê†º
                    displayExchangePriceRangeDetails(data.price_ranges);
                    
                    document.getElementById('exchangeLoadingIndicator').style.display = 'none';
                    document.getElementById('exchangePriceRangeDetails').style.display = 'block';
                } else {
                    document.getElementById('exchangeLoadingIndicator').innerHTML = '<p class="text-warning">ÊöÇÊó†‰∫§ÊòìÊï∞ÊçÆ</p>';
                }
            } catch (error) {
                console.error('Âä†ËΩΩÂàÜÊûêÊï∞ÊçÆÂ§±Ë¥•:', error);
                document.getElementById('exchangeLoadingIndicator').innerHTML = '<p class="text-danger">Êï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•</p>';
            }
        }

        // Êõ¥Êñ∞‰ª∑Ê†ºÂå∫Èó¥ÂõæË°®
        function updateExchangePriceRangeChart(priceRanges) {
            if (!exchangePriceRangeChart) return;
            
            const labels = priceRanges.map(range => range.range);
            const data = priceRanges.map(range => parseFloat(range.volume));
            
            exchangePriceRangeChart.data.labels = labels;
            exchangePriceRangeChart.data.datasets[0].data = data;
            exchangePriceRangeChart.update();
        }

        // Êõ¥Êñ∞‰∫§ÊòìÊñπÂêëÂõæË°®
        function updateExchangeDirectionChart(directionStats) {
            if (!exchangeDirectionChart) return;
            
            const buyCount = directionStats.buy_count || 0;
            const sellCount = directionStats.sell_count || 0;
            
            exchangeDirectionChart.data.datasets[0].data = [buyCount, sellCount];
            exchangeDirectionChart.update();
        }

        // ÊòæÁ§∫‰ª∑Ê†ºÂå∫Èó¥ËØ¶ÁªÜ‰ø°ÊÅØ
        function displayExchangePriceRangeDetails(priceRanges) {
            const detailsDiv = document.getElementById('exchangePriceRangeDetails');
            
            let html = `
                <div class="table-responsive">
                    <table class="table table-dark table-striped">
                        <thead>
                            <tr>
                                <th>‰ª∑Ê†ºÂå∫Èó¥</th>
                                <th>‰∫§ÊòìÊï∞</th>
                                <th>‰∫§ÊòìÈáè</th>
                                <th>Âç†ÊØî</th>
                                <th>Âπ≥Âùá‰ª∑Ê†º</th>
                            </tr>
                        </thead>
                        <tbody>`;
            
            const totalVolume = priceRanges.reduce((sum, range) => sum + parseFloat(range.volume), 0);
            
            priceRanges.forEach(range => {
                const percentage = totalVolume > 0 ? ((parseFloat(range.volume) / totalVolume) * 100).toFixed(2) : '0.00';
                const badgeClass = range.trades > 100 ? 'bg-primary' : range.trades > 50 ? 'bg-info' : range.trades > 20 ? 'bg-warning' : 'bg-secondary';
                
                html += `
                    <tr>
                        <td><strong>${range.range}</strong></td>
                        <td><span class="badge ${badgeClass}">${range.trades}</span></td>
                        <td>${parseFloat(range.volume).toLocaleString()}</td>
                        <td>${percentage}%</td>
                        <td>$${parseFloat(range.avg_price).toLocaleString()}</td>
                    </tr>`;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>`;
            
            detailsDiv.innerHTML = html;
        }
        
        // Ê†ºÂºèÂåñ‰ª∑Ê†º
        function formatPrice(price) {
            if (price === null || price === undefined) return '--';
            return '$' + formatNumber(price, 2);
        }
        
        // Ê†ºÂºèÂåñÁôæÂàÜÊØî
        function formatPercent(percent) {
            if (percent === null || percent === undefined) return '--';
            const formatted = percent >= 0 ? '+' + formatNumber(percent, 2) + '%' : formatNumber(percent, 2) + '%';
            return formatted;
        }
        
        // Ëé∑ÂèñÂ∏ÇÂú∫Êï∞ÊçÆ
        async function fetchMarketData() {
            try {
                const response = await fetch('/api/market-data');
                const data = await response.json();
                
                if (data.error) {
                    console.error('Market data error:', data.error);
                    return;
                }
                
                // Êõ¥Êñ∞BTC‰ª∑Ê†º
                document.getElementById('btcPrice').textContent = formatPrice(data.btc_price);
                
                // Êõ¥Êñ∞‰ª∑Ê†ºÂèòÂåñ
                const priceChange = document.getElementById('priceChange24h');
                if (data.price_change_24h !== null) {
                    priceChange.textContent = formatPercent(data.price_change_24h);
                    priceChange.className = data.price_change_24h >= 0 ? 'metric-change price-up' : 'metric-change price-down';
                }
                
                // Êõ¥Êñ∞ÁΩëÁªúÁÆóÂäõ
                document.getElementById('networkHashrate').textContent = formatNumber(data.network_hashrate, 1);
                document.getElementById('hashrateStatus').textContent = 'ÁΩëÁªúÂÆâÂÖ®';
                
                // Êõ¥Êñ∞ÊÅêÊÉßË¥™Â©™ÊåáÊï∞
                if (data.fear_greed_index !== null) {
                    document.getElementById('fearGreedIndex').textContent = data.fear_greed_index;
                    document.getElementById('fearGreedLabel').textContent = getFearGreedLabel(data.fear_greed_index);
                }
                
                // Êõ¥Êñ∞ÊúÄÂêéÊõ¥Êñ∞Êó∂Èó¥
                document.getElementById('lastUpdate').textContent = 'Êõ¥Êñ∞: ' + new Date(data.timestamp).toLocaleTimeString();
                
            } catch (error) {
                console.error('Error fetching market data:', error);
                document.getElementById('statusIndicator').className = 'status-indicator status-offline';
                document.getElementById('statusText').textContent = 'ËøûÊé•ÂºÇÂ∏∏';
            }
        }
        
        // Ëé∑ÂèñÊäÄÊúØÊåáÊ†á
        async function fetchTechnicalIndicators() {
            try {
                console.log('Loading technical indicators...');
                const response = await fetch('/api/analytics/technical-indicators', {
                    method: 'GET',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                console.log('Technical indicators response status:', response.status);
                
                if (!response.ok) {
                    if (response.status === 401 || response.status === 403) {
                        console.error('Authentication/authorization error for technical indicators');
                        throw new Error(`ËÆ§ËØÅÈîôËØØ: ${response.status}`);
                    }
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const response_data = await response.json();
                console.log('Technical indicators response:', response_data);
                
                if (response_data.error || !response_data.success) {
                    console.error('Technical indicators error:', response_data.error || 'Ëé∑ÂèñÂ§±Ë¥•');
                    return;
                }
                
                const data = response_data.data;
                console.log('Technical indicators data extracted:', data);
                
                if (!data) {
                    console.error('No technical indicators data received');
                    return;
                }
                
                // Ê∑ªÂä†ÂÆâÂÖ®Êõ¥Êñ∞ÂáΩÊï∞
                function updateElementSafely(elementId, value) {
                    const element = document.getElementById(elementId);
                    if (element) {
                        element.textContent = value || '--';
                    } else {
                        console.warn(`Element with ID '${elementId}' not found`);
                    }
                }
                
                // Êõ¥Êñ∞ÁßªÂä®Âπ≥ÂùáÁ∫ø
                updateElementSafely('sma20', formatPrice(data.sma_20));
                updateElementSafely('sma50', formatPrice(data.sma_50));
                updateElementSafely('ema12', formatPrice(data.ema_12));
                updateElementSafely('ema26', formatPrice(data.ema_26));
                
                // Êõ¥Êñ∞Âä®ÈáèÊåáÊ†á - ÂêåÊó∂Êõ¥Êñ∞‰∏§‰∏™RSIÊòæÁ§∫‰ΩçÁΩÆ
                updateElementSafely('rsiValue', formatNumber(data.rsi, 1));
                updateElementSafely('rsi14', formatNumber(data.rsi, 1));
                updateElementSafely('macd', formatNumber(data.macd, 4));
                updateElementSafely('volatility', formatPercent(data.volatility));
                
                // Êõ¥Êñ∞Â∏ÉÊûóÂ∏¶
                updateElementSafely('bollingerUpper', formatPrice(data.bollinger_upper));
                updateElementSafely('bollingerLower', formatPrice(data.bollinger_lower));
                
                // Êõ¥Êñ∞RSI‰ø°Âè∑
                if (data.rsi !== null) {
                    const rsi = data.rsi;
                    let rsiSignal = '--';
                    if (rsi < 30) rsiSignal = 'Ë∂ÖÂçñ';
                    else if (rsi > 70) rsiSignal = 'Ë∂Ö‰π∞';
                    else if (rsi < 50) rsiSignal = 'ÂÅèÂº±';
                    else rsiSignal = 'ÂÅèÂº∫';
                    
                    updateElementSafely('rsiSignal', rsiSignal);
                    console.log('RSI value updated to:', rsi);
                    console.log('RSI signal updated to:', rsiSignal);
                }
                
                console.log('Technical indicators updated successfully');
                
            } catch (error) {
                console.error('Error fetching technical indicators:', error);
                // ÊòæÁ§∫ÊùÉÈôêÈîôËØØÊèêÁ§∫
                const errorMsg = error.toString().includes('401') || error.toString().includes('403') ? 
                                'ÈúÄË¶ÅÊã•ÊúâËÄÖÊùÉÈôê' : 'Âä†ËΩΩÂ§±Ë¥•';
                document.getElementById('smaValue').textContent = errorMsg;
                document.getElementById('emaValue').textContent = errorMsg;
                document.getElementById('rsiValue').textContent = errorMsg;
                document.getElementById('macdValue').textContent = errorMsg;
                document.getElementById('bbValue').textContent = errorMsg;
            }
        }
        
        // Ëé∑Âèñ‰ª∑Ê†ºÂéÜÂè≤
        async function fetchPriceHistory() {
            try {
                const response = await fetch('/analytics/api/price-history?hours=24');
                const data = await response.json();
                
                if (data.length === 0) return;
                
                const labels = data.map(item => new Date(item.time).toLocaleTimeString());
                const prices = data.map(item => item.price);
                
                priceChart.data.labels = labels;
                priceChart.data.datasets[0].data = prices;
                priceChart.update();
                
            } catch (error) {
                console.error('Error fetching price history:', error);
            }
        }
        
        // Ëé∑ÂèñÂàÜÊûêÊä•Âëä
        async function fetchLatestReport() {
            try {
                console.log('Loading latest report...');
                const response = await fetch('/analytics/api/latest-report', {
                    method: 'GET',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                console.log('Report response status:', response.status);
                
                if (!response.ok) {
                    if (response.status === 401 || response.status === 403) {
                        console.error('Authentication/authorization error for latest report');
                        throw new Error(`ËÆ§ËØÅÈîôËØØ: ${response.status}`);
                    }
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('Report data:', data);
                
                if (data.error) {
                    console.log('Report error:', data.error);
                    document.getElementById('reportTitle').textContent = 'ÊöÇÊó†ÂàÜÊûêÊä•Âëä';
                    return;
                }
                
                if (!data || !data.title) {
                    console.log('No report data available');
                    document.getElementById('reportTitle').textContent = 'ÊöÇÊó†ÂàÜÊûêÊä•Âëä';
                    return;
                }
                
                // Êõ¥Êñ∞Êä•Âëä‰ø°ÊÅØ
                document.getElementById('reportTitle').textContent = data.title;
                document.getElementById('reportSummary').textContent = data.summary;
                
                // ‰øÆÂ§çÊó•ÊúüËß£ÊûêÈóÆÈ¢ò
                let reportTime = 'Êú™Áü•Êó∂Èó¥';
                if (data.generated_at) {
                    try {
                        const date = new Date(data.generated_at);
                        if (!isNaN(date.getTime())) {
                            reportTime = date.toLocaleString();
                        }
                    } catch (e) {
                        console.log('Date parsing error:', e);
                    }
                }
                document.getElementById('reportTime').textContent = reportTime;
                document.getElementById('confidenceScore').textContent = formatPercent(data.confidence_score * 100);
                
                // Êõ¥Êñ∞ÂÖ≥ÈîÆÂèëÁé∞
                if (data.key_findings) {
                    document.getElementById('priceRange').textContent = data.key_findings.price_range || '--';
                    document.getElementById('avgPrice').textContent = data.key_findings.avg_price || '--';
                    document.getElementById('marketSentiment').textContent = data.key_findings.market_sentiment || '--';
                }
                
                // Êõ¥Êñ∞Âª∫ËÆÆ
                const recommendationsDiv = document.getElementById('recommendations');
                recommendationsDiv.innerHTML = '';
                if (data.recommendations) {
                    data.recommendations.forEach(rec => {
                        const div = document.createElement('div');
                        div.className = 'recommendation-item';
                        div.textContent = rec;
                        recommendationsDiv.appendChild(div);
                    });
                }
                
                // Êõ¥Êñ∞È£éÈô©ËØÑ‰º∞
                if (data.risk_assessment) {
                    document.getElementById('riskScore').textContent = data.risk_assessment.risk_score || '--';
                    const riskLevel = document.getElementById('riskLevel');
                    riskLevel.textContent = data.risk_assessment.risk_level || '--';
                    riskLevel.className = 'metric-change risk-' + (data.risk_assessment.risk_level || 'medium').toLowerCase();
                }
                
            } catch (error) {
                console.error('Error fetching latest report:', error);
            }
        }
        
        // ËæÖÂä©ÂáΩÊï∞
        function getFearGreedLabel(index) {
            if (index <= 25) return 'ÊûÅÂ∫¶ÊÅêÊÉß';
            if (index <= 45) return 'ÊÅêÊÉß';
            if (index <= 55) return '‰∏≠ÊÄß';
            if (index <= 75) return 'Ë¥™Â©™';
            return 'ÊûÅÂ∫¶Ë¥™Â©™';
        }
        
        function getRSISignal(rsi) {
            if (rsi > 70) return 'Ë∂Ö‰π∞';
            if (rsi < 30) return 'Ë∂ÖÂçñ';
            return '‰∏≠ÊÄß';
        }
        
        // Âä†ËΩΩÊúçÂä°Âô®Á´Ø‰º†ÈÄíÁöÑÊï∞ÊçÆ
        function loadServerSideData() {
            console.log('Loading server-side technical indicators and reports...');
            
            // ÊäÄÊúØÊåáÊ†áÊï∞ÊçÆÊù•Ëá™ÊúçÂä°Âô®Á´Ø
            {% if technical_indicators %}
            const techData = {{ technical_indicators | tojson | safe }};
            console.log('Technical indicators from server:', techData);
            
            // Êõ¥Êñ∞RSI - ÂêåÊó∂Êõ¥Êñ∞‰∏§‰∏™ÊòæÁ§∫‰ΩçÁΩÆ
            if (techData.rsi !== null) {
                document.getElementById('rsiValue').textContent = formatNumber(techData.rsi, 1);
                document.getElementById('rsi14').textContent = formatNumber(techData.rsi, 1);
                document.getElementById('rsiSignal').textContent = getRSISignal(techData.rsi);
                console.log('Server-side RSI updated:', techData.rsi);
            }
            
            // Êõ¥Êñ∞ÂÖ∂‰ªñÊäÄÊúØÊåáÊ†á
            if (techData.sma_20) document.getElementById('sma20').textContent = formatPrice(techData.sma_20);
            if (techData.sma_50) document.getElementById('sma50').textContent = formatPrice(techData.sma_50);
            if (techData.ema_12) document.getElementById('ema12').textContent = formatPrice(techData.ema_12);
            if (techData.ema_26) document.getElementById('ema26').textContent = formatPrice(techData.ema_26);
            if (techData.rsi) document.getElementById('rsi14').textContent = formatNumber(techData.rsi, 1);
            if (techData.macd) document.getElementById('macd').textContent = formatNumber(techData.macd, 4);
            if (techData.volatility) document.getElementById('volatility').textContent = formatPercent(techData.volatility);
            if (techData.bollinger_upper) document.getElementById('bollingerUpper').textContent = formatPrice(techData.bollinger_upper);
            if (techData.bollinger_lower) document.getElementById('bollingerLower').textContent = formatPrice(techData.bollinger_lower);
            if (techData.sma_20) document.getElementById('bollingerMiddle').textContent = formatPrice(techData.sma_20);
            {% endif %}
            
            // ÂàÜÊûêÊä•ÂëäÊï∞ÊçÆÊù•Ëá™ÊúçÂä°Âô®Á´Ø
            {% if latest_report %}
            const reportData = {{ latest_report | tojson | safe }};
            console.log('Report from server:', reportData);
            
            // Êõ¥Êñ∞Êä•Âëä‰ø°ÊÅØ
            document.getElementById('reportTitle').textContent = reportData.title || 'ÊöÇÊó†Êä•Âëä';
            document.getElementById('reportSummary').textContent = reportData.summary || 'ÊöÇÊó†ÊëòË¶Å';
            
            // ‰øÆÂ§çÊó•ÊúüÊòæÁ§∫
            let reportTime = 'Êú™Áü•Êó∂Èó¥';
            if (reportData.generated_at) {
                try {
                    const date = new Date(reportData.generated_at);
                    if (!isNaN(date.getTime())) {
                        reportTime = date.toLocaleString();
                    }
                } catch (e) {
                    console.log('Date parsing error:', e);
                }
            }
            document.getElementById('reportTime').textContent = reportTime;
            
            if (reportData.confidence_score) {
                document.getElementById('confidenceScore').textContent = formatPercent(reportData.confidence_score * 100);
            }
            {% endif %}
            
            console.log('Server-side data loading completed');
        }
        
        // ÂàùÂßãÂåñÂíåÂÆöÊó∂Êõ¥Êñ∞
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üî• DOMContentLoaded fired - starting initialization...');
            
            try {
                initPriceChart();
                initNetworkHistoryCharts();
                
                // Á´ãÂç≥Âä†ËΩΩÊï∞ÊçÆ
                fetchMarketData();
                fetchTechnicalIndicators(); // Á´ãÂç≥Âä†ËΩΩÊäÄÊúØÊåáÊ†á
                fetchPriceHistory();
                fetchNetworkHistory(); // Âä†ËΩΩÁΩëÁªúÂéÜÂè≤Êï∞ÊçÆ
                
                // Âä†ËΩΩÊúçÂä°Âô®Á´Ø‰º†ÈÄíÁöÑÊï∞ÊçÆ
                console.log('Loading server-side data...');
                loadServerSideData();
            } catch (error) {
                console.error('‚ùå Error in initial setup:', error);
            }
            
            // ÂàùÂßãÂåñ‰∏âÂ§ß‰∫§ÊòìÊâÄÂõæË°®ÂíåÊï∞ÊçÆ (Áã¨Á´ãÊâßË°åÔºåÈÅøÂÖçË¢´ÂâçÈù¢ÁöÑÈîôËØØÂΩ±Âìç)
            setTimeout(function() {
                console.log('üöÄ Initializing three-exchange trading data visualization...');
            
            // ÂÖàÊ£ÄÊü•HTMLÂÖÉÁ¥†ÊòØÂê¶Â≠òÂú®
            const exchangeElements = [
                'exchangeTotalTrades', 'exchangeTotalVolume', 
                'exchangeAvgPrice', 'exchangeLastUpdate', 'tradingDataStatus'
            ];
            
            console.log('üîç Checking if exchange elements exist...');
            exchangeElements.forEach(id => {
                const element = document.getElementById(id);
                console.log(`Element ${id}: ${element ? '‚úÖ Found' : '‚ùå Missing'}`);
            });
            
            try {
                console.log('üöÄ Starting three-exchange initialization...');
                initExchangeCharts();
                console.log('üìä Charts initialized, now loading trading data...');
                window.loadExchangeTradingData();
                console.log('üìà Trading data loading started, now loading analysis data...');
                loadExchangeAnalysisData();
                console.log('‚úÖ Three-exchange initialization completed successfully');
            } catch (error) {
                console.error('‚ùå Error initializing three-exchange features:', error);
            }
            }, 1000); // Âª∂Ëøü1ÁßíÊâßË°åÔºåÁ°Æ‰øùÈ°µÈù¢ÂÆåÂÖ®Âä†ËΩΩ
            
            // ËÆæÁΩÆÂÆöÊó∂Êõ¥Êñ∞
            setInterval(fetchMarketData, 60000);        // ÊØèÂàÜÈíüÊõ¥Êñ∞Â∏ÇÂú∫Êï∞ÊçÆ
            setInterval(fetchTechnicalIndicators, 300000); // ÊØè5ÂàÜÈíüÊõ¥Êñ∞ÊäÄÊúØÊåáÊ†á
            setInterval(fetchPriceHistory, 300000);      // ÊØè5ÂàÜÈíüÊõ¥Êñ∞‰ª∑Ê†ºÂõæË°®
            setInterval(fetchLatestReport, 900000);      // ÊØè15ÂàÜÈíüÊõ¥Êñ∞Êä•Âëä
            setInterval(fetchNetworkHistory, 600000);    // ÊØè10ÂàÜÈíüÊõ¥Êñ∞ÁΩëÁªúÂéÜÂè≤Êï∞ÊçÆ
            
            // ËÆæÁΩÆ‰∏âÂ§ß‰∫§ÊòìÊâÄÊï∞ÊçÆÂÆöÊó∂Êõ¥Êñ∞ (ÊØè15ÂàÜÈíü)
            setInterval(window.loadExchangeTradingData, 900000);
            setInterval(loadExchangeAnalysisData, 900000);
        });

        // ÂàùÂßãÂåñ‰∏âÂ§ß‰∫§ÊòìÊâÄÂõæË°®
        function initExchangeCharts() {
            console.log('Initializing exchange charts...');
            
            // ‰ª∑Ê†ºÂå∫Èó¥ÂõæË°®
            const priceRangeCtx = document.getElementById('exchangePriceRangeChart');
            if (priceRangeCtx) {
                exchangePriceRangeChart = new Chart(priceRangeCtx, {
                    type: 'bar',
                    data: {
                        labels: [],
                        datasets: [{
                            label: '‰∫§ÊòìÈáè',
                            data: [],
                            backgroundColor: 'rgba(255, 193, 7, 0.8)',
                            borderColor: 'rgba(255, 193, 7, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: { color: '#ffffff' }
                            }
                        },
                        scales: {
                            x: {
                                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                ticks: { color: '#ffffff' }
                            },
                            y: {
                                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                ticks: { color: '#ffffff' }
                            }
                        }
                    }
                });
            }
            
            // ‰∫§ÊòìÊñπÂêëÂõæË°®
            const directionCtx = document.getElementById('exchangeDirectionChart');
            if (directionCtx) {
                exchangeDirectionChart = new Chart(directionCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['‰π∞ÂÖ•', 'ÂçñÂá∫'],
                        datasets: [{
                            data: [50, 50],
                            backgroundColor: ['#48bb78', '#e53e3e'],
                            borderColor: ['#48bb78', '#e53e3e'],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: { color: '#ffffff' }
                            }
                        }
                    }
                });
            }
        }
        
        // Âä†ËΩΩ‰∏âÂ§ß‰∫§ÊòìÊâÄÂàÜÊûêÊï∞ÊçÆÔºàÂõæË°®ÂíåËØ¶ÁªÜ‰ø°ÊÅØÔºâ  
        async function loadExchangeAnalysisData() {
            try {
                document.getElementById('exchangeLoadingIndicator').style.display = 'block';
                document.getElementById('exchangePriceRangeDetails').style.display = 'none';
                
                const response = await fetch('/api/deribit/analysis-data');
                const result = await response.json();
                
                if (result.success && result.data.price_ranges && result.data.price_ranges.length > 0) {
                    const data = result.data;
                    
                    // Êõ¥Êñ∞‰ª∑Ê†ºÂå∫Èó¥ÂõæË°®
                    updateExchangePriceRangeChart(data.price_ranges);
                    
                    // Êõ¥Êñ∞‰∫§ÊòìÊñπÂêëÂõæË°®
                    if (data.direction_stats) {
                        updateExchangeDirectionChart(data.direction_stats);
                    }
                    
                    // ÊòæÁ§∫ËØ¶ÁªÜË°®Ê†º
                    displayExchangePriceRangeDetails(data.price_ranges);
                    
                    document.getElementById('exchangeLoadingIndicator').style.display = 'none';
                    document.getElementById('exchangePriceRangeDetails').style.display = 'block';
                } else {
                    document.getElementById('exchangeLoadingIndicator').innerHTML = '<p class="text-warning">ÊöÇÊó†‰∫§ÊòìÊï∞ÊçÆ</p>';
                }
            } catch (error) {
                console.error('Âä†ËΩΩÂàÜÊûêÊï∞ÊçÆÂ§±Ë¥•:', error);
                document.getElementById('exchangeLoadingIndicator').innerHTML = '<p class="text-danger">Êï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•</p>';
            }
        }

        // Êõ¥Êñ∞‰ª∑Ê†ºÂå∫Èó¥ÂõæË°®
        function updateExchangePriceRangeChart(priceRanges) {
            if (!exchangePriceRangeChart) return;
            
            const labels = priceRanges.map(range => range.range);
            const data = priceRanges.map(range => parseFloat(range.volume));
            
            exchangePriceRangeChart.data.labels = labels;
            exchangePriceRangeChart.data.datasets[0].data = data;
            exchangePriceRangeChart.update();
        }

        // Êõ¥Êñ∞‰∫§ÊòìÊñπÂêëÂõæË°®
        function updateExchangeDirectionChart(directionStats) {
            if (!exchangeDirectionChart) return;
            
            const buyData = directionStats.buy || 0;
            const sellData = directionStats.sell || 0;
            
            exchangeDirectionChart.data.datasets[0].data = [buyData, sellData];
            exchangeDirectionChart.update();
        }

        // ÊòæÁ§∫‰ª∑Ê†ºÂå∫Èó¥ËØ¶ÁªÜÊï∞ÊçÆ
        function displayExchangePriceRangeDetails(priceRanges) {
            const detailsContainer = document.getElementById('exchangePriceRangeDetails');
            if (!detailsContainer) return;
            
            let tableHtml = `
                <table class="table table-dark table-striped">
                    <thead>
                        <tr>
                            <th>‰ª∑Ê†ºÂå∫Èó¥</th>
                            <th>‰∫§ÊòìÁ¨îÊï∞</th>
                            <th>‰∫§ÊòìÈáè</th>
                            <th>Âç†ÊØî</th>
                            <th>Âπ≥Âùá‰ª∑Ê†º</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            priceRanges.forEach(range => {
                tableHtml += `
                    <tr>
                        <td>${range.range}</td>
                        <td>${range.count}</td>
                        <td>${parseFloat(range.volume).toFixed(2)}</td>
                        <td>${range.percentage}%</td>
                        <td>$${parseFloat(range.avg_price).toFixed(4)}</td>
                    </tr>
                `;
            });
            
            tableHtml += `
                    </tbody>
                </table>
            `;
            
            detailsContainer.innerHTML = tableHtml;
        }
        
        // ÁΩëÁªúÂéÜÂè≤ÂõæË°®ÂèòÈáè
        let priceHistoryChart, difficultyHistoryChart, hashrateHistoryChart;
        
        // ÂàùÂßãÂåñÁΩëÁªúÂéÜÂè≤ÂõæË°®
        function initNetworkHistoryCharts() {
            console.log('Initializing network history charts...');
            
            // Ê£ÄÊü•canvasÂÖÉÁ¥†ÊòØÂê¶Â≠òÂú®
            const priceCanvas = document.getElementById('priceHistoryChart');
            const difficultyCanvas = document.getElementById('difficultyHistoryChart');
            const hashrateCanvas = document.getElementById('hashrateHistoryChart');
            
            console.log('Canvas elements found:', {
                priceCanvas: !!priceCanvas,
                difficultyCanvas: !!difficultyCanvas,
                hashrateCanvas: !!hashrateCanvas
            });
            
            if (!priceCanvas || !difficultyCanvas || !hashrateCanvas) {
                console.error('Some canvas elements not found for network history charts');
                return;
            }
            
            // ‰ª∑Ê†ºÂéÜÂè≤ÂõæË°®
            const priceCtx = priceCanvas.getContext('2d');
            priceHistoryChart = new Chart(priceCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'BTC Price ($)',
                        data: [],
                        borderColor: '#f59e0b',
                        backgroundColor: 'rgba(245, 158, 11, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'BTC Price (30d)',
                            color: '#ffffff'
                        },
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            display: false
                        },
                        y: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#ffffff',
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
            
            // ÈöæÂ∫¶ÂéÜÂè≤ÂõæË°®
            const diffCtx = difficultyCanvas.getContext('2d');
            difficultyHistoryChart = new Chart(diffCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Difficulty',
                        data: [],
                        borderColor: '#ef4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Network Difficulty (30d)',
                            color: '#ffffff'
                        },
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            display: false
                        },
                        y: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#ffffff',
                                callback: function(value) {
                                    return (value / 1e12).toFixed(1) + 'T';
                                }
                            }
                        }
                    }
                }
            });
            
            // ÁÆóÂäõÂéÜÂè≤ÂõæË°®
            const hashCtx = hashrateCanvas.getContext('2d');
            hashrateHistoryChart = new Chart(hashCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Hashrate (EH/s)',
                        data: [],
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Network Hashrate (30d)',
                            color: '#ffffff'
                        },
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            display: false
                        },
                        y: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#ffffff',
                                callback: function(value) {
                                    return value.toFixed(0) + ' EH/s';
                                }
                            }
                        }
                    }
                }
            });
            
            console.log('Network history charts initialized successfully');
        }
        
        // Ëé∑ÂèñÁΩëÁªúÂéÜÂè≤Êï∞ÊçÆ
        async function fetchNetworkHistory() {
            try {
                console.log('Loading network history data...');
                const response = await fetch('/api/network-history', {
                    method: 'GET',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                console.log('Network history response status:', response.status);
                
                if (!response.ok) {
                    if (response.status === 401 || response.status === 403) {
                        console.error('Authentication/authorization error for network history');
                        throw new Error(`ËÆ§ËØÅÈîôËØØ: ${response.status}`);
                    }
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                console.log('Network history response:', result);
                
                if (result.success && result.data && result.data.length > 0) {
                    const data = result.data;
                    const labels = data.map(item => new Date(item.timestamp).toLocaleDateString());
                    
                    // Êõ¥Êñ∞‰ª∑Ê†ºÂõæË°®
                    priceHistoryChart.data.labels = labels;
                    priceHistoryChart.data.datasets[0].data = data.map(item => item.btc_price);
                    priceHistoryChart.update();
                    
                    // Êõ¥Êñ∞ÈöæÂ∫¶ÂõæË°®
                    difficultyHistoryChart.data.labels = labels;
                    difficultyHistoryChart.data.datasets[0].data = data.map(item => item.network_difficulty);
                    difficultyHistoryChart.update();
                    
                    // Êõ¥Êñ∞ÁÆóÂäõÂõæË°®
                    hashrateHistoryChart.data.labels = labels;
                    hashrateHistoryChart.data.datasets[0].data = data.map(item => item.network_hashrate);
                    hashrateHistoryChart.update();
                    
                    console.log('ÁΩëÁªúÂéÜÂè≤Êï∞ÊçÆÊõ¥Êñ∞ÂÆåÊàêÔºåÊï∞ÊçÆÁÇπÊï∞:', data.length);
                } else {
                    console.log('No network history data available');
                }
            } catch (error) {
                console.error('Ëé∑ÂèñÁΩëÁªúÂéÜÂè≤Êï∞ÊçÆÂ§±Ë¥•:', error);
            }
        }
        
        <!-- DeribitÂàÜÊûêÊ†áÁ≠æÈ°µÁõ∏ÂÖ≥ÂáΩÊï∞ -->
        let deribitPriceRangeChart = null;
        let deribitDirectionChart = null;
        let deribitCollectionInterval = null;
        
        // ÂàùÂßãÂåñDeribitÂõæË°®
        function initializeDeribitCharts() {
            // ‰ª∑Ê†ºÂå∫Èó¥ÂõæË°®
            const priceCtx = document.getElementById('deribitPriceRangeChart');
            if (priceCtx) {
                deribitPriceRangeChart = new Chart(priceCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: [],
                        datasets: [{
                            label: '‰∫§ÊòìÈáè',
                            data: [],
                            backgroundColor: 'rgba(243, 156, 18, 0.6)',
                            borderColor: 'rgba(243, 156, 18, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { labels: { color: '#fff' } }
                        },
                        scales: {
                            y: { 
                                beginAtZero: true,
                                ticks: { color: '#fff' }
                            },
                            x: { 
                                ticks: { color: '#fff' }
                            }
                        }
                    }
                });
            }
            
            // ÊñπÂêëÂõæË°®
            const dirCtx = document.getElementById('deribitDirectionChart');
            if (dirCtx) {
                deribitDirectionChart = new Chart(dirCtx.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: ['‰π∞ÂÖ•', 'ÂçñÂá∫'],
                        datasets: [{
                            data: [0, 0],
                            backgroundColor: ['#27ae60', '#e74c3c']
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { labels: { color: '#fff' } }
                        }
                    }
                });
            }
        }
        
        // Ê£ÄÊü•APIÁä∂ÊÄÅ
        async function checkDeribitApiStatus() {
            try {
                const response = await fetch('/api/deribit/status');
                const data = await response.json();
                
                const statusElement = document.getElementById('deribitApiStatus');
                if (statusElement) {
                    statusElement.textContent = data.success ? '‚úì Ê≠£Â∏∏' : '‚úó ÂºÇÂ∏∏';
                    statusElement.className = data.success ? 'h4 text-success' : 'h4 text-danger';
                }
            } catch (error) {
                const statusElement = document.getElementById('deribitApiStatus');
                if (statusElement) {
                    statusElement.textContent = '‚úó ËøûÊé•Â§±Ë¥•';
                    statusElement.className = 'h4 text-danger';
                }
            }
        }
        
        // Âä†ËΩΩDeribitÂàùÂßãÊï∞ÊçÆ
        function loadDeribitInitialData() {
            loadDeribitMultiExchangeStats();
            loadDeribitAnalysisData();
        }
        
        // Âä†ËΩΩÂ§ö‰∫§ÊòìÊâÄÁªüËÆ°Êï∞ÊçÆÔºàDeribitÊ†áÁ≠æÈ°µÔºâ
        async function loadDeribitMultiExchangeStats() {
            try {
                const response = await fetch('/api/deribit/multi-exchange-trades');
                const result = await response.json();
                
                if (result.success && result.data) {
                    const data = result.data;
                    
                    // ËÆ°ÁÆóUSD‰ª∑Ê†ºÔºàÂÅáËÆæÂΩìÂâçBTC‰ª∑Ê†ºÔºâ
                    const btcPrice = 118000; // ËøôÈáåÂèØ‰ª•‰ªéÂ∏ÇÂú∫Êï∞ÊçÆËé∑Âèñ
                    const avgPriceUSD = (data.avg_price * btcPrice).toFixed(0);
                    
                    // Êõ¥Êñ∞ÁªüËÆ°Âç°Áâá
                    updateElement('deribitTotalTrades', data.exchange_breakdown?.Deribit?.count || 0);
                    updateElement('deribitTotalVolume', formatNumber(data.exchange_breakdown?.Deribit?.volume || 0, 1));
                    updateElement('deribitAvgPrice', `$${formatNumber(avgPriceUSD)} (${formatNumber(data.avg_price, 4)} BTC)`);
                    updateElement('deribitLastUpdate', data.last_update || '--');
                }
            } catch (error) {
                console.error('Âä†ËΩΩDeribit‰∫§ÊòìÊï∞ÊçÆÂ§±Ë¥•:', error);
            }
        }
        
        // Âä†ËΩΩDeribitÂàÜÊûêÊï∞ÊçÆ
        async function loadDeribitAnalysisData() {
            try {
                const response = await fetch('/api/deribit/analysis-data');
                const result = await response.json();
                
                if (result.success && result.data) {
                    updateDeribitPriceRangeChart(result.data.price_ranges || []);
                    if (result.data.direction_stats) {
                        updateDeribitDirectionChart(result.data.direction_stats);
                    }
                }
            } catch (error) {
                console.error('Âä†ËΩΩDeribitÂàÜÊûêÊï∞ÊçÆÂ§±Ë¥•:', error);
            }
        }
        
        // Êõ¥Êñ∞Deribit‰ª∑Ê†ºÂå∫Èó¥ÂõæË°®
        function updateDeribitPriceRangeChart(priceRanges) {
            if (!deribitPriceRangeChart || !priceRanges.length) return;
            
            const labels = priceRanges.map(range => range.range);
            const data = priceRanges.map(range => parseFloat(range.volume));
            
            deribitPriceRangeChart.data.labels = labels;
            deribitPriceRangeChart.data.datasets[0].data = data;
            deribitPriceRangeChart.update();
        }
        
        // Êõ¥Êñ∞DeribitÊñπÂêëÂõæË°®
        function updateDeribitDirectionChart(directionStats) {
            if (!deribitDirectionChart) return;
            
            const buyCount = directionStats.buy_count || 0;
            const sellCount = directionStats.sell_count || 0;
            
            deribitDirectionChart.data.datasets[0].data = [buyCount, sellCount];
            deribitDirectionChart.update();
        }
        
        // ÈÄöÁî®ÂÖÉÁ¥†Êõ¥Êñ∞ÂáΩÊï∞
        function updateElement(id, value) {
            const element = document.getElementById(id);
            if (element) {
                element.textContent = value;
            }
        }
        
        // URLÂèÇÊï∞Â§ÑÁêÜÂíåÊ†áÁ≠æÈ°µËá™Âä®ÂàáÊç¢
        function checkUrlParametersAndSwitchTab() {
            const urlParams = new URLSearchParams(window.location.search);
            const tabParam = urlParams.get('tab');
            
            if (tabParam === 'deribit') {
                // Ëá™Âä®ÊøÄÊ¥ªDeribitÊ†áÁ≠æÈ°µ
                const deribitTab = document.getElementById('deribit-tab');
                const deribitTabPane = document.getElementById('deribit');
                const overviewTab = document.getElementById('overview-tab');
                const overviewTabPane = document.getElementById('overview');
                
                if (deribitTab && deribitTabPane && overviewTab && overviewTabPane) {
                    // ÁßªÈô§Ê¶ÇËßàÊ†áÁ≠æÁöÑÊøÄÊ¥ªÁä∂ÊÄÅ
                    overviewTab.classList.remove('active');
                    overviewTab.setAttribute('aria-selected', 'false');
                    overviewTabPane.classList.remove('show', 'active');
                    
                    // ÊøÄÊ¥ªDeribitÊ†áÁ≠æ
                    deribitTab.classList.add('active');
                    deribitTab.setAttribute('aria-selected', 'true');
                    deribitTabPane.classList.add('show', 'active');
                    
                    // ÂàùÂßãÂåñDeribitÂõæË°®ÂíåÊï∞ÊçÆ
                    setTimeout(() => {
                        initializeDeribitCharts();
                        checkDeribitApiStatus();
                        loadDeribitInitialData();
                        console.log('‚úÖ Automatically switched to Deribit analysis tab');
                    }, 200);
                }
            }
        }

        // Ê†áÁ≠æÈ°µÂàáÊç¢‰∫ã‰ª∂Â§ÑÁêÜ
        document.addEventListener('DOMContentLoaded', function() {
            // Ê£ÄÊü•URLÂèÇÊï∞Âπ∂Ëá™Âä®ÂàáÊç¢Ê†áÁ≠æÈ°µ
            checkUrlParametersAndSwitchTab();
            
            const deribitTab = document.getElementById('deribit-tab');
            if (deribitTab) {
                deribitTab.addEventListener('shown.bs.tab', function() {
                    // ÂΩìÂàáÊç¢Âà∞DeribitÊ†áÁ≠æÈ°µÊó∂ÔºåÂàùÂßãÂåñÂõæË°®ÂíåÂä†ËΩΩÊï∞ÊçÆ
                    setTimeout(() => {
                        initializeDeribitCharts();
                        checkDeribitApiStatus();
                        loadDeribitInitialData();
                    }, 100);
                });
            }
        });
        
        // Treasury Management Áõ∏ÂÖ≥ÂáΩÊï∞
        let currentSelectedLayer = 'L2'; // ÈªòËÆ§Â±ÇÁ∫ß
        
        // Ëé∑ÂèñTreasuryÊï∞ÊçÆ
        async function fetchTreasuryData(layer = null) {
            try {
                const url = layer ? `/api/treasury/next-sell-indicator?layer=${layer}` : '/api/treasury/next-sell-indicator';
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.success) {
                    updateTreasuryDisplay(data.data);
                }
            } catch (error) {
                console.error('Treasury data fetch error:', error);
            }
        }
        
        // Ëé∑ÂèñÊäïËµÑÁªÑÂêàÊï∞ÊçÆ
        async function fetchPortfolioData() {
            try {
                const response = await fetch('/api/treasury/overview');
                const data = await response.json();
                
                if (data.success) {
                    updatePortfolioDisplay(data);
                }
            } catch (error) {
                console.error('Portfolio data fetch error:', error);
            }
        }
        
        // Êõ¥Êñ∞TreasuryÊòæÁ§∫
        function updateTreasuryDisplay(data) {
            const nextSellPriceEl = document.getElementById('nextSellPrice');
            const zoneLowEl = document.getElementById('zoneLow');
            const zoneHighEl = document.getElementById('zoneHigh');
            const qtyBtcEl = document.getElementById('qtyBtc');
            const confidenceEl = document.getElementById('confidence');
            const proximityEl = document.getElementById('proximity');
            
            if (nextSellPriceEl) nextSellPriceEl.textContent = `$${data.next_price.toLocaleString()}`;
            if (zoneLowEl) zoneLowEl.textContent = `$${data.zone_low.toLocaleString()}`;
            if (zoneHighEl) zoneHighEl.textContent = `$${data.zone_high.toLocaleString()}`;
            if (qtyBtcEl) qtyBtcEl.textContent = data.qty_btc;
            if (confidenceEl) confidenceEl.textContent = data.confidence;
            if (proximityEl) proximityEl.textContent = data.proximity_pct;
            
            // Êõ¥Êñ∞ÂΩìÂâçÂ±ÇÁ∫ß‰ø°ÊÅØ
            if (data.layer) {
                const currentLayerEl = document.getElementById('currentLayer');
                const currentLayerNameEl = document.getElementById('currentLayerName');
                const currentRiskEl = document.getElementById('currentRisk');
                
                if (currentLayerEl) currentLayerEl.textContent = data.layer;
                if (currentLayerNameEl) currentLayerNameEl.textContent = data.layer_name || '';
                if (currentRiskEl) currentRiskEl.textContent = data.risk_level || '';
            }
            
            // Êõ¥Êñ∞Êé®ÁêÜËøáÁ®ã
            const reasonsList = document.getElementById('reasonsList');
            if (data.reasons && reasonsList) {
                reasonsList.innerHTML = data.reasons.map(reason => 
                    `<div class="alert alert-info mb-2"><i class="bi bi-lightbulb"></i> ${reason}</div>`
                ).join('');
            }
        }
        
        // Êõ¥Êñ∞ÊäïËµÑÁªÑÂêàÊòæÁ§∫
        function updatePortfolioDisplay(data) {
            const btcInventoryEl = document.getElementById('btcInventory');
            const avgCostBasisEl = document.getElementById('avgCostBasis');
            const cashReservesEl = document.getElementById('cashReserves');
            const monthlyOpexEl = document.getElementById('monthlyOpex');
            const unrealizedPLEl = document.getElementById('unrealizedPL');
            
            if (btcInventoryEl) btcInventoryEl.textContent = `${data.btc_inventory} BTC`;
            if (avgCostBasisEl) avgCostBasisEl.textContent = `$${data.avg_cost_basis.toLocaleString()}`;
            if (cashReservesEl) cashReservesEl.textContent = `$${data.cash_reserves.toLocaleString()}`;
            if (monthlyOpexEl) monthlyOpexEl.textContent = `$${data.monthly_opex.toLocaleString()}`;
            if (unrealizedPLEl) unrealizedPLEl.textContent = `+${data.unrealized_pl.toFixed(2)}%`;
        }
        
        // Â∫îÁî®Â±ÇÁ∫ßËÆæÁΩÆ
        async function applyLayerSetting() {
            const layerSelector = document.getElementById('layerSelector');
            if (!layerSelector) return;
            
            const selectedLayer = layerSelector.value;
            currentSelectedLayer = selectedLayer;
            
            try {
                // ÂèëÈÄÅËÆæÁΩÆËØ∑Ê±Ç
                const response = await fetch('/api/treasury/set-layer', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ layer: selectedLayer })
                });
                
                const result = await response.json();
                if (result.success) {
                    // Âà∑Êñ∞Êï∞ÊçÆ
                    await fetchTreasuryData(selectedLayer);
                    
                    // ÊòæÁ§∫ÊàêÂäüÊ∂àÊÅØ
                    showLayerUpdateMessage(result.message);
                }
            } catch (error) {
                console.error('Layer setting error:', error);
            }
        }
        
        // ÊòæÁ§∫Â±ÇÁ∫ßÊõ¥Êñ∞Ê∂àÊÅØ
        function showLayerUpdateMessage(message) {
            const treasuryPane = document.getElementById('treasury');
            if (!treasuryPane) return;
            
            const alert = document.createElement('div');
            alert.className = 'alert alert-success alert-dismissible fade show mt-3';
            alert.innerHTML = `
                <i class="bi bi-check-circle"></i> ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            const firstRow = treasuryPane.querySelector('.row');
            if (firstRow) {
                firstRow.parentNode.insertBefore(alert, firstRow);
            }
            
            // 3ÁßíÂêéËá™Âä®Ê∂àÂ§±
            setTimeout(() => {
                if (alert.parentNode) {
                    alert.remove();
                }
            }, 3000);
        }
        
        // ÂàùÂßãÂåñTreasury Management
        document.addEventListener('DOMContentLoaded', function() {
            // ÂàùÂßãÂåñTreasuryÊï∞ÊçÆ
            fetchTreasuryData();
            fetchPortfolioData();
            
            // ÁªëÂÆöÂ±ÇÁ∫ßÈÄâÊã©‰∫ã‰ª∂
            const applyLayerBtn = document.getElementById('applyLayerBtn');
            if (applyLayerBtn) {
                applyLayerBtn.addEventListener('click', applyLayerSetting);
            }
            
            // ËÆæÁΩÆÂÆöÊó∂Âà∑Êñ∞TreasuryÊï∞ÊçÆ
            setInterval(() => {
                fetchTreasuryData(currentSelectedLayer);
                fetchPortfolioData();
            }, 60000); // 60ÁßíÂà∑Êñ∞‰∏ÄÊ¨°
        });
        
    </script>
    <script src="/static/js/i18n.js"></script>
</body>
</html>