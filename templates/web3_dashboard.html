{% extends "base.html" %}

{% block title %}
    {% if current_lang == 'en' %}Web3 Transparency Dashboard{% else %}Web3é€æ˜åº¦å¹³å°{% endif %} - BTC Mining Calculator
{% endblock %}

{% block extra_css %}
<style>
/* Web3 Dashboardä¸“ç”¨æ ·å¼ */
:root {
    --web3-primary: #00d4ff;
    --web3-secondary: #7c3aed;
    --web3-accent: #fbbf24;
    --web3-success: #10b981;
    --web3-warning: #f59e0b;
    --web3-danger: #ef4444;
    --bg-gradient: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
    --card-bg: rgba(255, 255, 255, 0.08);
    --card-border: rgba(0, 212, 255, 0.2);
    --text-primary: #ffffff;
    --text-secondary: #b8b8b8;
    --shadow-glow: 0 8px 32px rgba(0, 212, 255, 0.15);
    --neon-glow: 0 0 20px rgba(0, 212, 255, 0.5);
}

body {
    background: var(--bg-gradient);
    min-height: 100vh;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
}

.web3-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 2rem;
    position: relative;
}

/* Hero Section */
.web3-hero {
    text-align: center;
    margin-bottom: 3rem;
    position: relative;
}

.web3-title {
    font-size: 3.5rem;
    font-weight: 800;
    background: linear-gradient(135deg, var(--web3-primary), var(--web3-secondary), var(--web3-accent));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 1rem;
    text-shadow: 0 0 30px rgba(0, 212, 255, 0.3);
    letter-spacing: -0.02em;
}

.web3-subtitle {
    font-size: 1.2rem;
    color: var(--text-secondary);
    margin-bottom: 2rem;
    max-width: 700px;
    margin-left: auto;
    margin-right: auto;
    line-height: 1.6;
}

/* Wallet Connection Status */
.wallet-status {
    display: inline-flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem 2rem;
    background: rgba(0, 212, 255, 0.1);
    border: 1px solid var(--web3-primary);
    border-radius: 50px;
    backdrop-filter: blur(10px);
    transition: all 0.3s ease;
}

.wallet-status:hover {
    background: rgba(0, 212, 255, 0.15);
    box-shadow: var(--neon-glow);
}

.wallet-indicator {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: var(--web3-success);
    box-shadow: 0 0 10px var(--web3-success);
    animation: pulse 2s infinite;
}

.wallet-indicator.disconnected {
    background: var(--web3-danger);
    box-shadow: 0 0 10px var(--web3-danger);
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

.wallet-text {
    color: var(--text-primary);
    font-weight: 600;
    font-size: 0.95rem;
}

.wallet-address {
    color: var(--web3-primary);
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.9rem;
}

/* Dashboard Grid */
.web3-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 2rem;
    margin-top: 2rem;
}

/* Card Styles */
.web3-card {
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    border-radius: 24px;
    padding: 2rem;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    position: relative;
    overflow: hidden;
    backdrop-filter: blur(20px);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.web3-card:hover {
    transform: translateY(-8px) scale(1.02);
    box-shadow: var(--shadow-glow);
    border-color: var(--web3-primary);
}

.web3-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, transparent, rgba(0, 212, 255, 0.05), transparent);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.web3-card:hover::before {
    opacity: 1;
}

/* Card Headers */
.card-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1.5rem;
    position: relative;
    z-index: 2;
}

.card-title {
    font-size: 1.3rem;
    font-weight: 700;
    color: var(--text-primary);
    margin: 0;
}

.card-icon {
    font-size: 2rem;
    color: var(--web3-primary);
    filter: drop-shadow(0 0 10px currentColor);
}

/* Statistics */
.stat-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
    margin-top: 1rem;
}

.stat-item {
    text-align: center;
    padding: 1rem;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 16px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
}

.stat-item:hover {
    background: rgba(0, 212, 255, 0.1);
    border-color: var(--web3-primary);
}

.stat-value {
    font-size: 1.8rem;
    font-weight: 800;
    color: var(--web3-primary);
    display: block;
    margin-bottom: 0.5rem;
}

.stat-label {
    font-size: 0.85rem;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* Action Buttons */
.action-buttons {
    display: flex;
    gap: 1rem;
    margin-top: 1.5rem;
}

.btn-web3 {
    flex: 1;
    padding: 0.75rem 1.5rem;
    border: 1px solid var(--web3-primary);
    background: rgba(0, 212, 255, 0.1);
    color: var(--web3-primary);
    border-radius: 12px;
    font-weight: 600;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    text-align: center;
    position: relative;
    overflow: hidden;
}

.btn-web3:hover {
    background: var(--web3-primary);
    color: #000;
    box-shadow: var(--neon-glow);
    transform: translateY(-2px);
}

.btn-web3::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s;
}

.btn-web3:hover::before {
    left: 100%;
}

.btn-secondary {
    border-color: var(--web3-secondary);
    background: rgba(124, 58, 237, 0.1);
    color: var(--web3-secondary);
}

.btn-secondary:hover {
    background: var(--web3-secondary);
    color: white;
    box-shadow: 0 0 20px rgba(124, 58, 237, 0.5);
}

/* Status Indicators */
.status-indicator {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.status-connected {
    background: rgba(16, 185, 129, 0.2);
    color: var(--web3-success);
    border: 1px solid var(--web3-success);
}

.status-disconnected {
    background: rgba(239, 68, 68, 0.2);
    color: var(--web3-danger);
    border: 1px solid var(--web3-danger);
}

.status-pending {
    background: rgba(245, 158, 11, 0.2);
    color: var(--web3-warning);
    border: 1px solid var(--web3-warning);
}

/* Network Status */
.network-info {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-top: 1rem;
    padding: 1rem;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 12px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.network-name {
    font-weight: 600;
    color: var(--text-primary);
}

.network-details {
    font-size: 0.85rem;
    color: var(--text-secondary);
    font-family: 'JetBrains Mono', monospace;
}

/* Progress Bars */
.progress-container {
    margin-top: 1rem;
}

.progress-label {
    display: flex;
    justify-content: space-between;
    margin-bottom: 0.5rem;
    font-size: 0.85rem;
    color: var(--text-secondary);
}

.progress-bar {
    width: 100%;
    height: 8px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 4px;
    overflow: hidden;
    position: relative;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--web3-primary), var(--web3-secondary));
    border-radius: 4px;
    transition: width 0.8s ease;
    position: relative;
}

.progress-fill::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    bottom: 0;
    right: 0;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    animation: shimmer 2s infinite;
}

@keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}

/* Responsive Design */
@media (max-width: 768px) {
    .web3-container {
        padding: 1rem;
    }
    
    .web3-title {
        font-size: 2.5rem;
    }
    
    .web3-grid {
        grid-template-columns: 1fr;
        gap: 1.5rem;
    }
    
    .stat-grid {
        grid-template-columns: 1fr;
    }
    
    .action-buttons {
        flex-direction: column;
    }
    
    .wallet-status {
        flex-direction: column;
        text-align: center;
        gap: 0.5rem;
    }
}

/* Loading Animation */
.loading-spinner {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    border-top-color: var(--web3-primary);
    animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* Tooltip */
.tooltip {
    position: relative;
    cursor: help;
}

.tooltip::after {
    content: attr(data-tooltip);
    position: absolute;
    bottom: 125%;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.9);
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    font-size: 0.8rem;
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s;
    z-index: 1000;
}

.tooltip:hover::after {
    opacity: 1;
}

/* Special Card Themes */
.blockchain-card {
    border-color: var(--web3-primary);
}

.nft-card {
    border-color: var(--web3-secondary);
}

.payment-card {
    border-color: var(--web3-accent);
}

.transparency-card {
    border-color: var(--web3-success);
}

.tools-card {
    border-color: var(--web3-warning);
}

.verification-card {
    border-color: var(--web3-danger);
}

/* Gradient text effects */
.gradient-text {
    background: linear-gradient(135deg, var(--web3-primary), var(--web3-secondary));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

/* Floating elements */
.floating {
    animation: float 6s ease-in-out infinite;
}

@keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
}
</style>
{% endblock %}

{% block content %}
<div class="web3-container">
    <!-- Hero Section -->
    <div class="web3-hero">
        <h1 class="web3-title">
            {% if current_lang == 'en' %}
                Web3 Transparency Platform
            {% else %}
                Web3é€æ˜åº¦å¹³å°
            {% endif %}
        </h1>
        <p class="web3-subtitle">
            {% if current_lang == 'en' %}
                Advanced blockchain verification, SLA NFT certificates, and crypto payment integration for mining transparency
            {% else %}
                å…ˆè¿›çš„åŒºå—é“¾éªŒè¯ã€SLA NFTè¯ä¹¦ä»¥åŠåŠ å¯†è´§å¸æ”¯ä»˜é›†æˆï¼Œä¸ºæŒ–çŸ¿é€æ˜åº¦æä¾›å…¨æ–¹ä½è§£å†³æ–¹æ¡ˆ
            {% endif %}
        </p>
        
        <!-- Wallet Connection Status -->
        <div class="wallet-status">
            <div class="wallet-indicator {{ 'connected' if wallet_address else 'disconnected' }}"></div>
            <div class="wallet-text">
                {% if wallet_address %}
                    {% if current_lang == 'en' %}Wallet Connected{% else %}é’±åŒ…å·²è¿æ¥{% endif %}
                    <div class="wallet-address">{{ wallet_address[:8] }}...{{ wallet_address[-6:] }}</div>
                {% else %}
                    {% if current_lang == 'en' %}Connect Wallet{% else %}è¿æ¥é’±åŒ…{% endif %}
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Dashboard Grid -->
    <div class="web3-grid">
        <!-- Blockchain Data Verification Panel -->
        <div class="web3-card blockchain-card">
            <div class="card-header">
                <h3 class="card-title">
                    {% if current_lang == 'en' %}Blockchain Verification{% else %}åŒºå—é“¾æ•°æ®éªŒè¯{% endif %}
                </h3>
                <div class="card-icon">ğŸ”—</div>
            </div>
            
            <div class="network-info">
                <div class="network-name">{{ blockchain_status.network }}</div>
                <div class="status-indicator {{ 'status-connected' if blockchain_status.connected else 'status-disconnected' }}">
                    {% if blockchain_status.connected %}
                        {% if current_lang == 'en' %}Connected{% else %}å·²è¿æ¥{% endif %}
                    {% else %}
                        {% if current_lang == 'en' %}Disconnected{% else %}æœªè¿æ¥{% endif %}
                    {% endif %}
                </div>
            </div>
            
            {% if blockchain_status.connected %}
            <div class="stat-grid">
                <div class="stat-item">
                    <span class="stat-value">{{ blockchain_status.block_number or 'N/A' }}</span>
                    <span class="stat-label">{% if current_lang == 'en' %}Block Height{% else %}åŒºå—é«˜åº¦{% endif %}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value">{{ transparency_stats.blockchain_verifications }}</span>
                    <span class="stat-label">{% if current_lang == 'en' %}Verifications{% else %}éªŒè¯æ¬¡æ•°{% endif %}</span>
                </div>
            </div>
            {% endif %}
            
            <div class="action-buttons">
                <a href="#" class="btn-web3" onclick="verifyMiningData()">
                    {% if current_lang == 'en' %}Verify Data{% else %}éªŒè¯æ•°æ®{% endif %}
                </a>
                <a href="#" class="btn-web3 btn-secondary" onclick="viewIPFSData()">
                    {% if current_lang == 'en' %}View IPFS{% else %}æŸ¥çœ‹IPFS{% endif %}
                </a>
            </div>
        </div>

        <!-- SLA NFT Certificate Management -->
        <div class="web3-card nft-card">
            <div class="card-header">
                <h3 class="card-title">
                    {% if current_lang == 'en' %}SLA NFT Certificates{% else %}SLA NFTè¯ä¹¦{% endif %}
                </h3>
                <div class="card-icon">ğŸ†</div>
            </div>
            
            <div class="stat-grid">
                <div class="stat-item">
                    <span class="stat-value">{{ sla_stats.total_certificates }}</span>
                    <span class="stat-label">{% if current_lang == 'en' %}Total Certificates{% else %}æ€»è¯ä¹¦æ•°{% endif %}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value">{{ sla_stats.verified_certificates }}</span>
                    <span class="stat-label">{% if current_lang == 'en' %}Verified{% else %}å·²éªŒè¯{% endif %}</span>
                </div>
            </div>
            
            {% if sla_stats.latest_score %}
            <div class="progress-container">
                <div class="progress-label">
                    <span>{% if current_lang == 'en' %}Latest SLA Score{% else %}æœ€æ–°SLAè¯„åˆ†{% endif %}</span>
                    <span>{{ "%.1f"|format(sla_stats.latest_score) }}%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: {{ sla_stats.latest_score }}%"></div>
                </div>
            </div>
            {% endif %}
            
            <div class="action-buttons">
                <a href="/api/sla/certificates" class="btn-web3">
                    {% if current_lang == 'en' %}View Certificates{% else %}æŸ¥çœ‹è¯ä¹¦{% endif %}
                </a>
                <a href="#" class="btn-web3 btn-secondary" onclick="mintNewCertificate()">
                    {% if current_lang == 'en' %}Mint New{% else %}é“¸é€ æ–°è¯ä¹¦{% endif %}
                </a>
            </div>
        </div>

        <!-- Crypto Payment Interface -->
        <div class="web3-card payment-card">
            <div class="card-header">
                <h3 class="card-title">
                    {% if current_lang == 'en' %}Crypto Payments{% else %}åŠ å¯†è´§å¸æ”¯ä»˜{% endif %}
                </h3>
                <div class="card-icon">ğŸ’°</div>
            </div>
            
            <div class="stat-grid">
                <div class="stat-item">
                    <span class="stat-value">{{ payment_stats.successful_payments }}</span>
                    <span class="stat-label">{% if current_lang == 'en' %}Successful{% else %}æˆåŠŸæ”¯ä»˜{% endif %}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value">{{ payment_stats.pending_payments }}</span>
                    <span class="stat-label">{% if current_lang == 'en' %}Pending{% else %}å¾…å¤„ç†{% endif %}</span>
                </div>
            </div>
            
            <div style="margin-top: 1rem;">
                <div style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;">
                    {% if current_lang == 'en' %}Supported Currencies:{% else %}æ”¯æŒçš„å¸ç§:{% endif %}
                </div>
                <div style="display: flex; gap: 0.5rem;">
                    {% for currency in payment_stats.supported_currencies %}
                    <span style="background: rgba(251, 191, 36, 0.2); color: var(--web3-accent); padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem; font-weight: 600;">{{ currency }}</span>
                    {% endfor %}
                </div>
            </div>
            
            <div class="action-buttons">
                <a href="#" class="btn-web3" onclick="createPayment()">
                    {% if current_lang == 'en' %}Create Payment{% else %}åˆ›å»ºæ”¯ä»˜{% endif %}
                </a>
                <a href="#" class="btn-web3 btn-secondary" onclick="viewPaymentHistory()">
                    {% if current_lang == 'en' %}Payment History{% else %}æ”¯ä»˜å†å²{% endif %}
                </a>
            </div>
        </div>

        <!-- Transparency Verification Center -->
        <div class="web3-card transparency-card">
            <div class="card-header">
                <h3 class="card-title">
                    {% if current_lang == 'en' %}Transparency Center{% else %}é€æ˜åº¦éªŒè¯ä¸­å¿ƒ{% endif %}
                </h3>
                <div class="card-icon">ğŸ”</div>
            </div>
            
            <div class="stat-grid">
                <div class="stat-item">
                    <span class="stat-value">{{ transparency_stats.ipfs_uploads }}</span>
                    <span class="stat-label">{% if current_lang == 'en' %}IPFS Uploads{% else %}IPFSä¸Šä¼ {% endif %}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value">{{ "%.1f"|format(transparency_stats.audit_score) }}</span>
                    <span class="stat-label">{% if current_lang == 'en' %}Audit Score{% else %}å®¡è®¡è¯„åˆ†{% endif %}</span>
                </div>
            </div>
            
            <div class="progress-container">
                <div class="progress-label">
                    <span>{% if current_lang == 'en' %}Trust Score{% else %}ä¿¡ä»»åº¦è¯„åˆ†{% endif %}</span>
                    <span>{{ "%.1f"|format(transparency_stats.audit_score) }}/100</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: {{ transparency_stats.audit_score }}%"></div>
                </div>
            </div>
            
            <div class="action-buttons">
                <a href="#" class="btn-web3" onclick="runAudit()">
                    {% if current_lang == 'en' %}Run Audit{% else %}æ‰§è¡Œå®¡è®¡{% endif %}
                </a>
                <a href="#" class="btn-web3 btn-secondary" onclick="viewAuditReports()">
                    {% if current_lang == 'en' %}View Reports{% else %}æŸ¥çœ‹æŠ¥å‘Š{% endif %}
                </a>
            </div>
        </div>

        <!-- Web3 Tools Integration -->
        <div class="web3-card tools-card">
            <div class="card-header">
                <h3 class="card-title">
                    {% if current_lang == 'en' %}Web3 Tools{% else %}Web3å·¥å…·é›†æˆ{% endif %}
                </h3>
                <div class="card-icon">ğŸ› ï¸</div>
            </div>
            
            <div class="network-info">
                <div class="network-name">MetaMask</div>
                <div class="status-indicator {{ 'status-connected' if wallet_address else 'status-disconnected' }}">
                    {% if wallet_address %}
                        {% if current_lang == 'en' %}Connected{% else %}å·²è¿æ¥{% endif %}
                    {% else %}
                        {% if current_lang == 'en' %}Disconnected{% else %}æœªè¿æ¥{% endif %}
                    {% endif %}
                </div>
            </div>
            
            <div style="margin-top: 1rem;">
                <div style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;">
                    {% if current_lang == 'en' %}Available Tools:{% else %}å¯ç”¨å·¥å…·:{% endif %}
                </div>
                <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 0.85rem; color: var(--text-primary);">{% if current_lang == 'en' %}Transaction History{% else %}äº¤æ˜“å†å²{% endif %}</span>
                        <span style="color: var(--web3-success); font-size: 0.8rem;">âœ“</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 0.85rem; color: var(--text-primary);">{% if current_lang == 'en' %}Network Monitor{% else %}ç½‘ç»œç›‘æ§{% endif %}</span>
                        <span style="color: var(--web3-success); font-size: 0.8rem;">âœ“</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 0.85rem; color: var(--text-primary);">{% if current_lang == 'en' %}Asset Viewer{% else %}èµ„äº§æŸ¥çœ‹å™¨{% endif %}</span>
                        <span style="color: var(--web3-success); font-size: 0.8rem;">âœ“</span>
                    </div>
                </div>
            </div>
            
            <div class="action-buttons">
                {% if not wallet_address %}
                <a href="#" class="btn-web3" onclick="connectWallet()">
                    {% if current_lang == 'en' %}Connect Wallet{% else %}è¿æ¥é’±åŒ…{% endif %}
                </a>
                {% else %}
                <a href="#" class="btn-web3" onclick="viewTransactionHistory()">
                    {% if current_lang == 'en' %}View Transactions{% else %}æŸ¥çœ‹äº¤æ˜“{% endif %}
                </a>
                {% endif %}
                <a href="#" class="btn-web3 btn-secondary" onclick="viewNetworkStatus()">
                    {% if current_lang == 'en' %}Network Status{% else %}ç½‘ç»œçŠ¶æ€{% endif %}
                </a>
            </div>
        </div>

        <!-- Live Market Data -->
        <div class="web3-card verification-card">
            <div class="card-header">
                <h3 class="card-title">
                    {% if current_lang == 'en' %}Market Data{% else %}å¸‚åœºæ•°æ®{% endif %}
                </h3>
                <div class="card-icon">ğŸ“Š</div>
            </div>
            
            <div class="stat-grid">
                <div class="stat-item">
                    <span class="stat-value">${{ "{:,}".format(btc_price) }}</span>
                    <span class="stat-label">BTC {% if current_lang == 'en' %}Price{% else %}ä»·æ ¼{% endif %}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value">{{ blockchain_status.network }}</span>
                    <span class="stat-label">{% if current_lang == 'en' %}Network{% else %}ç½‘ç»œ{% endif %}</span>
                </div>
            </div>
            
            {% if blockchain_status.connected and blockchain_status.gas_price %}
            <div style="margin-top: 1rem; padding: 1rem; background: rgba(255, 255, 255, 0.03); border-radius: 12px;">
                <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.5rem;">
                    {% if current_lang == 'en' %}Gas Price:{% else %}Gasä»·æ ¼:{% endif %}
                </div>
                <div style="font-family: 'JetBrains Mono', monospace; color: var(--web3-primary); font-weight: 600;">
                    {{ blockchain_status.gas_price }} Wei
                </div>
            </div>
            {% endif %}
            
            <div class="action-buttons">
                <a href="/calculator" class="btn-web3">
                    {% if current_lang == 'en' %}Mining Calculator{% else %}æŒ–çŸ¿è®¡ç®—å™¨{% endif %}
                </a>
                <a href="/analytics" class="btn-web3 btn-secondary">
                    {% if current_lang == 'en' %}Analytics{% else %}æ•°æ®åˆ†æ{% endif %}
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Loading Modal -->
<div id="loadingModal" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-sm modal-dialog-centered" role="document">
        <div class="modal-content" style="background: var(--card-bg); border: 1px solid var(--card-border); backdrop-filter: blur(20px);">
            <div class="modal-body text-center" style="padding: 2rem;">
                <div class="loading-spinner" style="margin-bottom: 1rem;"></div>
                <div style="color: var(--text-primary); font-weight: 600;">
                    {% if current_lang == 'en' %}Processing...{% else %}å¤„ç†ä¸­...{% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<!-- Web3 Utils Library -->
<script src="/static/js/web3_utils.js"></script>
<script>
// Web3 Dashboard JavaScript Functions

// MetaMask é’±åŒ…è¿æ¥
async function connectWallet() {
    if (typeof window.ethereum !== 'undefined') {
        try {
            showLoading();
            const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
            
            if (accounts.length > 0) {
                const walletAddress = accounts[0];
                
                // è·å–nonce
                const nonceResponse = await fetch('/api/wallet/nonce', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{ csrf_token }}'
                    },
                    body: JSON.stringify({ wallet_address: walletAddress })
                });
                
                const nonceData = await nonceResponse.json();
                
                if (nonceData.success) {
                    // ç­¾åæ¶ˆæ¯
                    const message = nonceData.message;
                    const signature = await window.ethereum.request({
                        method: 'personal_sign',
                        params: [message, walletAddress]
                    });
                    
                    // ç™»å½•éªŒè¯
                    const loginResponse = await fetch('/api/wallet/login', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}'
                        },
                        body: JSON.stringify({
                            wallet_address: walletAddress,
                            signature: signature,
                            nonce: nonceData.nonce
                        })
                    });
                    
                    const loginData = await loginResponse.json();
                    hideLoading();
                    
                    if (loginData.success) {
                        window.location.reload();
                    } else {
                        alert(loginData.error || 'Wallet login failed');
                    }
                } else {
                    hideLoading();
                    alert(nonceData.error || 'Failed to get nonce');
                }
            }
        } catch (error) {
            hideLoading();
            console.error('Wallet connection error:', error);
            alert('Failed to connect wallet: ' + error.message);
        }
    } else {
        const lang = '{{ current_lang }}';
        const message = lang === 'en' 
            ? `MetaMask Extension Required

To connect your wallet, please follow these steps:

1. Install MetaMask Extension
   - Chrome: Visit chrome.google.com/webstore and search for "MetaMask"
   - Firefox: Visit addons.mozilla.org and search for "MetaMask"
   - Or visit metamask.io directly

2. Create or Import Wallet
   - Follow the setup wizard
   - Securely store your recovery phrase

3. Connect to This App
   - Click "Connect Wallet" button again
   - Select your account in MetaMask
   - Approve the connection request

Need help? Visit: metamask.io/support`
            : `éœ€è¦å®‰è£… MetaMask é’±åŒ…æ‰©å±•

è¿æ¥é’±åŒ…éœ€è¦ä»¥ä¸‹æ­¥éª¤ï¼š

1. å®‰è£… MetaMask æ‰©å±•
   - Chrome: è®¿é—® chrome.google.com/webstore æœç´¢ "MetaMask"
   - Firefox: è®¿é—® addons.mozilla.org æœç´¢ "MetaMask"
   - æˆ–ç›´æ¥è®¿é—® metamask.io

2. åˆ›å»ºæˆ–å¯¼å…¥é’±åŒ…
   - æŒ‰ç…§è®¾ç½®å‘å¯¼æ“ä½œ
   - å®‰å…¨ä¿å­˜æ‚¨çš„æ¢å¤çŸ­è¯­

3. è¿æ¥åˆ°æœ¬åº”ç”¨
   - å†æ¬¡ç‚¹å‡»"è¿æ¥é’±åŒ…"æŒ‰é’®
   - åœ¨ MetaMask ä¸­é€‰æ‹©æ‚¨çš„è´¦æˆ·
   - æ‰¹å‡†è¿æ¥è¯·æ±‚

éœ€è¦å¸®åŠ©ï¼Ÿè®¿é—®: metamask.io/support`;
        
        if (confirm(message + '\n\n' + (lang === 'en' ? 'Open MetaMask website now?' : 'ç°åœ¨æ‰“å¼€ MetaMask å®˜ç½‘ï¼Ÿ'))) {
            window.open('https://metamask.io', '_blank');
        }
    }
}

// éªŒè¯æŒ–çŸ¿æ•°æ®
async function verifyMiningData() {
    showLoading();
    try {
        const response = await fetch('/api/blockchain/verify-data', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            }
        });
        
        const data = await response.json();
        hideLoading();
        
        if (data.success) {
            alert('{% if current_lang == "en" %}Data verification initiated successfully!{% else %}æ•°æ®éªŒè¯å·²æˆåŠŸå¯åŠ¨ï¼{% endif %}');
        } else {
            alert(data.error || '{% if current_lang == "en" %}Verification failed{% else %}éªŒè¯å¤±è´¥{% endif %}');
        }
    } catch (error) {
        hideLoading();
        console.error('Verification error:', error);
        alert('{% if current_lang == "en" %}Verification error{% else %}éªŒè¯é”™è¯¯{% endif %}');
    }
}

// æŸ¥çœ‹IPFSæ•°æ®
function viewIPFSData() {
    window.open('/api/ipfs/browser', '_blank');
}

// é“¸é€ æ–°çš„SLA NFTè¯ä¹¦
async function mintNewCertificate() {
    showLoading();
    try {
        const response = await fetch('/api/sla/mint-certificate', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            }
        });
        
        const data = await response.json();
        hideLoading();
        
        if (data.success) {
            alert('{% if current_lang == "en" %}Certificate minting initiated!{% else %}è¯ä¹¦é“¸é€ å·²å¯åŠ¨ï¼{% endif %}');
            setTimeout(() => window.location.reload(), 2000);
        } else {
            alert(data.error || '{% if current_lang == "en" %}Minting failed{% else %}é“¸é€ å¤±è´¥{% endif %}');
        }
    } catch (error) {
        hideLoading();
        console.error('Minting error:', error);
        alert('{% if current_lang == "en" %}Minting error{% else %}é“¸é€ é”™è¯¯{% endif %}');
    }
}

// åˆ›å»ºåŠ å¯†è´§å¸æ”¯ä»˜
function createPayment() {
    window.location.href = '/billing/payment-options';
}

// æŸ¥çœ‹æ”¯ä»˜å†å²
function viewPaymentHistory() {
    window.location.href = '/billing/payment-history';
}

// è¿è¡Œé€æ˜åº¦å®¡è®¡
async function runAudit() {
    showLoading();
    try {
        const response = await fetch('/api/transparency/audit', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            }
        });
        
        const data = await response.json();
        hideLoading();
        
        if (data.success) {
            alert('{% if current_lang == "en" %}Audit initiated successfully!{% else %}å®¡è®¡å·²æˆåŠŸå¯åŠ¨ï¼{% endif %}');
        } else {
            alert(data.error || '{% if current_lang == "en" %}Audit failed{% else %}å®¡è®¡å¤±è´¥{% endif %}');
        }
    } catch (error) {
        hideLoading();
        console.error('Audit error:', error);
        alert('{% if current_lang == "en" %}Audit error{% else %}å®¡è®¡é”™è¯¯{% endif %}');
    }
}

// æŸ¥çœ‹å®¡è®¡æŠ¥å‘Š
function viewAuditReports() {
    window.location.href = '/api/sla/reports';
}

// æŸ¥çœ‹äº¤æ˜“å†å²
function viewTransactionHistory() {
    if (window.ethereum) {
        window.open('https://etherscan.io/address/' + '{{ wallet_address }}', '_blank');
    }
}

// æŸ¥çœ‹ç½‘ç»œçŠ¶æ€
function viewNetworkStatus() {
    window.location.href = '/network-history';
}

// æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
function showLoading() {
    const modalElement = document.getElementById('loadingModal');
    const modal = bootstrap.Modal.getOrCreateInstance(modalElement);
    modal.show();
}

// éšè—åŠ è½½åŠ¨ç”»
function hideLoading() {
    const modalElement = document.getElementById('loadingModal');
    const modal = bootstrap.Modal.getOrCreateInstance(modalElement);
    modal.hide();
}

// åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
    // æ·»åŠ æµ®åŠ¨åŠ¨ç”»
    const cards = document.querySelectorAll('.web3-card');
    cards.forEach((card, index) => {
        card.style.animationDelay = `${index * 0.1}s`;
        card.classList.add('floating');
    });
    
    // æ£€æŸ¥MetaMaskè¿æ¥çŠ¶æ€
    if (typeof window.ethereum !== 'undefined') {
        window.ethereum.on('accountsChanged', function (accounts) {
            if (accounts.length === 0) {
                // ç”¨æˆ·æ–­å¼€äº†è¿æ¥
                window.location.reload();
            }
        });
        
        window.ethereum.on('chainChanged', function (chainId) {
            // ç½‘ç»œåˆ‡æ¢
            window.location.reload();
        });
    }
});
</script>
{% endblock %}