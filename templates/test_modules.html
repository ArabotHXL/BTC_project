<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨¡å—æ¶æ„æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            background: #1a1a1a;
            color: #fff;
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        .test-section {
            background: #2a2a2a;
            border: 1px solid #3a3a3a;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .success { color: #4CAF50; }
        .error { color: #F44336; }
        button {
            background: #FFD700;
            color: #1a1a1a;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background: #FFA500;
        }
        .result {
            background: #1a1a1a;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <h1>ğŸš€ æ¨¡å—åŒ–æ¶æ„åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>ğŸ“Š æ¨¡å—ç®¡ç†ä¸­å¿ƒ</h2>
        <p>æµ‹è¯•æ¨¡å—ç®¡ç†ç•Œé¢å’ŒAPI</p>
        <button onclick="testModules()">æµ‹è¯•æ¨¡å—åˆ—è¡¨</button>
        <button onclick="window.open('/modules', '_blank')">æ‰“å¼€æ¨¡å—ä¸­å¿ƒ</button>
        <div id="modules-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ”§ çƒ­åŠ›å›¾åŠŸèƒ½</h2>
        <p>æµ‹è¯•çŸ¿æœºçƒ­åŠ›å›¾æ•°æ®ç”Ÿæˆ</p>
        <button onclick="testHeatmap()">æµ‹è¯•çƒ­åŠ›å›¾</button>
        <div id="heatmap-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ’¾ æ•°æ®åº“è¿æ¥</h2>
        <p>æµ‹è¯•æ¨¡å—é—´æ•°æ®å…±äº«</p>
        <button onclick="testDatabase()">æµ‹è¯•æ•°æ®è¿æ¥</button>
        <div id="database-result" class="result"></div>
    </div>

    <script>
        async function testModules() {
            const resultDiv = document.getElementById('modules-result');
            try {
                const response = await fetch('/api/modules/status');
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <span class="success">âœ… æ¨¡å—APIæ­£å¸¸</span><br>
                        æ€»æ¨¡å—æ•°: ${data.total}<br>
                        å¯ç”¨æ¨¡å—: ${data.modules.filter(m => m.enabled).length}<br>
                        æ¨¡å—åˆ—è¡¨: ${data.modules.map(m => m.name).join(', ')}
                    `;
                } else {
                    resultDiv.innerHTML = `<span class="error">âŒ æ¨¡å—APIé”™è¯¯: ${data.error}</span>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">âŒ ç½‘ç»œé”™è¯¯: ${error.message}</span>`;
            }
        }

        async function testHeatmap() {
            const resultDiv = document.getElementById('heatmap-result');
            try {
                const formData = new FormData();
                formData.append('miner_model', 'Antminer S19 XP (134T)');
                formData.append('miner_count', '1');
                formData.append('client_electricity_cost', '0.06');

                const response = await fetch('/profit_chart_data', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <span class="success">âœ… çƒ­åŠ›å›¾æ•°æ®ç”ŸæˆæˆåŠŸ</span><br>
                        æ•°æ®ç‚¹æ•°é‡: ${data.profit_data ? data.profit_data.length : 0}<br>
                        çŸ¿æœºå‹å·: ${data.miner_model || 'N/A'}<br>
                        æ•°æ®åº“è¿æ¥: æ­£å¸¸
                    `;
                } else {
                    resultDiv.innerHTML = `<span class="error">âŒ çƒ­åŠ›å›¾ç”Ÿæˆå¤±è´¥: ${data.error}</span>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">âŒ ç½‘ç»œé”™è¯¯: ${error.message}</span>`;
            }
        }

        async function testDatabase() {
            const resultDiv = document.getElementById('database-result');
            try {
                const response = await fetch('/network_stats');
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <span class="success">âœ… æ•°æ®åº“è¿æ¥æ­£å¸¸</span><br>
                        BTCä»·æ ¼: $${data.btc_price?.toLocaleString()}<br>
                        ç½‘ç»œç®—åŠ›: ${data.network_hashrate} EH/s<br>
                        æ•°æ®æ—¶é—´: ${new Date().toLocaleString()}
                    `;
                } else {
                    resultDiv.innerHTML = `<span class="error">âŒ æ•°æ®åº“è¿æ¥å¤±è´¥</span>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">âŒ ç½‘ç»œé”™è¯¯: ${error.message}</span>`;
            }
        }

        // è‡ªåŠ¨è¿è¡Œåˆå§‹æµ‹è¯•
        window.onload = function() {
            testModules();
        };
    </script>
</body>
</html>