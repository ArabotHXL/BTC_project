{% extends "base.html" %}

{% block title %}
    System Relationship Diagram / ç³»ç»Ÿå…³ç³»å›¾ - BTC Mining Calculator
{% endblock %}

{% block header_title %}
    System Relationships / ç³»ç»Ÿå…³ç³»å›¾
{% endblock %}

{% block extra_css %}
<style>
body {
    background: linear-gradient(135deg, #0a0f1c 0%, #1a1a2e 25%, #16213e 50%, #0f3460 75%, #0a0f1c 100%);
    background-attachment: fixed;
    color: #f8f9fa;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    overflow-x: auto;
}

.diagram-container {
    max-width: 1600px;
    margin: 2rem auto;
    padding: 2rem;
}

.relationship-card {
    background: rgba(26, 26, 46, 0.95);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 193, 7, 0.2);
    border-radius: 24px;
    padding: 2rem;
    margin-bottom: 2rem;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.diagram-title {
    color: #ffc107;
    font-size: 2rem;
    font-weight: 700;
    text-align: center;
    margin-bottom: 2rem;
    text-shadow: 0 0 20px rgba(255, 193, 7, 0.3);
}

/* System Relationship SVG Container */
.relationship-svg-container {
    position: relative;
    width: 100%;
    min-height: auto;
    background: radial-gradient(ellipse at center, rgba(255, 193, 7, 0.03) 0%, transparent 70%);
    border-radius: 16px;
    overflow: visible;
    padding: 2rem;
}

.system-node {
    background: linear-gradient(135deg, rgba(255, 193, 7, 0.15), rgba(108, 92, 231, 0.15));
    border: 2px solid rgba(255, 193, 7, 0.4);
    border-radius: 16px;
    padding: 1.5rem;
    min-width: 180px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
    height: 140px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

.system-node:hover {
    transform: scale(1.05);
    border-color: #ffc107;
    background: linear-gradient(135deg, rgba(255, 193, 7, 0.25), rgba(108, 92, 231, 0.25));
    box-shadow: 0 15px 40px rgba(255, 193, 7, 0.3);
    z-index: 10;
}

.node-icon {
    font-size: 2.5rem;
    margin-bottom: 0.5rem;
    display: block;
}

.node-title {
    font-weight: 700;
    color: #ffc107;
    font-size: 1rem;
    margin-bottom: 0.5rem;
}

.node-description {
    font-size: 0.8rem;
    color: #adb5bd;
    line-height: 1.3;
}

/* Connection Lines */
.connection-line {
    position: absolute;
    background: linear-gradient(90deg, #ffc107, #e67e22);
    height: 2px;
    z-index: 1;
    transform-origin: left center;
    opacity: 0.7;
    transition: opacity 0.3s ease;
}

.connection-line::after {
    content: 'â–¶';
    position: absolute;
    right: -8px;
    top: -8px;
    color: #ffc107;
    font-size: 0.8rem;
}

.connection-line.animated::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.6), transparent);
    animation: flow 3s linear infinite;
}

@keyframes flow {
    to { left: 100%; }
}

/* Layer-based Grid Positioning */
.layer-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 2rem;
    margin-bottom: 3rem;
    padding: 1rem;
}

.layer-grid.frontend-layer {
    grid-template-columns: repeat(4, 1fr);
}

.layer-grid.application-layer {
    grid-template-columns: repeat(5, 1fr);
}

.layer-grid.data-layer {
    grid-template-columns: repeat(4, 1fr);
}

.layer-grid.external-layer {
    grid-template-columns: repeat(5, 1fr);
}

.layer-grid.services-layer {
    grid-template-columns: repeat(2, 1fr);
    max-width: 800px;
    margin: 0 auto 3rem;
}

/* Remove absolute positioning for grid layout */
.system-node {
    position: relative;
    margin: 0;
}

/* Remove connection lines for cleaner layout */

/* Module Detail Panels */
.module-details {
    display: none;
    position: absolute;
    background: rgba(0, 0, 0, 0.95);
    border: 2px solid #ffc107;
    border-radius: 12px;
    padding: 1.5rem;
    max-width: 400px;
    z-index: 100;
    backdrop-filter: blur(20px);
}

.module-details.show {
    display: block;
}

.detail-title {
    color: #ffc107;
    font-weight: 700;
    margin-bottom: 1rem;
    font-size: 1.1rem;
}

.detail-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.detail-list li {
    color: #adb5bd;
    padding: 0.3rem 0;
    border-bottom: 1px solid rgba(255, 193, 7, 0.1);
    font-size: 0.9rem;
}

.detail-list li:last-child {
    border-bottom: none;
}

/* Language Toggle */
.lang-toggle {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1000;
}

.lang-btn {
    background: linear-gradient(135deg, #ffc107, #e67e22);
    border: none;
    border-radius: 20px;
    padding: 0.5rem 1rem;
    color: #000;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.lang-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 5px 20px rgba(255, 193, 7, 0.4);
}

/* Legend */
.legend {
    position: absolute;
    bottom: 20px;
    right: 20px;
    background: rgba(0, 0, 0, 0.8);
    border: 1px solid rgba(255, 193, 7, 0.3);
    border-radius: 8px;
    padding: 1rem;
    font-size: 0.8rem;
}

.legend-item {
    display: flex;
    align-items: center;
    margin-bottom: 0.5rem;
    color: #adb5bd;
}

.legend-color {
    width: 20px;
    height: 3px;
    margin-right: 0.5rem;
    border-radius: 2px;
}

.legend-frontend { background: linear-gradient(90deg, #17a2b8, #6f42c1); }
.legend-backend { background: linear-gradient(90deg, #ffc107, #e67e22); }
.legend-data { background: linear-gradient(90deg, #28a745, #20c997); }
.legend-external { background: linear-gradient(90deg, #dc3545, #fd7e14); }

/* Responsive Design */
@media (max-width: 1200px) {
    .relationship-svg-container {
        transform: scale(0.8);
        transform-origin: top left;
        min-height: 720px;
    }
}

@media (max-width: 768px) {
    .relationship-svg-container {
        transform: scale(0.6);
        transform-origin: top left;
        min-height: 540px;
    }
    
    .system-node {
        min-width: 140px;
        padding: 1rem;
    }
    
    .node-icon {
        font-size: 2rem;
    }
    
    .node-title {
        font-size: 0.9rem;
    }
    
    .node-description {
        font-size: 0.7rem;
    }
}

/* Hover Effects for Connections */
.system-node:hover ~ .connection-line {
    opacity: 1;
    box-shadow: 0 0 10px rgba(255, 193, 7, 0.5);
}

/* Pulse Animation for Important Nodes */
@keyframes pulse {
    0%, 100% { 
        box-shadow: 0 0 0 0 rgba(255, 193, 7, 0.7);
    }
    70% { 
        box-shadow: 0 0 0 10px rgba(255, 193, 7, 0);
    }
}

.system-node.important {
    animation: pulse 2s infinite;
}
</style>
{% endblock %}

{% block content %}
<div class="diagram-container">
    <!-- Language Toggle -->
    <div class="lang-toggle">
        <button class="lang-btn" onclick="toggleLanguage()">
            <span class="en-text">ä¸­æ–‡</span>
            <span class="zh-text" style="display:none;">English</span>
        </button>
    </div>

    <!-- Main Title -->
    <div class="relationship-card">
        <h1 class="diagram-title">
            <span class="en-text">System Relationship Diagram</span>
            <span class="zh-text" style="display:none;">ç³»ç»Ÿå…³ç³»å›¾</span>
        </h1>
        
        <!-- System Relationship Diagram -->
        <div class="relationship-svg-container" id="relationshipDiagram">
            
            <!-- Layer Headers -->
            <div style="margin-bottom: 2rem;">
                <h3 style="color: #17a2b8; text-align: center; margin-bottom: 1rem;">
                    <span class="en-text">ğŸ¨ Frontend Layer</span>
                    <span class="zh-text" style="display:none;">ğŸ¨ å‰ç«¯å±‚</span>
                </h3>
                <div class="layer-grid frontend-layer">
                    <div class="system-node" data-module="frontend">
                        <span class="node-icon">ğŸ¨</span>
                        <div class="node-title">
                            <span class="en-text">Frontend UI</span>
                            <span class="zh-text" style="display:none;">å‰ç«¯ç•Œé¢</span>
                        </div>
                        <div class="node-description">
                            <span class="en-text">Bootstrap 5, Jinja2</span>
                            <span class="zh-text" style="display:none;">Bootstrap 5, Jinja2</span>
                        </div>
                    </div>

                    <div class="system-node" data-module="auth">
                        <span class="node-icon">ğŸ”</span>
                        <div class="node-title">
                            <span class="en-text">Authentication</span>
                            <span class="zh-text" style="display:none;">èº«ä»½è®¤è¯</span>
                        </div>
                        <div class="node-description">
                            <span class="en-text">RBAC, Sessions</span>
                            <span class="zh-text" style="display:none;">è§’è‰²æ§åˆ¶, ä¼šè¯</span>
                        </div>
                    </div>

                    <div class="system-node" data-module="language">
                        <span class="node-icon">ğŸŒ</span>
                        <div class="node-title">
                            <span class="en-text">Language Engine</span>
                            <span class="zh-text" style="display:none;">è¯­è¨€å¼•æ“</span>
                        </div>
                        <div class="node-description">
                            <span class="en-text">i18n, EN/ZH</span>
                            <span class="zh-text" style="display:none;">å›½é™…åŒ–, ä¸­è‹±æ–‡</span>
                        </div>
                    </div>

                    <div class="system-node" data-module="templates">
                        <span class="node-icon">ğŸ“„</span>
                        <div class="node-title">
                            <span class="en-text">Templates</span>
                            <span class="zh-text" style="display:none;">æ¨¡æ¿ç³»ç»Ÿ</span>
                        </div>
                        <div class="node-description">
                            <span class="en-text">Dynamic Rendering</span>
                            <span class="zh-text" style="display:none;">åŠ¨æ€æ¸²æŸ“</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Flow Arrow -->
            <div style="text-align: center; margin: 2rem 0;">
                <div style="font-size: 2rem; color: #ffc107;">â¬‡ï¸</div>
                <div style="color: #adb5bd; font-size: 0.9rem;">
                    <span class="en-text">Data Flow</span>
                    <span class="zh-text" style="display:none;">æ•°æ®æµ</span>
                </div>
            </div>

            <div style="margin-bottom: 2rem;">
                <h3 style="color: #ffc107; text-align: center; margin-bottom: 1rem;">
                    <span class="en-text">ğŸš€ Application Layer</span>
                    <span class="zh-text" style="display:none;">ğŸš€ åº”ç”¨å±‚</span>
                </h3>
                <div class="layer-grid application-layer">
                    <div class="system-node important" data-module="mining">
                        <span class="node-icon">â›ï¸</span>
                        <div class="node-title">
                            <span class="en-text">Mining Calculator</span>
                            <span class="zh-text" style="display:none;">æŒ–çŸ¿è®¡ç®—å™¨</span>
                        </div>
                        <div class="node-description">
                            <span class="en-text">Dual Algorithm</span>
                            <span class="zh-text" style="display:none;">åŒç®—æ³•ç³»ç»Ÿ</span>
                        </div>
                    </div>

                    <div class="system-node important" data-module="treasury">
                        <span class="node-icon">ğŸ’¼</span>
                        <div class="node-title">
                            <span class="en-text">Treasury Mgmt</span>
                            <span class="zh-text" style="display:none;">èµ„é‡‘ç®¡ç†</span>
                        </div>
                        <div class="node-description">
                            <span class="en-text">HashInsight</span>
                            <span class="zh-text" style="display:none;">HashInsight</span>
                        </div>
                    </div>

                    <div class="system-node important" data-module="algorithm">
                        <span class="node-icon">ğŸ¤–</span>
                        <div class="node-title">
                            <span class="en-text">Algorithm Engine</span>
                            <span class="zh-text" style="display:none;">ç®—æ³•å¼•æ“</span>
                        </div>
                        <div class="node-description">
                            <span class="en-text">10 Modules (A-J)</span>
                            <span class="zh-text" style="display:none;">10ä¸ªæ¨¡å— (A-J)</span>
                        </div>
                    </div>

                    <div class="system-node" data-module="analytics">
                        <span class="node-icon">ğŸ“ˆ</span>
                        <div class="node-title">
                            <span class="en-text">Analytics Engine</span>
                            <span class="zh-text" style="display:none;">åˆ†æå¼•æ“</span>
                        </div>
                        <div class="node-description">
                            <span class="en-text">Real-time Data</span>
                            <span class="zh-text" style="display:none;">å®æ—¶æ•°æ®</span>
                        </div>
                    </div>

                    <div class="system-node" data-module="crm">
                        <span class="node-icon">ğŸ‘¥</span>
                        <div class="node-title">
                            <span class="en-text">CRM System</span>
                            <span class="zh-text" style="display:none;">å®¢æˆ·ç®¡ç†</span>
                        </div>
                        <div class="node-description">
                            <span class="en-text">Customer Lifecycle</span>
                            <span class="zh-text" style="display:none;">å®¢æˆ·ç”Ÿå‘½å‘¨æœŸ</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Flow Arrow -->
            <div style="text-align: center; margin: 2rem 0;">
                <div style="font-size: 2rem; color: #ffc107;">â¬‡ï¸</div>
                <div style="color: #adb5bd; font-size: 0.9rem;">
                    <span class="en-text">Data Processing</span>
                    <span class="zh-text" style="display:none;">æ•°æ®å¤„ç†</span>
                </div>
            </div>

            <div style="margin-bottom: 2rem;">
                <h3 style="color: #28a745; text-align: center; margin-bottom: 1rem;">
                    <span class="en-text">ğŸ’¾ Data & Integration Layer</span>
                    <span class="zh-text" style="display:none;">ğŸ’¾ æ•°æ®ä¸é›†æˆå±‚</span>
                </h3>
                <div class="layer-grid data-layer">
                    <div class="system-node important" data-module="database">
                        <span class="node-icon">ğŸ—„ï¸</span>
                        <div class="node-title">
                            <span class="en-text">PostgreSQL</span>
                            <span class="zh-text" style="display:none;">PostgreSQL</span>
                        </div>
                        <div class="node-description">
                            <span class="en-text">Primary Database</span>
                            <span class="zh-text" style="display:none;">ä¸»æ•°æ®åº“</span>
                        </div>
                    </div>

                    <div class="system-node" data-module="cache">
                        <span class="node-icon">âš¡</span>
                        <div class="node-title">
                            <span class="en-text">Cache System</span>
                            <span class="zh-text" style="display:none;">ç¼“å­˜ç³»ç»Ÿ</span>
                        </div>
                        <div class="node-description">
                            <span class="en-text">In-Memory</span>
                            <span class="zh-text" style="display:none;">å†…å­˜ç¼“å­˜</span>
                        </div>
                    </div>

                    <div class="system-node" data-module="apis">
                        <span class="node-icon">ğŸ”„</span>
                        <div class="node-title">
                            <span class="en-text">API Gateway</span>
                            <span class="zh-text" style="display:none;">APIç½‘å…³</span>
                        </div>
                        <div class="node-description">
                            <span class="en-text">External Integration</span>
                            <span class="zh-text" style="display:none;">å¤–éƒ¨é›†æˆ</span>
                        </div>
                    </div>

                    <div class="system-node" data-module="scheduler">
                        <span class="node-icon">â°</span>
                        <div class="node-title">
                            <span class="en-text">Task Scheduler</span>
                            <span class="zh-text" style="display:none;">ä»»åŠ¡è°ƒåº¦</span>
                        </div>
                        <div class="node-description">
                            <span class="en-text">Automation</span>
                            <span class="zh-text" style="display:none;">è‡ªåŠ¨åŒ–</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Flow Arrow -->
            <div style="text-align: center; margin: 2rem 0;">
                <div style="font-size: 2rem; color: #ffc107;">â¬‡ï¸</div>
                <div style="color: #adb5bd; font-size: 0.9rem;">
                    <span class="en-text">External APIs</span>
                    <span class="zh-text" style="display:none;">å¤–éƒ¨API</span>
                </div>
            </div>

            <div style="margin-bottom: 2rem;">
                <h3 style="color: #dc3545; text-align: center; margin-bottom: 1rem;">
                    <span class="en-text">ğŸŒ External Services</span>
                    <span class="zh-text" style="display:none;">ğŸŒ å¤–éƒ¨æœåŠ¡</span>
                </h3>
                <div class="layer-grid external-layer">
                    <div class="system-node" data-module="coinwarz">
                        <span class="node-icon">ğŸ”—</span>
                        <div class="node-title">
                            <span class="en-text">CoinWarz API</span>
                            <span class="zh-text" style="display:none;">CoinWarz API</span>
                        </div>
                        <div class="node-description">
                            <span class="en-text">Mining Data</span>
                            <span class="zh-text" style="display:none;">æŒ–çŸ¿æ•°æ®</span>
                        </div>
                    </div>

                    <div class="system-node" data-module="coingecko">
                        <span class="node-icon">ğŸ¦</span>
                        <div class="node-title">
                            <span class="en-text">CoinGecko API</span>
                            <span class="zh-text" style="display:none;">CoinGecko API</span>
                        </div>
                        <div class="node-description">
                            <span class="en-text">Price Data</span>
                            <span class="zh-text" style="display:none;">ä»·æ ¼æ•°æ®</span>
                        </div>
                    </div>

                    <div class="system-node" data-module="blockchain">
                        <span class="node-icon">â›“ï¸</span>
                        <div class="node-title">
                            <span class="en-text">Blockchain.info</span>
                            <span class="zh-text" style="display:none;">Blockchain.info</span>
                        </div>
                        <div class="node-description">
                            <span class="en-text">Network Stats</span>
                            <span class="zh-text" style="display:none;">ç½‘ç»œç»Ÿè®¡</span>
                        </div>
                    </div>

                    <div class="system-node" data-module="rpc">
                        <span class="node-icon">ğŸŒ</span>
                        <div class="node-title">
                            <span class="en-text">Bitcoin RPC</span>
                            <span class="zh-text" style="display:none;">Bitcoin RPC</span>
                        </div>
                        <div class="node-description">
                            <span class="en-text">Real-time Data</span>
                            <span class="zh-text" style="display:none;">å®æ—¶æ•°æ®</span>
                        </div>
                    </div>

                    <div class="system-node" data-module="monitoring">
                        <span class="node-icon">ğŸ“Š</span>
                        <div class="node-title">
                            <span class="en-text">Performance Monitor</span>
                            <span class="zh-text" style="display:none;">æ€§èƒ½ç›‘æ§</span>
                        </div>
                        <div class="node-description">
                            <span class="en-text">System Health</span>
                            <span class="zh-text" style="display:none;">ç³»ç»Ÿå¥åº·</span>
                        </div>
                    </div>
                </div>
            </div>

            <div style="margin-bottom: 2rem;">
                <h3 style="color: #fd7e14; text-align: center; margin-bottom: 1rem;">
                    <span class="en-text">ğŸ› ï¸ Support Services</span>
                    <span class="zh-text" style="display:none;">ğŸ› ï¸ æ”¯æŒæœåŠ¡</span>
                </h3>
                <div class="layer-grid services-layer">
                    <div class="system-node" data-module="gmail">
                        <span class="node-icon">ğŸ“§</span>
                        <div class="node-title">
                            <span class="en-text">Gmail SMTP</span>
                            <span class="zh-text" style="display:none;">Gmail SMTP</span>
                        </div>
                        <div class="node-description">
                            <span class="en-text">Email Service</span>
                            <span class="zh-text" style="display:none;">é‚®ä»¶æœåŠ¡</span>
                        </div>
                    </div>

                    <div class="system-node" data-module="security">
                        <span class="node-icon">ğŸ›¡ï¸</span>
                        <div class="node-title">
                            <span class="en-text">Security</span>
                            <span class="zh-text" style="display:none;">å®‰å…¨</span>
                        </div>
                        <div class="node-description">
                            <span class="en-text">Encryption & Auth</span>
                            <span class="zh-text" style="display:none;">åŠ å¯†ä¸è®¤è¯</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Legend -->
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color legend-frontend"></div>
                    <span class="en-text">Frontend Layer</span>
                    <span class="zh-text" style="display:none;">å‰ç«¯å±‚</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color legend-backend"></div>
                    <span class="en-text">Application Layer</span>
                    <span class="zh-text" style="display:none;">åº”ç”¨å±‚</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color legend-data"></div>
                    <span class="en-text">Data Layer</span>
                    <span class="zh-text" style="display:none;">æ•°æ®å±‚</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color legend-external"></div>
                    <span class="en-text">External Services</span>
                    <span class="zh-text" style="display:none;">å¤–éƒ¨æœåŠ¡</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Module Details Panels -->
    <div id="moduleDetails" class="module-details">
        <div class="detail-title" id="detailTitle"></div>
        <ul class="detail-list" id="detailList"></ul>
    </div>
</div>

<script>
// Language Toggle Function
function toggleLanguage() {
    const enElements = document.querySelectorAll('.en-text');
    const zhElements = document.querySelectorAll('.zh-text');
    
    enElements.forEach(el => {
        el.style.display = el.style.display === 'none' ? 'inline' : 'none';
    });
    
    zhElements.forEach(el => {
        el.style.display = el.style.display === 'none' ? 'inline' : 'none';
    });
}

// Module Details Data
const moduleDetails = {
    'frontend': {
        'en': {
            title: 'Frontend UI Components',
            items: [
                'Bootstrap 5 Framework',
                'Jinja2 Template Engine',
                'Chart.js for Data Visualization',
                'Responsive Design (Mobile-First)',
                'Glass Morphism Effects',
                'Dark Theme with Gold Accents',
                'Interactive Dashboard',
                'Real-time Data Updates'
            ]
        },
        'zh': {
            title: 'å‰ç«¯ç•Œé¢ç»„ä»¶',
            items: [
                'Bootstrap 5 æ¡†æ¶',
                'Jinja2 æ¨¡æ¿å¼•æ“',
                'Chart.js æ•°æ®å¯è§†åŒ–',
                'å“åº”å¼è®¾è®¡ï¼ˆç§»åŠ¨ä¼˜å…ˆï¼‰',
                'ç»ç’ƒæ€æ•ˆæœ',
                'æ·±è‰²ä¸»é¢˜é…é‡‘è‰²ç‚¹ç¼€',
                'äº¤äº’å¼ä»ªè¡¨æ¿',
                'å®æ—¶æ•°æ®æ›´æ–°'
            ]
        }
    },
    'auth': {
        'en': {
            title: 'Authentication System',
            items: [
                'Email-based Authentication',
                'Role-based Access Control (RBAC)',
                'Session Management',
                'Password Hashing (Werkzeug)',
                'Login Security',
                'User Registration',
                'Email Verification',
                'Permission Matrix'
            ]
        },
        'zh': {
            title: 'èº«ä»½è®¤è¯ç³»ç»Ÿ',
            items: [
                'åŸºäºé‚®ç®±çš„è®¤è¯',
                'åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶',
                'ä¼šè¯ç®¡ç†',
                'å¯†ç å“ˆå¸Œï¼ˆWerkzeugï¼‰',
                'ç™»å½•å®‰å…¨',
                'ç”¨æˆ·æ³¨å†Œ',
                'é‚®ç®±éªŒè¯',
                'æƒé™çŸ©é˜µ'
            ]
        }
    },
    'mining': {
        'en': {
            title: 'Mining Calculator Engine',
            items: [
                'Dual Algorithm Validation',
                '42+ ASIC Miner Models',
                'Real-time Profitability Calculation',
                'ROI Analysis',
                'Power Curtailment Analysis',
                'Hashrate Decay Modeling',
                'Batch Processing Support',
                'Historical Performance Tracking'
            ]
        },
        'zh': {
            title: 'æŒ–çŸ¿è®¡ç®—å¼•æ“',
            items: [
                'åŒç®—æ³•éªŒè¯',
                '42+ ASICçŸ¿æœºå‹å·',
                'å®æ—¶ç›ˆåˆ©èƒ½åŠ›è®¡ç®—',
                'ROIåˆ†æ',
                'åŠŸç‡å‰Šå‡åˆ†æ',
                'ç®—åŠ›è¡°å‡å»ºæ¨¡',
                'æ‰¹é‡å¤„ç†æ”¯æŒ',
                'å†å²æ€§èƒ½è·Ÿè¸ª'
            ]
        }
    },
    'treasury': {
        'en': {
            title: 'Treasury Management (HashInsight)',
            items: [
                'BTC Inventory Tracking',
                'Cost Basis Management',
                'Cash Coverage Analysis',
                'Selling Strategy Templates',
                'Signal Aggregation',
                'Execution Planning',
                'Risk Management',
                'Portfolio Optimization'
            ]
        },
        'zh': {
            title: 'èµ„é‡‘ç®¡ç† (HashInsight)',
            items: [
                'BTCåº“å­˜è·Ÿè¸ª',
                'æˆæœ¬åŸºç¡€ç®¡ç†',
                'ç°é‡‘è¦†ç›–åˆ†æ',
                'é”€å”®ç­–ç•¥æ¨¡æ¿',
                'ä¿¡å·èšåˆ',
                'æ‰§è¡Œè§„åˆ’',
                'é£é™©ç®¡ç†',
                'æŠ•èµ„ç»„åˆä¼˜åŒ–'
            ]
        }
    },
    'algorithm': {
        'en': {
            title: 'Advanced Algorithm Engine (10 Modules)',
            items: [
                'A. Regime-Aware Adaptation',
                'B. Breakout Exhaustion Detection',
                'C. Support/Resistance Confluence',
                'D. Adaptive ATR Layering',
                'E. Miner Cycle Analysis',
                'F. Pattern Target Recognition',
                'G. Derivatives Pressure Monitoring',
                'H. Microstructure Execution',
                'I. Bandit-Sizing Allocation',
                'J. Ensemble Aggregation Scoring'
            ]
        },
        'zh': {
            title: 'é«˜çº§ç®—æ³•å¼•æ“ï¼ˆ10ä¸ªæ¨¡å—ï¼‰',
            items: [
                'A. è¶‹åŠ¿æ„ŸçŸ¥è‡ªé€‚åº”',
                'B. çªç ´è¡°ç«­æ£€æµ‹',
                'C. æ”¯æ’‘é˜»åŠ›å…±æŒ¯',
                'D. ATRåŠ¨æ€åˆ†å±‚',
                'E. æŒ–çŸ¿å‘¨æœŸåˆ†æ',
                'F. å½¢æ€ç›®æ ‡è¯†åˆ«',
                'G. è¡ç”Ÿå“å‹åŠ›ç›‘æµ‹',
                'H. å¾®è§‚ç»“æ„ä¼˜åŒ–',
                'I. æ™ºèƒ½ä»“ä½é…ç½®',
                'J. é›†æˆèšåˆå†³ç­–'
            ]
        }
    },
    'database': {
        'en': {
            title: 'PostgreSQL Database',
            items: [
                'Primary Data Storage',
                'Connection Pooling',
                'Health Monitoring',
                'Automatic Reconnection',
                'Data Integrity Checks',
                'Performance Optimization',
                'User Management',
                'Mining Data Storage',
                'Historical Analytics',
                'Relationship Management'
            ]
        },
        'zh': {
            title: 'PostgreSQLæ•°æ®åº“',
            items: [
                'ä¸»è¦æ•°æ®å­˜å‚¨',
                'è¿æ¥æ± ',
                'å¥åº·ç›‘æ§',
                'è‡ªåŠ¨é‡è¿',
                'æ•°æ®å®Œæ•´æ€§æ£€æŸ¥',
                'æ€§èƒ½ä¼˜åŒ–',
                'ç”¨æˆ·ç®¡ç†',
                'æŒ–çŸ¿æ•°æ®å­˜å‚¨',
                'å†å²åˆ†æ',
                'å…³ç³»ç®¡ç†'
            ]
        }
    }
};

// Show module details on click
document.querySelectorAll('.system-node').forEach(node => {
    node.addEventListener('click', function() {
        const module = this.getAttribute('data-module');
        const details = moduleDetails[module];
        const detailsPanel = document.getElementById('moduleDetails');
        const detailTitle = document.getElementById('detailTitle');
        const detailList = document.getElementById('detailList');
        
        if (details) {
            const isZh = document.querySelector('.zh-text').style.display !== 'none';
            const lang = isZh ? 'zh' : 'en';
            const data = details[lang];
            
            detailTitle.textContent = data.title;
            detailList.innerHTML = '';
            
            data.items.forEach(item => {
                const li = document.createElement('li');
                li.textContent = item;
                detailList.appendChild(li);
            });
            
            // Position the panel near the clicked node
            const rect = this.getBoundingClientRect();
            const container = document.querySelector('.relationship-svg-container').getBoundingClientRect();
            
            detailsPanel.style.left = (rect.left - container.left + 50) + 'px';
            detailsPanel.style.top = (rect.top - container.top + 100) + 'px';
            detailsPanel.classList.add('show');
            
            // Hide panel after 5 seconds
            setTimeout(() => {
                detailsPanel.classList.remove('show');
            }, 5000);
        }
    });
});

// Hide details panel when clicking elsewhere
document.addEventListener('click', function(e) {
    if (!e.target.closest('.system-node') && !e.target.closest('#moduleDetails')) {
        document.getElementById('moduleDetails').classList.remove('show');
    }
});

// Animate nodes on page load
window.addEventListener('load', function() {
    const nodes = document.querySelectorAll('.system-node');
    nodes.forEach((node, index) => {
        setTimeout(() => {
            node.style.opacity = '0';
            node.style.transform = 'translateY(20px) scale(0.8)';
            node.style.animation = 'slideInUp 0.6s ease forwards';
        }, index * 50);
    });
    
    // Animate connection lines after nodes
    setTimeout(() => {
        document.querySelectorAll('.connection-line').forEach((line, index) => {
            setTimeout(() => {
                line.style.opacity = '0';
                line.style.animation = 'fadeIn 0.5s ease forwards';
            }, index * 100);
        });
    }, nodes.length * 50 + 500);
});

// Add the animation styles
const style = document.createElement('style');
style.textContent = `
    @keyframes slideInUp {
        from {
            opacity: 0;
            transform: translateY(20px) scale(0.8);
        }
        to {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
    }
    
    @keyframes fadeIn {
        from {
            opacity: 0;
        }
        to {
            opacity: 0.7;
        }
    }
`;
document.head.appendChild(style);
</script>
{% endblock %}