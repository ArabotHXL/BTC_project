<!DOCTYPE html>
<html lang="{{ 'zh-CN' if current_lang == 'zh' else 'en' }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>站点状态 - {% if status %}{{ status.site.name }}{% else %}HashInsight 托管服务{% endif %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #ffffff;
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            min-height: 100vh;
        }
        .status-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        .status-online { background-color: #22c55e; }
        .status-offline { background-color: #ef4444; }
        .status-maintenance { background-color: #f59e0b; }
        .utilization-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
        }
        .utilization-fill {
            height: 100%;
            background: linear-gradient(90deg, #22c55e 0%, #f59e0b 70%, #ef4444 90%);
            transition: width 0.3s ease;
        }
        .incident-item {
            background: rgba(255, 255, 255, 0.05);
            border-left: 4px solid;
            padding: 12px 16px;
            margin-bottom: 8px;
            border-radius: 0 8px 8px 0;
        }
        .incident-high { border-left-color: #ef4444; }
        .incident-medium { border-left-color: #f59e0b; }
        .incident-low { border-left-color: #22c55e; }
        .auto-refresh {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50px;
            padding: 8px 16px;
            font-size: 12px;
        }
        .header-brand {
            background: linear-gradient(45deg, #ffd700, #ffa500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
        }
    </style>
</head>
<body>
    <div class="container py-5">
        <!-- Header -->
        <div class="text-center mb-5">
            <div class="d-flex justify-content-end mb-3">
                <button type="button" data-lang-switch="zh" data-lang="zh" 
                        class="btn btn-sm btn-outline-light {{ 'active' if current_lang == 'zh' else '' }} lang-switch-btn me-1">
                    中文
                </button>
                <button type="button" data-lang-switch="en" data-lang="en" 
                        class="btn btn-sm btn-outline-light {{ 'active' if current_lang == 'en' else '' }} lang-switch-btn">
                    EN
                </button>
            </div>
            <h1 class="header-brand mb-3">
                <i class="bi bi-lightning-charge"></i>
                HashInsight 托管服务
            </h1>
            <p class="text-light opacity-75">实时站点状态与透明度监控</p>
        </div>

        {% if status %}
        <!-- Site Status Overview -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="status-card p-4">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div>
                            <h2 class="h4 mb-1">{{ status.site.name }}</h2>
                            <p class="text-light opacity-75 mb-0">
                                <i class="bi bi-geo-alt"></i>
                                {{ status.site.location }}
                            </p>
                        </div>
                        <div class="text-end">
                            <span class="status-indicator status-{{ status.site.status }}"></span>
                            <span class="text-uppercase fw-bold">
                                {% if status.site.status == 'online' %}在线运行
                                {% elif status.site.status == 'offline' %}离线状态
                                {% elif status.site.status == 'maintenance' %}维护中
                                {% else %}{{ status.site.status }}{% endif %}
                            </span>
                        </div>
                    </div>
                    
                    <!-- Capacity Information -->
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="d-flex justify-content-between mb-2">
                                <span>容量利用率</span>
                                <span class="fw-bold">{{ "%.1f"|format(status.site.utilization_rate) }}%</span>
                            </div>
                            <div class="utilization-bar">
                                <div class="utilization-fill" style="width: {{ status.site.utilization_rate }}%"></div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="text-center">
                                <div class="h5 mb-1">{{ "%.1f"|format(status.site.capacity_mw) }} MW</div>
                                <div class="small text-light opacity-75">总设计容量</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Incidents Section -->
        <div class="row">
            <div class="col-12">
                <div class="status-card p-4">
                    <h3 class="h5 mb-3">
                        <i class="bi bi-exclamation-triangle"></i>
                        近期事件 (过去7天)
                    </h3>
                    
                    {% if status.incidents %}
                        {% for incident in status.incidents %}
                        <div class="incident-item incident-{{ incident.severity }}">
                            <div class="d-flex justify-content-between align-items-start">
                                <div class="flex-grow-1">
                                    <h6 class="mb-1">{{ incident.title }}</h6>
                                    <div class="small text-light opacity-75">
                                        <span class="badge bg-{{ 'danger' if incident.severity == 'high' else 'warning' if incident.severity == 'medium' else 'success' }} me-2">
                                            {{ incident.severity.upper() }}
                                        </span>
                                        <span class="badge bg-secondary">
                                            {% if incident.status == 'open' %}待处理
                                            {% elif incident.status == 'investigating' %}调查中
                                            {% elif incident.status == 'resolved' %}已解决
                                            {% elif incident.status == 'closed' %}已关闭
                                            {% else %}{{ incident.status }}{% endif %}
                                        </span>
                                    </div>
                                </div>
                                <div class="text-end small text-light opacity-75">
                                    {{ incident.created_at[:10] }}
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="text-center py-4">
                            <i class="bi bi-check-circle text-success fs-1 mb-3"></i>
                            <h6 class="text-success">运行稳定</h6>
                            <p class="text-light opacity-75 mb-0">过去7天无重大事件记录</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
        {% else %}
        <!-- Error State -->
        <div class="row">
            <div class="col-12">
                <div class="status-card p-5 text-center">
                    <i class="bi bi-exclamation-triangle text-warning fs-1 mb-3"></i>
                    <h3 class="mb-3">站点状态暂时无法获取</h3>
                    <p class="text-light opacity-75 mb-4">
                        请稍后重试，或联系客服获取帮助
                    </p>
                    <button onclick="location.reload()" class="btn btn-outline-light">
                        <i class="bi bi-arrow-clockwise me-2"></i>重新加载
                    </button>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Footer -->
        <div class="text-center mt-5 pt-4 border-top border-secondary">
            <p class="text-light opacity-50 small mb-1">
                © 2025 HashInsight 托管服务 | 数据实时更新
            </p>
            <p class="text-light opacity-50 small mb-0">
                服务支持: <a href="mailto:support@hashinsight.net" class="text-decoration-none text-warning">support@hashinsight.net</a>
            </p>
        </div>
    </div>

    <!-- Auto-refresh indicator -->
    <div class="auto-refresh" id="refreshIndicator">
        <i class="bi bi-arrow-clockwise me-1"></i>
        <span id="refreshTimer">60</span>s 后自动刷新
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Auto-refresh functionality
        let refreshCountdown = 60;
        const refreshTimer = document.getElementById('refreshTimer');
        
        function updateTimer() {
            refreshTimer.textContent = refreshCountdown;
            refreshCountdown--;
            
            if (refreshCountdown < 0) {
                location.reload();
            }
        }
        
        // Update timer every second
        setInterval(updateTimer, 1000);
        
        // Pause auto-refresh on user interaction
        let userInteracted = false;
        document.addEventListener('click', () => {
            if (!userInteracted) {
                userInteracted = true;
                clearInterval(updateTimer);
                document.getElementById('refreshIndicator').innerHTML = 
                    '<i class="bi bi-pause me-1"></i>自动刷新已暂停';
            }
        });
    </script>
    <script src="/static/js/i18n.js"></script>
</body>
</html>